<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>pypdf._page - pypdf 5.1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pypdf 5.1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">pypdf 5.1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html">迁移指南：从 1.x 到 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html#id1">导入和模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html#id2">命名调整</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/robustness.html">稳健性与 <code class="docutils literal notranslate"><span class="pre">strict=False</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/suppress-warnings.html">异常、警告和日志消息</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/metadata.html">元数据（Metadata）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-text.html">从 PDF 中提取文本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/post-processing-in-text-extraction.html">文本提取的后处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-images.html">提取图像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-images.html#id2">其他图像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-attachments.html">提取附件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/encryption-decryption.html">PDF 的加密与解密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/merging-pdfs.html">合并 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/cropping-and-transforming.html">裁剪和转换 PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/cropping-and-transforming.html#id7">转换同一页面的多个副本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/reading-pdf-annotations.html">读取 PDF 注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/adding-pdf-annotations.html">添加 PDF 注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/add-watermark.html">向 PDF 添加印章或水印</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/add-javascript.html">向 PDF 添加 JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/viewer-preferences.html">添加查看器首选项</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/forms.html">与 PDF 表单的交互</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/streaming-data.html">使用 pypdf 流式传输数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/file-size.html">减小 PDF 文件大小</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/pdf-version-support.html">PDF 版本支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/pdfa-compliance.html">PDF/A 合规性</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API 参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfReader.html">PdfReader 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfWriter.html">PdfWriter 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Destination.html">Destination 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/DocumentInformation.html">DocumentInformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Field.html">Field类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Fit.html">Fit 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PageObject.html">PageObject 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PageRange.html">PageRange 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PaperSize.html">PaperSize 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/RectangleObject.html">RectangleObject 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Transformation.html">Transformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/XmpInformation.html">XmpInformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/annotations.html">annotations 模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/constants.html">常量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/errors.html">异常和错误</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/generic.html">PDF 范型对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfDocCommon.html">PdfDocCommon 类</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id2">安装依赖</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id3">运行测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#sample-files-git">sample-files Git 子模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#git-pre-commit">工具：Git 和 pre-commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id4">提交消息规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#pull-request">Pull Request 大小</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id7">基准测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pdf-format.html">PDF 格式</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pypdf-parsing.html">pypdf 如何解析 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pypdf-writing.html">pypdf 如何写入 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/cmaps.html">CMaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/deprecations.html">弃用流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/documentation.html">文档编写</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/testing.html">测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/releasing.html">发布</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">关于 pypdf</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../meta/CHANGELOG.html">更新日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/changelog-v1.html">Changelog of PyPDF2 1.X</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/project-governance.html">项目治理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/taking-ownership.html">接管 pypdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/history.html">pypdf 历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/CONTRIBUTORS.html">贡献者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/scope-of-pypdf.html">pypdf 的范围</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/comparisons.html">pypdf 与 X 的对比</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/faq.html">常见问题解答</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>pypdf._page 源代码</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2006, Mathieu Fenniak</span>
<span class="c1"># Copyright (c) 2007, Ashish Kulkarni &lt;kulkarni.ashish@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1"># * Redistributions of source code must retain the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer.</span>
<span class="c1"># * Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer in the documentation</span>
<span class="c1"># and/or other materials provided with the distribution.</span>
<span class="c1"># * The name of the author may not be used to endorse or promote products</span>
<span class="c1"># derived from this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<span class="c1"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="c1"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="c1"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="c1"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">._cmap</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">build_char_map</span><span class="p">,</span>
    <span class="n">build_font_width_map</span><span class="p">,</span>
    <span class="n">compute_font_width</span><span class="p">,</span>
    <span class="n">get_actual_str_key</span><span class="p">,</span>
    <span class="n">unknown_char_map</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">._protocols</span> <span class="kn">import</span> <span class="n">PdfCommonDocProtocol</span>
<span class="kn">from</span> <span class="nn">._text_extraction</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">OrientationNotFoundError</span><span class="p">,</span>
    <span class="n">_layout_mode</span><span class="p">,</span>
    <span class="n">crlf_space_check</span><span class="p">,</span>
    <span class="n">get_display_str</span><span class="p">,</span>
    <span class="n">get_text_operands</span><span class="p">,</span>
    <span class="n">mult</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CompressedTransformationMatrix</span><span class="p">,</span>
    <span class="n">TransformationMatrixType</span><span class="p">,</span>
    <span class="n">_human_readable_bytes</span><span class="p">,</span>
    <span class="n">logger_warning</span><span class="p">,</span>
    <span class="n">matrix_multiply</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">AnnotationDictionaryAttributes</span> <span class="k">as</span> <span class="n">ADA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">ImageAttributes</span> <span class="k">as</span> <span class="n">IA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">PageAttributes</span> <span class="k">as</span> <span class="n">PG</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">Resources</span> <span class="k">as</span> <span class="n">RES</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">PageSizeNotDefinedError</span><span class="p">,</span> <span class="n">PdfReadError</span>
<span class="kn">from</span> <span class="nn">.filters</span> <span class="kn">import</span> <span class="n">_xobj_to_image</span>
<span class="kn">from</span> <span class="nn">.generic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ArrayObject</span><span class="p">,</span>
    <span class="n">ContentStream</span><span class="p">,</span>
    <span class="n">DictionaryObject</span><span class="p">,</span>
    <span class="n">EncodedStreamObject</span><span class="p">,</span>
    <span class="n">FloatObject</span><span class="p">,</span>
    <span class="n">IndirectObject</span><span class="p">,</span>
    <span class="n">NameObject</span><span class="p">,</span>
    <span class="n">NullObject</span><span class="p">,</span>
    <span class="n">NumberObject</span><span class="p">,</span>
    <span class="n">PdfObject</span><span class="p">,</span>
    <span class="n">RectangleObject</span><span class="p">,</span>
    <span class="n">StreamObject</span><span class="p">,</span>
    <span class="n">TextStringObject</span><span class="p">,</span>
    <span class="n">is_null_or_none</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PIL.Image</span> <span class="kn">import</span> <span class="n">Image</span>

    <span class="n">pil_not_imported</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">Image</span> <span class="o">=</span> <span class="nb">object</span>  <span class="c1"># type: ignore</span>
    <span class="n">pil_not_imported</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># error will be raised only when using images</span>

<span class="n">MERGE_CROP_BOX</span> <span class="o">=</span> <span class="s2">&quot;cropbox&quot;</span>  <span class="c1"># pypdf&lt;=3.4.0 used &#39;trimbox&#39;</span>


<span class="k">def</span> <span class="nf">_get_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">defaults</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">RectangleObject</span><span class="p">:</span>
    <span class="n">retval</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">RectangleObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">RectangleObject</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">retval</span>
    <span class="k">if</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">retval</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">_set_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">retval</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retval</span>


<span class="k">def</span> <span class="nf">_set_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RectangleObject</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">_delete_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_create_rectangle_accessor</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fallback</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">property</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">_get_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fallback</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_set_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">_delete_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
    <span class="p">)</span>


<div class="viewcode-block" id="Transformation">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation">[文档]</a>
<span class="k">class</span> <span class="nc">Transformation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a 2D transformation.</span>

<span class="sd">    The transformation between two coordinate systems is represented by a 3-by-3</span>
<span class="sd">    transformation matrix matrix with the following form::</span>

<span class="sd">        a b 0</span>
<span class="sd">        c d 0</span>
<span class="sd">        e f 1</span>

<span class="sd">    Because a transformation matrix has only six elements that can be changed,</span>
<span class="sd">    it is usually specified in PDF as the six-element array [ a b c d e f ].</span>

<span class="sd">    Coordinate transformations are expressed as matrix multiplications::</span>

<span class="sd">                                 a b 0</span>
<span class="sd">     [ x′ y′ 1 ] = [ x y 1 ] ×   c d 0</span>
<span class="sd">                                 e f 1</span>


<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pypdf import Transformation</span>
<span class="sd">        &gt;&gt;&gt; op = Transformation().scale(sx=2, sy=3).translate(tx=10, ty=20)</span>
<span class="sd">        &gt;&gt;&gt; page.add_transformation(op)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 9.5.4 Coordinate Systems for 3D</span>
    <span class="c1"># 4.2.2 Common Transformations</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctm</span><span class="p">:</span> <span class="n">CompressedTransformationMatrix</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span> <span class="o">=</span> <span class="n">ctm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformationMatrixType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the transformation matrix as a tuple of tuples in the form:</span>

<span class="sd">        ((a, b, 0), (c, d, 0), (e, f, 1))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Transformation.compress">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.compress">[文档]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">TransformationMatrixType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CompressedTransformationMatrix</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compresses the transformation matrix into a tuple of (a, b, c, d, e, f).</span>

<span class="sd">        Args:</span>
<span class="sd">            matrix: The transformation matrix as a tuple of tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple representing the transformation matrix as (a, b, c, d, e, f)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Transformation.transform">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.transform">[文档]</a>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="s2">&quot;Transformation&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Transformation&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply one transformation to another.</span>

<span class="sd">        Args:</span>
<span class="sd">            m: a Transformation to apply.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``Transformation`` instance</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; from pypdf import Transformation</span>
<span class="sd">            &gt;&gt;&gt; op = Transformation((1, 0, 0, -1, 0, height)) # vertical mirror</span>
<span class="sd">            &gt;&gt;&gt; op = Transformation().transform(Transformation((-1, 0, 0, 1, iwidth, 0))) # horizontal mirror</span>
<span class="sd">            &gt;&gt;&gt; page.add_transformation(op)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctm</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">matrix_multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">matrix</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Transformation</span><span class="p">(</span><span class="n">ctm</span><span class="p">)</span></div>


<div class="viewcode-block" id="Transformation.translate">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.translate">[文档]</a>
    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Transformation&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate the contents of a page.</span>

<span class="sd">        Args:</span>
<span class="sd">            tx: The translation along the x-axis.</span>
<span class="sd">            ty: The translation along the y-axis.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``Transformation`` instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span>
        <span class="k">return</span> <span class="n">Transformation</span><span class="p">(</span><span class="n">ctm</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">tx</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">ty</span><span class="p">))</span></div>


<div class="viewcode-block" id="Transformation.scale">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.scale">[文档]</a>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Transformation&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale the contents of a page towards the origin of the coordinate system.</span>

<span class="sd">        Typically, that is the lower-left corner of the page. That can be</span>
<span class="sd">        changed by translating the contents / the page boxes.</span>

<span class="sd">        Args:</span>
<span class="sd">            sx: The scale factor along the x-axis.</span>
<span class="sd">            sy: The scale factor along the y-axis.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new Transformation instance with the scaled matrix.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either sx or sy must be specified&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="n">sy</span>
        <span class="k">if</span> <span class="n">sy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">sx</span>
        <span class="k">assert</span> <span class="n">sx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">sy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">op</span><span class="p">:</span> <span class="n">TransformationMatrixType</span> <span class="o">=</span> <span class="p">((</span><span class="n">sx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ctm</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">matrix_multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Transformation</span><span class="p">(</span><span class="n">ctm</span><span class="p">)</span></div>


<div class="viewcode-block" id="Transformation.rotate">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.rotate">[文档]</a>
    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Transformation&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate the contents of a page.</span>

<span class="sd">        Args:</span>
<span class="sd">            rotation: The angle of rotation in degrees.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``Transformation`` instance with the rotated matrix.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
        <span class="n">op</span><span class="p">:</span> <span class="n">TransformationMatrixType</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">ctm</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">matrix_multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Transformation</span><span class="p">(</span><span class="n">ctm</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Transformation(ctm=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">apply_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">as_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">apply_on</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">as_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Transformation.apply_on">
<a class="viewcode-back" href="../../modules/Transformation.html#pypdf._page.Transformation.apply_on">[文档]</a>
    <span class="k">def</span> <span class="nf">apply_on</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pt</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">as_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the transformation matrix on the given point.</span>

<span class="sd">        Args:</span>
<span class="sd">            pt: A tuple or list representing the point in the form (x, y)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple or list representing the transformed point in the form (x&#39;, y&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">FloatObject</span> <span class="k">if</span> <span class="n">as_object</span> <span class="k">else</span> <span class="nb">float</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">typ</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
            <span class="n">typ</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctm</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">pt1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">pt1</span></div>
</div>



<div class="viewcode-block" id="ImageFile">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.ImageFile">[文档]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image within the PDF file. *This object is not designed to be built.*</span>

<span class="sd">    This object should not be modified except using :func:`ImageFile.replace` to replace the image with a new one.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filename as identified within the PDF file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data as bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data as PIL image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">indirect_reference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reference to the object storing the stream.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ImageFile.replace">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.ImageFile.replace">[文档]</a>
    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the image with a new PIL image.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_image (PIL.Image.Image): The new PIL image to replace the existing image.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to `Image.save()`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the image is inline or in a PdfReader.</span>
<span class="sd">            TypeError: If the image does not belong to a PdfWriter.</span>
<span class="sd">            TypeError: If `new_image` is not a PIL Image.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method replaces the existing image with a new image.</span>
<span class="sd">            It is not allowed for inline images or images within a PdfReader.</span>
<span class="sd">            The `kwargs` parameter allows passing additional parameters</span>
<span class="sd">            to `Image.save()`, such as quality.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pil_not_imported</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;pillow is required to do image extraction. &quot;</span>
                <span class="s2">&quot;It can be installed via &#39;pip install pypdf[image]&#39;&quot;</span>
            <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">._reader</span> <span class="kn">import</span> <span class="n">PdfReader</span>

        <span class="c1"># to prevent circular import</span>
        <span class="kn">from</span> <span class="nn">.filters</span> <span class="kn">import</span> <span class="n">_xobj_to_image</span>
        <span class="kn">from</span> <span class="nn">.generic</span> <span class="kn">import</span> <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">PdfObject</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot update an inline image.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;_id_translated&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot update an image not belonging to a PdfWriter.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_image</span><span class="p">,</span> <span class="n">Image</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;new_image shall be a PIL Image&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">new_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">cast</span><span class="p">(</span>
            <span class="n">PdfObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="c1"># change the object attributes</span>
        <span class="n">extension</span><span class="p">,</span> <span class="n">byte_stream</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">_xobj_to_image</span><span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">byte_stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, data: </span><span class="si">{</span><span class="n">_human_readable_bytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;, hash: </span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="VirtualListImages">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.VirtualListImages">[文档]</a>
<span class="k">class</span> <span class="nc">VirtualListImages</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">ImageFile</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides access to images referenced within a page.</span>
<span class="sd">    Only one copy will be returned if the usage is used on the same page multiple times.</span>
<span class="sd">    See :func:`PageObject.images` for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ids_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]],</span>
        <span class="n">get_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span> <span class="n">ImageFile</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span> <span class="o">=</span> <span class="n">ids_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span> <span class="o">=</span> <span class="n">get_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span><span class="p">())</span>

<div class="viewcode-block" id="VirtualListImages.keys">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.VirtualListImages.keys">[文档]</a>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span><span class="p">()</span></div>


<div class="viewcode-block" id="VirtualListImages.items">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.VirtualListImages.items">[文档]</a>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">ImageFile</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span><span class="p">()]</span></div>


    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">ImageFile</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ImageFile</span><span class="p">]:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ImageFile</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ImageFile</span><span class="p">]]:</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">((</span><span class="k">lambda</span><span class="p">:</span> <span class="n">lst</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid sequence indices type&quot;</span><span class="p">)</span>
        <span class="n">len_self</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># support negative indexes</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">len_self</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">len_self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Sequence index out of range&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">ImageFile</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Image_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids_function</span><span class="p">())]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span></div>



<div class="viewcode-block" id="PageObject">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject">[文档]</a>
<span class="k">class</span> <span class="nc">PageObject</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PageObject represents a single page within a PDF file.</span>

<span class="sd">    Typically these objects will be created by accessing the</span>
<span class="sd">    :attr:`pages&lt;pypdf.PdfReader.pages&gt;` property of the</span>
<span class="sd">    :class:`PdfReader&lt;pypdf.PdfReader&gt;` class, but it is</span>
<span class="sd">    also possible to create an empty page with the</span>
<span class="sd">    :meth:`create_blank_page()&lt;pypdf._page.PageObject.create_blank_page&gt;` static method.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdf: PDF file the page belongs to.</span>
<span class="sd">        indirect_reference: Stores the original indirect reference to</span>
<span class="sd">            this object in its source PDF</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original_page</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span>  <span class="c1"># very local use in writer when appending</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pdf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfCommonDocProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indirect_reference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">DictionaryObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ImageFile</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># below Union for mypy but actually Optional[List[str]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">indirect_reference</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">indirect_reference</span><span class="o">.</span><span class="n">get_object</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="PageObject.hash_bin">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.hash_bin">[文档]</a>
    <span class="k">def</span> <span class="nf">hash_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to detect modified object.</span>

<span class="sd">        Note: this function is overloaded to return the same results</span>
<span class="sd">        as a DictionaryObject.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Hash considering type and value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span>
            <span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">())</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.hash_value_data">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.hash_value_data">[文档]</a>
    <span class="k">def</span> <span class="nf">hash_value_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">hash_value_data</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A read-only positive number giving the size of user space units.</span>

<span class="sd">        It is in multiples of 1/72 inch. Hence a value of 1 means a user</span>
<span class="sd">        space unit is 1/72 inch, and a value of 3 means that a user</span>
<span class="sd">        space unit is 3/72 inch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">USER_UNIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="PageObject.create_blank_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.create_blank_page">[文档]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_blank_page</span><span class="p">(</span>
        <span class="n">pdf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfCommonDocProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new blank page.</span>

<span class="sd">        If ``width`` or ``height`` is ``None``, try to get the page size</span>
<span class="sd">        from the last page of *pdf*.</span>

<span class="sd">        Args:</span>
<span class="sd">            pdf: PDF file the page is within.</span>
<span class="sd">            width: The width of the new page expressed in default user</span>
<span class="sd">                space units.</span>
<span class="sd">            height: The height of the new page expressed in default user</span>
<span class="sd">                space units.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new blank page</span>

<span class="sd">        Raises:</span>
<span class="sd">            PageSizeNotDefinedError: if ``pdf`` is ``None`` or contains</span>
<span class="sd">                no page</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">PageObject</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># Creates a new page (cf PDF Reference  7.7.3.3)</span>
        <span class="n">page</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">TYPE</span><span class="p">),</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Page&quot;</span><span class="p">))</span>
        <span class="n">page</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">PARENT</span><span class="p">),</span> <span class="n">NullObject</span><span class="p">())</span>
        <span class="n">page</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">),</span> <span class="n">DictionaryObject</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lastpage</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">lastpage</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">width</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">lastpage</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PageSizeNotDefinedError</span>
        <span class="n">page</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">),</span> <span class="n">RectangleObject</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">page</span></div>


    <span class="k">def</span> <span class="nf">_get_ids_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ancest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">call_stack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">if</span> <span class="n">call_stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">call_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_i</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">call_stack</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">call_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_i</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inline_images</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">ancest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ancest</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span> <span class="ow">or</span> <span class="n">RES</span><span class="o">.</span><span class="n">XOBJECT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">x_object</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">][</span><span class="n">RES</span><span class="o">.</span><span class="n">XOBJECT</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">x_object</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_object</span><span class="p">[</span><span class="n">o</span><span class="p">],</span> <span class="n">StreamObject</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">x_object</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="n">IA</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/Image&quot;</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ancest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ancest</span> <span class="o">+</span> <span class="p">[</span><span class="n">o</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is a form with possible images inside</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ids_image</span><span class="p">(</span><span class="n">x_object</span><span class="p">[</span><span class="n">o</span><span class="p">],</span> <span class="n">ancest</span> <span class="o">+</span> <span class="p">[</span><span class="n">o</span><span class="p">],</span> <span class="n">call_stack</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">lst</span>

    <span class="k">def</span> <span class="nf">_get_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageFile</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">List</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xobjs</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">])[</span><span class="n">RES</span><span class="o">.</span><span class="n">XOBJECT</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;~&quot;</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;~&quot;</span><span class="p">):</span>
                <span class="k">raise</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;~&quot;</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;~&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inline_images</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No inline image can be found&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

            <span class="n">imgd</span> <span class="o">=</span> <span class="n">_xobj_to_image</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">xobjs</span><span class="p">[</span><span class="nb">id</span><span class="p">]))</span>
            <span class="n">extension</span><span class="p">,</span> <span class="n">byte_stream</span> <span class="o">=</span> <span class="n">imgd</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFile</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">byte_stream</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">imgd</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">indirect_reference</span><span class="o">=</span><span class="n">xobjs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># in a sub object</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">xobjs</span><span class="p">[</span><span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">images</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VirtualListImages</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read-only property emulating a list of images on a page.</span>

<span class="sd">        Get a list of all images on the page. The key can be:</span>
<span class="sd">        - A string (for the top object)</span>
<span class="sd">        - A tuple (for images within XObject forms)</span>
<span class="sd">        - An integer</span>

<span class="sd">        Examples:</span>
<span class="sd">            * `reader.pages[0].images[0]`        # return first image</span>
<span class="sd">            * `reader.pages[0].images[&#39;/I0&#39;]`    # return image &#39;/I0&#39;</span>
<span class="sd">            * `reader.pages[0].images[&#39;/TP1&#39;,&#39;/Image1&#39;]` # return image &#39;/Image1&#39; within &#39;/TP1&#39; Xobject/Form</span>
<span class="sd">            * `for img in reader.pages[0].images:` # loops through all objects</span>

<span class="sd">        images.keys() and images.items() can be used.</span>

<span class="sd">        The ImageFile has the following properties:</span>

<span class="sd">            * `.name` : name of the object</span>
<span class="sd">            * `.data` : bytes of the object</span>
<span class="sd">            * `.image`  : PIL Image Object</span>
<span class="sd">            * `.indirect_reference` : object reference</span>

<span class="sd">        and the following methods:</span>
<span class="sd">            `.replace(new_image: PIL.Image.Image, **kwargs)` :</span>
<span class="sd">                replace the image in the pdf with the new image</span>
<span class="sd">                applying the saving parameters indicated (such as quality)</span>

<span class="sd">        Example usage:</span>

<span class="sd">            reader.pages[0].images[0]=replace(Image.open(&quot;new_image.jpg&quot;, quality = 20)</span>

<span class="sd">        Inline images are extracted and named ~0~, ~1~, ..., with the</span>
<span class="sd">        indirect_reference set to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VirtualListImages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ids_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_translate_value_inlineimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PdfObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate values used in inline image&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;/G&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceGray&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/RGB&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceRGB&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/CMYK&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceCMYK&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/I&quot;</span><span class="p">:</span> <span class="s2">&quot;/Indexed&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/AHx&quot;</span><span class="p">:</span> <span class="s2">&quot;/ASCIIHexDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/A85&quot;</span><span class="p">:</span> <span class="s2">&quot;/ASCII85Decode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/LZW&quot;</span><span class="p">:</span> <span class="s2">&quot;/LZWDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/Fl&quot;</span><span class="p">:</span> <span class="s2">&quot;/FlateDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/RL&quot;</span><span class="p">:</span> <span class="s2">&quot;/RunLengthDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/CCF&quot;</span><span class="p">:</span> <span class="s2">&quot;/CCITTFaxDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/DCT&quot;</span><span class="p">:</span> <span class="s2">&quot;/DCTDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/DeviceGray&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceGray&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/DeviceRGB&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceRGB&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/DeviceCMYK&quot;</span><span class="p">:</span> <span class="s2">&quot;/DeviceCMYK&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/Indexed&quot;</span><span class="p">:</span> <span class="s2">&quot;/Indexed&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/ASCIIHexDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/ASCIIHexDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/ASCII85Decode&quot;</span><span class="p">:</span> <span class="s2">&quot;/ASCII85Decode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/LZWDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/LZWDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/FlateDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/FlateDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/RunLengthDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/RunLengthDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/CCITTFaxDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/CCITTFaxDecode&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/DCTDecode&quot;</span><span class="p">:</span> <span class="s2">&quot;/DCTDecode&quot;</span><span class="p">,</span>
                <span class="p">}[</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
                <span class="c1"># It is a custom name, thus we have to look in resources.</span>
                <span class="c1"># The only applicable case is for ColorSpace.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">])[</span><span class="s2">&quot;/ColorSpace&quot;</span><span class="p">]</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">res</span><span class="p">)[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># for res and v</span>
                    <span class="k">raise</span> <span class="n">PdfReadError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find resource entry </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_get_inline_images</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ImageFile</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get inline_images</span>
<span class="sd">        entries will be identified as ~1~</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">imgs_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">ope</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ope</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;INLINE IMAGE&quot;</span><span class="p">:</span>
                <span class="n">imgs_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">],</span> <span class="s2">&quot;__streamdata__&quot;</span><span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ope</span> <span class="ow">in</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;BI&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;EI&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;ID&quot;</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">raise</span> <span class="n">PdfReadError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ope</span><span class="si">!r}</span><span class="s2"> operator met whereas not expected,&quot;</span>
                    <span class="s2">&quot;please share usecase with pypdf dev team&quot;</span>
                <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;backup</span>
<span class="sd">            elif ope == b&quot;BI&quot;:</span>
<span class="sd">                img_data[&quot;settings&quot;] = {}</span>
<span class="sd">            elif ope == b&quot;EI&quot;:</span>
<span class="sd">                imgs_data.append(img_data)</span>
<span class="sd">                img_data = {}</span>
<span class="sd">            elif ope == b&quot;ID&quot;:</span>
<span class="sd">                img_data[&quot;__streamdata__&quot;] = b&quot;&quot;</span>
<span class="sd">            elif &quot;__streamdata__&quot; in img_data:</span>
<span class="sd">                if len(img_data[&quot;__streamdata__&quot;]) &gt; 0:</span>
<span class="sd">                    img_data[&quot;__streamdata__&quot;] += b&quot;\n&quot;</span>
<span class="sd">                    raise Exception(&quot;check append&quot;)</span>
<span class="sd">                img_data[&quot;__streamdata__&quot;] += param</span>
<span class="sd">            elif &quot;settings&quot; in img_data:</span>
<span class="sd">                img_data[&quot;settings&quot;][ope.decode()] = param</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs_data</span><span class="p">):</span>
            <span class="n">init</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;__streamdata__&quot;</span><span class="p">:</span> <span class="n">ii</span><span class="p">[</span><span class="s2">&quot;__streamdata__&quot;</span><span class="p">],</span>
                <span class="s2">&quot;/Length&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">[</span><span class="s2">&quot;__streamdata__&quot;</span><span class="p">]),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;/Length&quot;</span><span class="p">,</span> <span class="s2">&quot;/L&quot;</span><span class="p">}:</span>  <span class="c1"># no length is expected</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate_value_inlineimage</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_value_inlineimage</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;/BPC&quot;</span><span class="p">:</span> <span class="s2">&quot;/BitsPerComponent&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/CS&quot;</span><span class="p">:</span> <span class="s2">&quot;/ColorSpace&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/D&quot;</span><span class="p">:</span> <span class="s2">&quot;/Decode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/DP&quot;</span><span class="p">:</span> <span class="s2">&quot;/DecodeParms&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/F&quot;</span><span class="p">:</span> <span class="s2">&quot;/Filter&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/H&quot;</span><span class="p">:</span> <span class="s2">&quot;/Height&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/W&quot;</span><span class="p">:</span> <span class="s2">&quot;/Width&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/I&quot;</span><span class="p">:</span> <span class="s2">&quot;/Interpolate&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Intent&quot;</span><span class="p">:</span> <span class="s2">&quot;/Intent&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/IM&quot;</span><span class="p">:</span> <span class="s2">&quot;/ImageMask&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/BitsPerComponent&quot;</span><span class="p">:</span> <span class="s2">&quot;/BitsPerComponent&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/ColorSpace&quot;</span><span class="p">:</span> <span class="s2">&quot;/ColorSpace&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Decode&quot;</span><span class="p">:</span> <span class="s2">&quot;/Decode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/DecodeParms&quot;</span><span class="p">:</span> <span class="s2">&quot;/DecodeParms&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Filter&quot;</span><span class="p">:</span> <span class="s2">&quot;/Filter&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Height&quot;</span><span class="p">:</span> <span class="s2">&quot;/Height&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Width&quot;</span><span class="p">:</span> <span class="s2">&quot;/Width&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/Interpolate&quot;</span><span class="p">:</span> <span class="s2">&quot;/Interpolate&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/ImageMask&quot;</span><span class="p">:</span> <span class="s2">&quot;/ImageMask&quot;</span><span class="p">,</span>
                    <span class="p">}[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">init</span><span class="p">:</span>
                    <span class="n">init</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">ii</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EncodedStreamObject</span><span class="o">.</span><span class="n">initialize_from_dictionary</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
            <span class="n">extension</span><span class="p">,</span> <span class="n">byte_stream</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">_xobj_to_image</span><span class="p">(</span><span class="n">ii</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span>
            <span class="n">files</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;~</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">~&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImageFile</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;~</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">~</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">byte_stream</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">,</span>
                <span class="n">indirect_reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The visual rotation of the page.</span>

<span class="sd">        This number has to be a multiple of 90 degrees: 0, 90, 180, or 270 are</span>
<span class="sd">        valid values. This property does not affect ``/Contents``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rotate_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ROTATE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rotate_obj</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate_obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">rotate_obj</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>

    <span class="nd">@rotation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ROTATE</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">((((</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="mi">45</span><span class="p">)</span> <span class="o">//</span> <span class="mi">90</span><span class="p">)</span> <span class="o">*</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>

<div class="viewcode-block" id="PageObject.transfer_rotation_to_content">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.transfer_rotation_to_content">[文档]</a>
    <span class="k">def</span> <span class="nf">transfer_rotation_to_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the rotation of the page to the content and the media/crop/...</span>
<span class="sd">        boxes.</span>

<span class="sd">        It is recommended to apply this function before page merging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span>  <span class="c1"># rotation to apply is in the otherway</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mb</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="p">)</span>
        <span class="n">trsf</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Transformation</span><span class="p">()</span>
            <span class="o">.</span><span class="n">translate</span><span class="p">(</span>
                <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">mb</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">mb</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">mb</span><span class="o">.</span><span class="n">bottom</span> <span class="o">+</span> <span class="n">mb</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">(</span><span class="n">mb</span><span class="o">.</span><span class="n">lower_left</span><span class="p">)</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">(</span><span class="n">mb</span><span class="o">.</span><span class="n">upper_right</span><span class="p">)</span>
        <span class="n">trsf</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_transformation</span><span class="p">(</span><span class="n">trsf</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;/MediaBox&quot;</span><span class="p">,</span> <span class="s2">&quot;/CropBox&quot;</span><span class="p">,</span> <span class="s2">&quot;/BleedBox&quot;</span><span class="p">,</span> <span class="s2">&quot;/TrimBox&quot;</span><span class="p">,</span> <span class="s2">&quot;/ArtBox&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">rr</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                <span class="n">pt1</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">lower_left</span><span class="p">)</span>
                <span class="n">pt2</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">upper_right</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.rotate">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.rotate">[文档]</a>
    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate a page clockwise by increments of 90 degrees.</span>

<span class="sd">        Args:</span>
<span class="sd">            angle: Angle to rotate the page. Must be an increment of 90 deg.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The rotated PageObject</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">%</span> <span class="mi">90</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotation angle must be a multiple of 90&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ROTATE</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+</span> <span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span> <span class="nf">_merge_resources</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">res1</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>
        <span class="n">res2</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>
        <span class="n">resource</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">new_res1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span>
            <span class="n">is_pdf_writer</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span>
                <span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;_add_object&quot;</span>
            <span class="p">)</span>  <span class="c1"># ---------- expect isinstance(pdf,PdfWriter)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">is_pdf_writer</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">compute_unique_key</span><span class="p">(</span><span class="n">base_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Find a key that either doesn&#39;t already exist or has the same value</span>
<span class="sd">            (indicated by the bool)</span>

<span class="sd">            Args:</span>
<span class="sd">                base_key: An index is added to this to get the computed key</span>

<span class="sd">            Returns:</span>
<span class="sd">                A tuple (computed key, bool) where the boolean indicates</span>
<span class="sd">                if there is a resource of the given computed_key with the same</span>
<span class="sd">                value.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">page2res</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="n">base_key</span><span class="p">)</span>
            <span class="c1"># TODO : possible improvement : in case of writer, the indirect_reference</span>
            <span class="c1"># can not be found because translated : this may be improved</span>

            <span class="c1"># try the current key first (e.g. &quot;foo&quot;), but otherwise iterate</span>
            <span class="c1"># through &quot;foo-0&quot;, &quot;foo-1&quot;, etc. new_res can contain only finitely</span>
            <span class="c1"># many keys, thus this&#39;ll eventually end, even if it&#39;s been crafted</span>
            <span class="c1"># to be maximally annoying.</span>
            <span class="n">computed_key</span> <span class="o">=</span> <span class="n">base_key</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">computed_key</span> <span class="ow">in</span> <span class="n">new_res</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_res</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="n">computed_key</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># there&#39;s already a resource of this name, with the exact</span>
                    <span class="c1"># same value</span>
                    <span class="k">return</span> <span class="n">computed_key</span><span class="p">,</span> <span class="kc">True</span>
                <span class="n">computed_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">computed_key</span><span class="p">,</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">new_res1</span><span class="p">:</span>
            <span class="n">new_res</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
            <span class="n">new_res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_res</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">res1</span><span class="p">[</span><span class="n">resource</span><span class="p">])</span>
        <span class="n">page2res</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">res2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">rename_res</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">page2res</span><span class="p">:</span>
            <span class="n">unique_key</span><span class="p">,</span> <span class="n">same_value</span> <span class="o">=</span> <span class="n">compute_unique_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">newname</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">unique_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">unique_key</span><span class="p">:</span>
                <span class="c1"># we have to use a different name for this</span>
                <span class="n">rename_res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">newname</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">same_value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_pdf_writer</span><span class="p">:</span>
                    <span class="n">new_res</span><span class="p">[</span><span class="n">newname</span><span class="p">]</span> <span class="o">=</span> <span class="n">page2res</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_res</span><span class="p">[</span><span class="n">newname</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_res</span><span class="p">[</span><span class="n">newname</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_res</span><span class="p">[</span><span class="n">newname</span><span class="p">]</span> <span class="o">=</span> <span class="n">page2res</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_res</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">new_res</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">new_res</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_res</span><span class="p">,</span> <span class="n">rename_res</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_content_stream_rename</span><span class="p">(</span>
        <span class="n">stream</span><span class="p">:</span> <span class="n">ContentStream</span><span class="p">,</span>
        <span class="n">rename</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">pdf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfCommonDocProtocol</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContentStream</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rename</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stream</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">pdf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">operands</span><span class="p">,</span> <span class="n">_operator</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">operands</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
                        <span class="n">operands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rename</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operands</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
                        <span class="n">operands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rename</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type of operands is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">operands</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_transformation_matrix</span><span class="p">(</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">pdf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfCommonDocProtocol</span><span class="p">],</span>
        <span class="n">ctm</span><span class="p">:</span> <span class="n">CompressedTransformationMatrix</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContentStream</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add transformation matrix at the beginning of the given contents stream.&quot;&quot;&quot;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">ctm</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">pdf</span><span class="p">)</span>
        <span class="n">contents</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="n">FloatObject</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="sa">b</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">contents</span>

    <span class="k">def</span> <span class="nf">_get_contents_as_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the page contents as bytes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ``/Contents`` object as bytes, or ``None`` if it doesn&#39;t exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">EncodedStreamObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="PageObject.get_contents">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.get_contents">[文档]</a>
    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ContentStream</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access the page contents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ``/Contents`` object, or ``None`` if it does not exist.</span>
<span class="sd">            ``/Contents`` is optional, as described in §7.7.3.3 of the PDF Reference.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pdf</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">pdf</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pdf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PageObject.replace_contents">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.replace_contents">[文档]</a>
    <span class="k">def</span> <span class="nf">replace_contents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">ContentStream</span><span class="p">,</span> <span class="n">EncodedStreamObject</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the page contents with the new content and nullify old objects</span>
<span class="sd">        Args:</span>
<span class="sd">            content: new content; if None delete the content field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># the page is not attached : the content is directly attached.</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">ArrayObject</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)):</span>
                <span class="n">content</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                    <span class="n">content</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># applies at least for page not in writer</span>
                <span class="c1"># as a backup solution, we put content as an object although not in accordance with pdf ref</span>
                <span class="c1"># this will be fixed with the _add_object</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
            <span class="n">content</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span>
                <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span>
            <span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>  <span class="c1"># TODO: in a future may required generation management</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># applies at least for page not in writer</span>
                <span class="c1"># as a backup solution, we put content as an object although not in accordance with pdf ref</span>
                <span class="c1"># this will be fixed with the _add_object</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="c1"># forces recalculation of inline_images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_images</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PageObject.merge_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.merge_page">[文档]</a>
    <span class="k">def</span> <span class="nf">merge_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge the content streams of two pages into one.</span>

<span class="sd">        Resource references</span>
<span class="sd">        (i.e. fonts) are maintained from both pages. The mediabox/cropbox/etc</span>
<span class="sd">        of this page are not altered. The parameter page&#39;s content stream will</span>
<span class="sd">        be added to the end of this page&#39;s content stream, meaning that it will</span>
<span class="sd">        be drawn after, or &quot;on top&quot; of this page.</span>

<span class="sd">        Args:</span>
<span class="sd">            page2: The page to be merged into this one. Should be</span>
<span class="sd">                an instance of :class:`PageObject&lt;PageObject&gt;`.</span>
<span class="sd">            over: set the page2 content over page1 if True (default) else under</span>
<span class="sd">            expand: If True, the current page dimensions will be</span>
<span class="sd">                expanded to accommodate the dimensions of the page to be merged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_page</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">over</span><span class="o">=</span><span class="n">over</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="n">expand</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_merge_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span>
        <span class="n">page2transformation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">ContentStream</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ctm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CompressedTransformationMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># First we work on merging the resource dictionaries. This allows us</span>
        <span class="c1"># to find out what symbols in the content streams we might need to</span>
        <span class="c1"># rename.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;_add_object&quot;</span>
            <span class="p">):</span>  <span class="c1"># ---------- to detect PdfWriter</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_page_writer</span><span class="p">(</span>
                    <span class="n">page2</span><span class="p">,</span> <span class="n">page2transformation</span><span class="p">,</span> <span class="n">ctm</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">expand</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">new_resources</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">rename</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">original_resources</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">original_resources</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page2resources</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">page2</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">page2resources</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">new_annots</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                <span class="n">annots</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annots</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                    <span class="n">new_annots</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">annots</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">EXT_G_STATE</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">FONT</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">XOBJECT</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">COLOR_SPACE</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">PATTERN</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">SHADING</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">new</span><span class="p">,</span> <span class="n">newrename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_resources</span><span class="p">(</span>
                <span class="n">original_resources</span><span class="p">,</span> <span class="n">page2resources</span><span class="p">,</span> <span class="n">res</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
                <span class="n">new_resources</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">res</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new</span>
                <span class="n">rename</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">newrename</span><span class="p">)</span>

        <span class="c1"># Combine /ProcSet sets, making sure there&#39;s a consistent order</span>
        <span class="n">new_resources</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">original_resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="n">page2resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">new_content_array</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
        <span class="n">original_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">original_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_content</span><span class="o">.</span><span class="n">isolate_graphics_state</span><span class="p">()</span>
            <span class="n">new_content_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_content</span><span class="p">)</span>

        <span class="n">page2content</span> <span class="o">=</span> <span class="n">page2</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">page2content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">MERGE_CROP_BOX</span><span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="n">FloatObject</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="sa">b</span><span class="s2">&quot;re&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">([],</span> <span class="sa">b</span><span class="s2">&quot;W&quot;</span><span class="p">))</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">([],</span> <span class="sa">b</span><span class="s2">&quot;n&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">page2transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">page2content</span> <span class="o">=</span> <span class="n">page2transformation</span><span class="p">(</span><span class="n">page2content</span><span class="p">)</span>
            <span class="n">page2content</span> <span class="o">=</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">_content_stream_rename</span><span class="p">(</span>
                <span class="n">page2content</span><span class="p">,</span> <span class="n">rename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span>
            <span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">isolate_graphics_state</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">over</span><span class="p">:</span>
                <span class="n">new_content_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page2content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_content_array</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">page2content</span><span class="p">)</span>

        <span class="c1"># if expanding the page to fit a new page, calculate the new media box size</span>
        <span class="k">if</span> <span class="n">expand</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_mediabox</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">ctm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replace_contents</span><span class="p">(</span><span class="n">ContentStream</span><span class="p">(</span><span class="n">new_content_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_resources</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_annots</span>

    <span class="k">def</span> <span class="nf">_merge_page_writer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span>
        <span class="n">page2transformation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">ContentStream</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ctm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CompressedTransformationMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># First we work on merging the resource dictionaries. This allows us</span>
        <span class="c1"># to find which symbols in the content streams we might need to</span>
        <span class="c1"># rename.</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span>

        <span class="n">rename</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">original_resources</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page2</span><span class="p">:</span>
            <span class="n">page2resources</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">page2resources</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">page2</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">EXT_G_STATE</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">FONT</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">XOBJECT</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">COLOR_SPACE</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">PATTERN</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">SHADING</span><span class="p">,</span>
            <span class="n">RES</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">page2resources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">res</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_resources</span><span class="p">:</span>
                    <span class="n">original_resources</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">res</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">newrename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_resources</span><span class="p">(</span>
                    <span class="n">original_resources</span><span class="p">,</span> <span class="n">page2resources</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">rename</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">newrename</span><span class="p">)</span>
        <span class="c1"># Combine /ProcSet sets.</span>
        <span class="k">if</span> <span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span> <span class="ow">in</span> <span class="n">page2resources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_resources</span><span class="p">:</span>
                <span class="n">original_resources</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">original_resources</span><span class="p">[</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page2resources</span><span class="p">[</span><span class="n">RES</span><span class="o">.</span><span class="n">PROC_SET</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="n">page2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="n">annots</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">ctm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">trsf</span> <span class="o">=</span> <span class="n">Transformation</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trsf</span> <span class="o">=</span> <span class="n">Transformation</span><span class="p">(</span><span class="n">ctm</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page2</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span>
                    <span class="n">pdf</span><span class="p">,</span>
                    <span class="n">ignore_fields</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/P&quot;</span><span class="p">,</span> <span class="s2">&quot;/StructParent&quot;</span><span class="p">,</span> <span class="s2">&quot;/Parent&quot;</span><span class="p">),</span>
                    <span class="n">force_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;/Rect&quot;</span><span class="p">])</span>
                <span class="n">pt1</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">pt2</span> <span class="o">=</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">aa</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Rect&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;/QuadPoints&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;/QuadPoints&quot;</span><span class="p">])</span>
                    <span class="n">aa</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/QuadPoints&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span>
                        <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">trsf</span><span class="o">.</span><span class="n">apply_on</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">aa</span><span class="p">[</span><span class="s2">&quot;/Popup&quot;</span><span class="p">][</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Parent&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">aa</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">aa</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/P&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span>
                    <span class="n">annots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">new_content_array</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
        <span class="n">original_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">original_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_content</span><span class="o">.</span><span class="n">isolate_graphics_state</span><span class="p">()</span>
            <span class="n">new_content_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_content</span><span class="p">)</span>

        <span class="n">page2content</span> <span class="o">=</span> <span class="n">page2</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">page2content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">MERGE_CROP_BOX</span><span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="n">FloatObject</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                            <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="sa">b</span><span class="s2">&quot;re&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">([],</span> <span class="sa">b</span><span class="s2">&quot;W&quot;</span><span class="p">))</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">([],</span> <span class="sa">b</span><span class="s2">&quot;n&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">page2transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">page2content</span> <span class="o">=</span> <span class="n">page2transformation</span><span class="p">(</span><span class="n">page2content</span><span class="p">)</span>
            <span class="n">page2content</span> <span class="o">=</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">_content_stream_rename</span><span class="p">(</span>
                <span class="n">page2content</span><span class="p">,</span> <span class="n">rename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span>
            <span class="p">)</span>
            <span class="n">page2content</span><span class="o">.</span><span class="n">isolate_graphics_state</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">over</span><span class="p">:</span>
                <span class="n">new_content_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page2content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_content_array</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">page2content</span><span class="p">)</span>

        <span class="c1"># if expanding the page to fit a new page, calculate the new media box size</span>
        <span class="k">if</span> <span class="n">expand</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_mediabox</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">ctm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replace_contents</span><span class="p">(</span><span class="n">new_content_array</span><span class="p">)</span>
        <span class="c1"># self[NameObject(PG.CONTENTS)] = ContentStream(new_content_array, pdf)</span>
        <span class="c1"># self[NameObject(PG.RESOURCES)] = new_resources</span>
        <span class="c1"># self[NameObject(PG.ANNOTS)] = new_annots</span>

    <span class="k">def</span> <span class="nf">_expand_mediabox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">ctm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CompressedTransformationMatrix</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">corners1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">corners2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ctm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ctm</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ctm</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
            <span class="n">new_x</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">ctm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">new_y</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">ctm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_x</span> <span class="o">=</span> <span class="n">corners2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">new_y</span> <span class="o">=</span> <span class="n">corners2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">lowerleft</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">new_x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_y</span><span class="p">))</span>
        <span class="n">upperright</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">new_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">new_y</span><span class="p">))</span>
        <span class="n">lowerleft</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">corners1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lowerleft</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="n">corners1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lowerleft</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">upperright</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">corners1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">upperright</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">corners1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">upperright</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">lower_left</span> <span class="o">=</span> <span class="n">lowerleft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">upper_right</span> <span class="o">=</span> <span class="n">upperright</span>

<div class="viewcode-block" id="PageObject.merge_transformed_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.merge_transformed_page">[文档]</a>
    <span class="k">def</span> <span class="nf">merge_transformed_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span>
        <span class="n">ctm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CompressedTransformationMatrix</span><span class="p">,</span> <span class="n">Transformation</span><span class="p">],</span>
        <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        merge_transformed_page is similar to merge_page, but a transformation</span>
<span class="sd">        matrix is applied to the merged stream.</span>

<span class="sd">        Args:</span>
<span class="sd">          page2: The page to be merged into this one.</span>
<span class="sd">          ctm: a 6-element tuple containing the operands of the</span>
<span class="sd">                 transformation matrix</span>
<span class="sd">          over: set the page2 content over page1 if True (default) else under</span>
<span class="sd">          expand: Whether the page should be expanded to fit the dimensions</span>
<span class="sd">            of the page to be merged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctm</span><span class="p">,</span> <span class="n">Transformation</span><span class="p">):</span>
            <span class="n">ctm</span> <span class="o">=</span> <span class="n">ctm</span><span class="o">.</span><span class="n">ctm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_page</span><span class="p">(</span>
            <span class="n">page2</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">page2Content</span><span class="p">:</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">_add_transformation_matrix</span><span class="p">(</span>
                <span class="n">page2Content</span><span class="p">,</span> <span class="n">page2</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">CompressedTransformationMatrix</span><span class="p">,</span> <span class="n">ctm</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">ctm</span><span class="p">,</span>
            <span class="n">over</span><span class="p">,</span>
            <span class="n">expand</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.merge_scaled_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.merge_scaled_page">[文档]</a>
    <span class="k">def</span> <span class="nf">merge_scaled_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        merge_scaled_page is similar to merge_page, but the stream to be merged</span>
<span class="sd">        is scaled by applying a transformation matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">          page2: The page to be merged into this one.</span>
<span class="sd">          scale: The scaling factor</span>
<span class="sd">          over: set the page2 content over page1 if True (default) else under</span>
<span class="sd">          expand: Whether the page should be expanded to fit the</span>
<span class="sd">            dimensions of the page to be merged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">Transformation</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_transformed_page</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">expand</span><span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.merge_rotated_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.merge_rotated_page">[文档]</a>
    <span class="k">def</span> <span class="nf">merge_rotated_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        merge_rotated_page is similar to merge_page, but the stream to be merged</span>
<span class="sd">        is rotated by applying a transformation matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">          page2: The page to be merged into this one.</span>
<span class="sd">          rotation: The angle of the rotation, in degrees</span>
<span class="sd">          over: set the page2 content over page1 if True (default) else under</span>
<span class="sd">          expand: Whether the page should be expanded to fit the</span>
<span class="sd">            dimensions of the page to be merged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">Transformation</span><span class="p">()</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_transformed_page</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">expand</span><span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.merge_translated_page">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.merge_translated_page">[文档]</a>
    <span class="k">def</span> <span class="nf">merge_translated_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page2</span><span class="p">:</span> <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span>
        <span class="n">tx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">ty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">over</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mergeTranslatedPage is similar to merge_page, but the stream to be</span>
<span class="sd">        merged is translated by applying a transformation matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">          page2: the page to be merged into this one.</span>
<span class="sd">          tx: The translation on X axis</span>
<span class="sd">          ty: The translation on Y axis</span>
<span class="sd">          over: set the page2 content over page1 if True (default) else under</span>
<span class="sd">          expand: Whether the page should be expanded to fit the</span>
<span class="sd">            dimensions of the page to be merged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">Transformation</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_transformed_page</span><span class="p">(</span><span class="n">page2</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">expand</span><span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.add_transformation">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.add_transformation">[文档]</a>
    <span class="k">def</span> <span class="nf">add_transformation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ctm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Transformation</span><span class="p">,</span> <span class="n">CompressedTransformationMatrix</span><span class="p">],</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a transformation matrix to the page.</span>

<span class="sd">        Args:</span>
<span class="sd">            ctm: A 6-element tuple containing the operands of the</span>
<span class="sd">                transformation matrix. Alternatively, a</span>
<span class="sd">                :py:class:`Transformation&lt;pypdf.Transformation&gt;`</span>
<span class="sd">                object can be passed.</span>

<span class="sd">        See :doc:`/user/cropping-and-transforming`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctm</span><span class="p">,</span> <span class="n">Transformation</span><span class="p">):</span>
            <span class="n">ctm</span> <span class="o">=</span> <span class="n">ctm</span><span class="o">.</span><span class="n">ctm</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">_add_transformation_matrix</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="n">ctm</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">isolate_graphics_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replace_contents</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># if expanding the page to fit a new page, calculate the new media box size</span>
        <span class="k">if</span> <span class="n">expand</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">as_numeric</span><span class="p">(),</span>
            <span class="p">]</span>

            <span class="n">ctm</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ctm</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
            <span class="n">new_x</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ctm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">new_y</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ctm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">corners</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctm</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">lowerleft</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">new_x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_y</span><span class="p">))</span>
            <span class="n">upperright</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">new_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">new_y</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">lower_left</span> <span class="o">=</span> <span class="n">lowerleft</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">upper_right</span> <span class="o">=</span> <span class="n">upperright</span></div>


<div class="viewcode-block" id="PageObject.scale">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.scale">[文档]</a>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale a page by the given factors by applying a transformation matrix</span>
<span class="sd">        to its content and updating the page size.</span>

<span class="sd">        This updates the mediabox, the cropbox, and the contents</span>
<span class="sd">        of the page.</span>

<span class="sd">        Args:</span>
<span class="sd">            sx: The scaling factor on horizontal axis.</span>
<span class="sd">            sy: The scaling factor on vertical axis.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_transformation</span><span class="p">((</span><span class="n">sx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cropbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropbox</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">artbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">artbox</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bleedbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bleedbox</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trimbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trimbox</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
                    <span class="n">annotation_obj</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">ADA</span><span class="o">.</span><span class="n">Rect</span> <span class="ow">in</span> <span class="n">annotation_obj</span><span class="p">:</span>
                        <span class="n">rectangle</span> <span class="o">=</span> <span class="n">annotation_obj</span><span class="p">[</span><span class="n">ADA</span><span class="o">.</span><span class="n">Rect</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rectangle</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                            <span class="n">rectangle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">FloatObject</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rectangle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">sx</span><span class="p">)</span>
                            <span class="n">rectangle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">FloatObject</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rectangle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sy</span><span class="p">)</span>
                            <span class="n">rectangle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">FloatObject</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rectangle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">sx</span><span class="p">)</span>
                            <span class="n">rectangle</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">FloatObject</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rectangle</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">sy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">VP</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">viewport</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">VP</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">viewport</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">viewport</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;/BBox&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">viewport</span><span class="p">[</span><span class="s2">&quot;/BBox&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="n">scaled_bbox</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sy</span><span class="p">,</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">sy</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">viewport</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">VP</span><span class="p">)][</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)][</span>  <span class="c1"># type: ignore</span>
                    <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/BBox&quot;</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">scaled_bbox</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">VP</span><span class="p">)][</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/BBox&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">scaled_bbox</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="PageObject.scale_by">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.scale_by">[文档]</a>
    <span class="k">def</span> <span class="nf">scale_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale a page by the given factor by applying a transformation matrix to</span>
<span class="sd">        its content and updating the page size.</span>

<span class="sd">        Args:</span>
<span class="sd">            factor: The scaling factor (for both X and Y axis).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.scale_to">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.scale_to">[文档]</a>
    <span class="k">def</span> <span class="nf">scale_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale a page to the specified dimensions by applying a transformation</span>
<span class="sd">        matrix to its content and updating the page size.</span>

<span class="sd">        Args:</span>
<span class="sd">            width: The new width.</span>
<span class="sd">            height: The new height.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.compress_content_streams">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.compress_content_streams">[文档]</a>
    <span class="k">def</span> <span class="nf">compress_content_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compress the size of this page by joining all content streams and</span>
<span class="sd">        applying a FlateDecode filter.</span>

<span class="sd">        However, it is possible that this function will perform no action if</span>
<span class="sd">        content stream compression becomes &quot;automatic&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content_obj</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">flate_encode</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span>  <span class="c1"># type: ignore</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">content_obj</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;_add_object&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">replace_contents</span><span class="p">(</span><span class="n">content_obj</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Page must be part of a PdfWriter&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">page_number</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read-only property which returns the page number within the PDF file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int : page number; None if the page is not attached to a PDF.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">pages</span>
                <span class="k">return</span> <span class="n">lst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_debug_for_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ope</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ContentStream</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;/Contents&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;bytes&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;TJ&quot;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ope</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">op</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">ope</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=============================</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">][</span><span class="s2">&quot;/Font&quot;</span><span class="p">]:</span>  <span class="c1"># type:ignore</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">fo</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">][</span><span class="s2">&quot;/Font&quot;</span><span class="p">][</span><span class="n">fo</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># type:ignore</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">enc_repr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">][</span><span class="s2">&quot;/Font&quot;</span><span class="p">][</span><span class="n">fo</span><span class="p">][</span>  <span class="c1"># type:ignore</span>
                        <span class="s2">&quot;/Encoding&quot;</span>
                    <span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">enc_repr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">][</span><span class="s2">&quot;/Font&quot;</span><span class="p">][</span><span class="n">fo</span><span class="p">][</span>  <span class="c1"># type:ignore</span>
                            <span class="s2">&quot;/ToUnicode&quot;</span>
                        <span class="p">]</span>
                        <span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;No Font</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_get_actual_font_widths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="n">text_operands</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">font_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">space_width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">font_widths</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">font_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">font_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">font_width_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">space_char</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
                <span class="n">actual_space_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">space_width</span>
                <span class="n">font_width_map</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actual_space_width</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">space_char</span> <span class="o">=</span> <span class="n">get_actual_str_key</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">font_width_map</span> <span class="o">=</span> <span class="n">build_font_width_map</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">space_width</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">actual_space_width</span> <span class="o">=</span> <span class="n">compute_font_width</span><span class="p">(</span><span class="n">font_width_map</span><span class="p">,</span> <span class="n">space_char</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">actual_space_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">actual_space_width</span> <span class="o">=</span> <span class="n">space_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">[</span><span class="n">font_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">font_width_map</span><span class="p">,</span> <span class="n">space_char</span><span class="p">,</span> <span class="n">actual_space_width</span><span class="p">)</span>
        <span class="n">font_width_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">[</span><span class="n">font_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">space_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">[</span><span class="n">font_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">actual_space_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_width_maps</span><span class="p">[</span><span class="n">font_name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">text_operands</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text_operands</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">space_char</span><span class="p">:</span>
                    <span class="n">font_widths</span> <span class="o">+=</span> <span class="n">actual_space_width</span>
                    <span class="k">continue</span>
                <span class="n">font_widths</span> <span class="o">+=</span> <span class="n">compute_font_width</span><span class="p">(</span><span class="n">font_width_map</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">font_widths</span> <span class="o">*</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">space_width</span> <span class="o">*</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_tj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">operands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextStringObject</span><span class="p">]],</span>
        <span class="n">cm_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">tm_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="n">orientations</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">font_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">rtl_dir</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">visitor_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="n">space_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">actual_str_size</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="n">text_operands</span><span class="p">,</span> <span class="n">is_str_operands</span> <span class="o">=</span> <span class="n">get_text_operands</span><span class="p">(</span>
            <span class="n">operands</span><span class="p">,</span> <span class="n">cm_matrix</span><span class="p">,</span> <span class="n">tm_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">orientations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_str_operands</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="n">text_operands</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">rtl_dir</span> <span class="o">=</span> <span class="n">get_display_str</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span>
                <span class="n">cm_matrix</span><span class="p">,</span>
                <span class="n">tm_matrix</span><span class="p">,</span>  <span class="c1"># text matrix</span>
                <span class="n">cmap</span><span class="p">,</span>
                <span class="n">text_operands</span><span class="p">,</span>
                <span class="n">font_size</span><span class="p">,</span>
                <span class="n">rtl_dir</span><span class="p">,</span>
                <span class="n">visitor_text</span><span class="p">)</span>
        <span class="n">font_widths</span><span class="p">,</span> <span class="n">actual_str_size</span><span class="p">[</span><span class="s2">&quot;space_width&quot;</span><span class="p">],</span> <span class="n">actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_actual_font_widths</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">text_operands</span><span class="p">,</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">space_width</span><span class="p">))</span>
        <span class="n">actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_widths&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">font_widths</span>

        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">rtl_dir</span><span class="p">,</span> <span class="n">actual_str_size</span>

    <span class="k">def</span> <span class="nf">_extract_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">pdf</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">orientations</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">),</span>
        <span class="n">space_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span>
        <span class="n">content_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">,</span>
        <span class="n">visitor_operand_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_operand_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See extract_text for most arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            content_key: indicate the default key where to extract data</span>
<span class="sd">                None = the object; this allow to reuse the function on XObject</span>
<span class="sd">                default = &quot;/Content&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">rtl_dir</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># right-to-left</span>
        <span class="n">cmaps</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span>
            <span class="n">Tuple</span><span class="p">[</span>
                <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">DictionaryObject</span>
            <span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objr</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="k">while</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">objr</span><span class="p">:</span>
                <span class="c1"># /Resources can be inherited sometimes so we look to parents</span>
                <span class="n">objr</span> <span class="o">=</span> <span class="n">objr</span><span class="p">[</span><span class="s2">&quot;/Parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="c1"># if no parents we will have no /Resources will be available</span>
                <span class="c1"># =&gt; an exception will be raised</span>
            <span class="n">resources_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">objr</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># no resources means no text is possible (no font) we consider the</span>
            <span class="c1"># file as not damaged, no need to check for TJ or Tj</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/Font&quot;</span> <span class="ow">in</span> <span class="n">resources_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">resources_dict</span><span class="p">[</span><span class="s2">&quot;/Font&quot;</span><span class="p">]):</span>
                <span class="n">cmaps</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_char_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">space_width</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;charmap&quot;</span><span class="p">,</span>
            <span class="p">{},</span>
            <span class="s2">&quot;NotInitialized&quot;</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># (encoding,CMAP,font resource name,dictionary-object of font)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">obj</span><span class="p">[</span><span class="n">content_key</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">obj</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">ContentStream</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;bytes&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># it means no content can be extracted(certainly empty page)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Note: we check all strings are TextStringObjects. ByteStringObjects</span>
        <span class="c1"># are strings where the byte-&gt;string encoding was unknown, so adding</span>
        <span class="c1"># them to the text here would be gibberish.</span>

        <span class="n">cm_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">cm_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tm_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="c1"># cm/tm_prev stores the last modified matrices can be an intermediate position</span>
        <span class="n">cm_prev</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">tm_prev</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="c1"># memo_cm/tm will be used to store the position at the beginning of building the text</span>
        <span class="n">memo_cm</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">memo_tm</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">char_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">space_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">_space_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">500.0</span>  <span class="c1"># will be set correctly at first Tf</span>
        <span class="n">_actual_str_size</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;str_widths&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;space_width&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;str_height&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>  <span class="c1"># will be set to string length calculation result</span>
        <span class="n">TL</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">font_size</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c1"># init just in case of</span>

        <span class="k">def</span> <span class="nf">compute_strwidths</span><span class="p">(</span><span class="n">str_widths</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str_widths</span> <span class="o">/</span> <span class="mf">1000.0</span>

        <span class="k">def</span> <span class="nf">process_operation</span><span class="p">(</span><span class="n">operator</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">operands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">cm_matrix</span><span class="p">,</span> <span class="n">cm_stack</span><span class="p">,</span> <span class="n">tm_matrix</span><span class="p">,</span> <span class="n">cm_prev</span><span class="p">,</span> <span class="n">tm_prev</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span>
            <span class="k">nonlocal</span> <span class="n">char_scale</span><span class="p">,</span> <span class="n">space_scale</span><span class="p">,</span> <span class="n">_space_width</span><span class="p">,</span> <span class="n">TL</span><span class="p">,</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">cmap</span>
            <span class="k">nonlocal</span> <span class="n">orientations</span><span class="p">,</span> <span class="n">rtl_dir</span><span class="p">,</span> <span class="n">visitor_text</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">_actual_str_size</span>
            <span class="k">global</span> <span class="n">CUSTOM_RTL_MIN</span><span class="p">,</span> <span class="n">CUSTOM_RTL_MAX</span><span class="p">,</span> <span class="n">CUSTOM_RTL_SPECIAL_CHARS</span>

            <span class="n">check_crlf_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">str_widths</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c1"># Table 5.4 page 405</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;BT&quot;</span><span class="p">:</span>
                <span class="n">tm_matrix</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>
                <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;ET&quot;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>
                <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># table 4.7 &quot;Graphics state operators&quot;, page 219</span>
            <span class="c1"># cm_matrix calculation is a reserved for the moment</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;q&quot;</span><span class="p">:</span>
                <span class="n">cm_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">cm_matrix</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="p">,</span>
                        <span class="n">font_size</span><span class="p">,</span>
                        <span class="n">char_scale</span><span class="p">,</span>
                        <span class="n">space_scale</span><span class="p">,</span>
                        <span class="n">_space_width</span><span class="p">,</span>
                        <span class="n">TL</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Q&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">cm_matrix</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="p">,</span>
                        <span class="n">font_size</span><span class="p">,</span>
                        <span class="n">char_scale</span><span class="p">,</span>
                        <span class="n">space_scale</span><span class="p">,</span>
                        <span class="n">_space_width</span><span class="p">,</span>
                        <span class="n">TL</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">cm_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">cm_matrix</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;cm&quot;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>
                <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">cm_matrix</span> <span class="o">=</span> <span class="n">mult</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                    <span class="p">],</span>
                    <span class="n">cm_matrix</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Table 5.2 page 398</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Tz&quot;</span><span class="p">:</span>
                <span class="n">char_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Tw&quot;</span><span class="p">:</span>
                <span class="n">space_scale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;TL&quot;</span><span class="p">:</span>
                <span class="n">scale_x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tm_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">TL</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">font_size</span> <span class="o">*</span> <span class="n">scale_x</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Tf&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>  <span class="c1"># .translate(cmap)</span>
                    <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># charMapTuple: font_type, float(sp_width / 2), encoding,</span>
                    <span class="c1">#               map_dict, font-dictionary</span>
                    <span class="n">charMapTuple</span> <span class="o">=</span> <span class="n">cmaps</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">_space_width</span> <span class="o">=</span> <span class="n">charMapTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># current cmap: encoding, map_dict, font resource name</span>
                    <span class="c1">#               (internal name, not the real font-name),</span>
                    <span class="c1"># font-dictionary. The font-dictionary describes the font.</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">charMapTuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">charMapTuple</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">charMapTuple</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># font not found</span>
                    <span class="n">_space_width</span> <span class="o">=</span> <span class="n">unknown_char_map</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">unknown_char_map</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">unknown_char_map</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s2">&quot;???</span><span class="si">{</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">font_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># keep previous size</span>
            <span class="c1"># Table 5.5 page 406</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Td&quot;</span><span class="p">:</span>
                <span class="n">check_crlf_space</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># A special case is a translating only tm:</span>
                <span class="c1"># tm[0..5] = 1 0 0 1 e f,</span>
                <span class="c1"># i.e. tm[4] += tx, tm[5] += ty.</span>
                <span class="n">tx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ty</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tx</span> <span class="o">*</span> <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ty</span> <span class="o">*</span> <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tx</span> <span class="o">*</span> <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ty</span> <span class="o">*</span> <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">str_widths</span> <span class="o">=</span> <span class="n">compute_strwidths</span><span class="p">(</span><span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_widths&quot;</span><span class="p">])</span>
                <span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_widths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Tm&quot;</span><span class="p">:</span>
                <span class="n">check_crlf_space</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">tm_matrix</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                <span class="p">]</span>
                <span class="n">str_widths</span> <span class="o">=</span> <span class="n">compute_strwidths</span><span class="p">(</span><span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_widths&quot;</span><span class="p">])</span>
                <span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_widths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;T*&quot;</span><span class="p">:</span>
                <span class="n">check_crlf_space</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">tm_matrix</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-=</span> <span class="n">TL</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">:</span>
                <span class="n">check_crlf_space</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">text</span><span class="p">,</span> <span class="n">rtl_dir</span><span class="p">,</span> <span class="n">_actual_str_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_tj</span><span class="p">(</span>
                    <span class="n">text</span><span class="p">,</span>
                    <span class="n">operands</span><span class="p">,</span>
                    <span class="n">cm_matrix</span><span class="p">,</span>
                    <span class="n">tm_matrix</span><span class="p">,</span>  <span class="c1"># text matrix</span>
                    <span class="n">cmap</span><span class="p">,</span>
                    <span class="n">orientations</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="p">,</span>
                    <span class="n">rtl_dir</span><span class="p">,</span>
                    <span class="n">visitor_text</span><span class="p">,</span>
                    <span class="n">_space_width</span><span class="p">,</span>
                    <span class="n">_actual_str_size</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">check_crlf_space</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">cm_prev</span><span class="p">,</span> <span class="n">tm_prev</span> <span class="o">=</span> <span class="n">crlf_space_check</span><span class="p">(</span>
                        <span class="n">text</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">cm_prev</span><span class="p">,</span> <span class="n">tm_prev</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">cm_matrix</span><span class="p">,</span> <span class="n">tm_matrix</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="p">,</span>
                        <span class="n">orientations</span><span class="p">,</span>
                        <span class="n">output</span><span class="p">,</span>
                        <span class="n">font_size</span><span class="p">,</span>
                        <span class="n">visitor_text</span><span class="p">,</span>
                        <span class="n">str_widths</span><span class="p">,</span>
                        <span class="n">compute_strwidths</span><span class="p">(</span><span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;space_width&quot;</span><span class="p">]),</span>
                        <span class="n">_actual_str_size</span><span class="p">[</span><span class="s2">&quot;str_height&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">OrientationNotFoundError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">operands</span><span class="p">,</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">visitor_operand_before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">visitor_operand_before</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operands</span><span class="p">,</span> <span class="n">cm_matrix</span><span class="p">,</span> <span class="n">tm_matrix</span><span class="p">)</span>
            <span class="c1"># multiple operators are defined in here ####</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&#39;&quot;</span><span class="p">:</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;T*&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tw&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tc&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;T*&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">,</span> <span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;TD&quot;</span><span class="p">:</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TL&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Td&quot;</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;TJ&quot;</span><span class="p">:</span>
                <span class="c1"># The space width may be smaller than the font width, so the width should be 95%.</span>
                <span class="n">_confirm_space_width</span> <span class="o">=</span> <span class="n">_space_width</span> <span class="o">*</span> <span class="mf">0.95</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
                        <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">op</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NumberObject</span><span class="p">,</span> <span class="n">FloatObject</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">op</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">_confirm_space_width</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">process_operation</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Do&quot;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>
                <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">visitor_text</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">memo_cm</span><span class="p">,</span>
                                <span class="n">memo_tm</span><span class="p">,</span>
                                <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">font_size</span><span class="p">,</span>
                            <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xobj</span> <span class="o">=</span> <span class="n">resources_dict</span><span class="p">[</span><span class="s2">&quot;/XObject&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">xobj</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/Image&quot;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_xform_text</span><span class="p">(</span>
                            <span class="n">xobj</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>  <span class="c1"># type: ignore</span>
                            <span class="n">orientations</span><span class="p">,</span>
                            <span class="n">space_width</span><span class="p">,</span>
                            <span class="n">visitor_operand_before</span><span class="p">,</span>
                            <span class="n">visitor_operand_after</span><span class="p">,</span>
                            <span class="n">visitor_text</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>
                        <span class="k">if</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">visitor_text</span><span class="p">(</span>
                                <span class="n">text</span><span class="p">,</span>
                                <span class="n">memo_cm</span><span class="p">,</span>
                                <span class="n">memo_tm</span><span class="p">,</span>
                                <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">font_size</span><span class="p">,</span>
                            <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger_warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot; impossible to decode XFormObject </span><span class="si">{</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">memo_cm</span> <span class="o">=</span> <span class="n">cm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">memo_tm</span> <span class="o">=</span> <span class="n">tm_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">process_operation</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">visitor_operand_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">visitor_operand_after</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operands</span><span class="p">,</span> <span class="n">cm_matrix</span><span class="p">,</span> <span class="n">tm_matrix</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">text</span>  <span class="c1"># just in case of</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">visitor_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visitor_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">memo_cm</span><span class="p">,</span> <span class="n">memo_tm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_layout_mode_fonts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">Font</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get fonts formatted for &quot;layout&quot; mode text extraction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Font]: dictionary of _layout_mode.Font instances keyed by font name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Font retrieval logic adapted from pypdf.PageObject._extract_text()</span>
        <span class="n">objr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">fonts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">Font</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="n">objr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resources_dict</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">objr</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">RESOURCES</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">resources_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s2">&quot;/Font&quot;</span> <span class="ow">in</span> <span class="n">resources_dict</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">font_name</span> <span class="ow">in</span> <span class="n">resources_dict</span><span class="p">[</span><span class="s2">&quot;/Font&quot;</span><span class="p">]:</span>
                    <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="n">font_dict_obj</span> <span class="o">=</span> <span class="n">build_char_map</span><span class="p">(</span><span class="n">font_name</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="n">font_dict</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
                        <span class="k">else</span> <span class="p">[</span><span class="n">_v</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">)</span>
                        <span class="k">else</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">font_dict_obj</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>
                    <span class="c1"># mypy really sucks at unpacking</span>
                    <span class="n">fonts</span><span class="p">[</span><span class="n">font_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="n">font_dict</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg,arg-type]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">objr</span> <span class="o">=</span> <span class="n">objr</span><span class="p">[</span><span class="s2">&quot;/Parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">objr</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">fonts</span>

    <span class="k">def</span> <span class="nf">_layout_mode_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">space_vertically</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scale_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">,</span>
        <span class="n">strip_rotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">debug_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">font_height_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get text preserving fidelity to source PDF text layout.</span>

<span class="sd">        Args:</span>
<span class="sd">            space_vertically: include blank lines inferred from y distance + font</span>
<span class="sd">                height. Defaults to True.</span>
<span class="sd">            scale_weight: multiplier for string length when calculating weighted</span>
<span class="sd">                average character width. Defaults to 1.25.</span>
<span class="sd">            strip_rotated: Removes text that is rotated w.r.t. to the page from</span>
<span class="sd">                layout mode output. Defaults to True.</span>
<span class="sd">            debug_path (Path | None): if supplied, must target a directory.</span>
<span class="sd">                creates the following files with debug information for layout mode</span>
<span class="sd">                functions if supplied:</span>
<span class="sd">                  - fonts.json: output of self._layout_mode_fonts</span>
<span class="sd">                  - tjs.json: individual text render ops with corresponding transform matrices</span>
<span class="sd">                  - bts.json: text render ops left justified and grouped by BT/ET operators</span>
<span class="sd">                  - bt_groups.json: BT/ET operations grouped by rendered y-coord (aka lines)</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            font_height_weight: multiplier for font height when calculating</span>
<span class="sd">                blank lines. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: multiline string containing page text in a fixed width format that</span>
<span class="sd">                closely adheres to the rendered layout in the source pdf.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fonts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_mode_fonts</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">debug_path</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="kn">import</span> <span class="nn">json</span>

            <span class="n">debug_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fonts.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                    <span class="n">fonts</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ops</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
            <span class="n">ContentStream</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;/Contents&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;bytes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">operations</span>
        <span class="p">)</span>
        <span class="n">bt_groups</span> <span class="o">=</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">text_show_operations</span><span class="p">(</span>
            <span class="n">ops</span><span class="p">,</span> <span class="n">fonts</span><span class="p">,</span> <span class="n">strip_rotated</span><span class="p">,</span> <span class="n">debug_path</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bt_groups</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">ty_groups</span> <span class="o">=</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">y_coordinate_groups</span><span class="p">(</span><span class="n">bt_groups</span><span class="p">,</span> <span class="n">debug_path</span><span class="p">)</span>

        <span class="n">char_width</span> <span class="o">=</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">fixed_char_width</span><span class="p">(</span><span class="n">bt_groups</span><span class="p">,</span> <span class="n">scale_weight</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_layout_mode</span><span class="o">.</span><span class="n">fixed_width_page</span><span class="p">(</span><span class="n">ty_groups</span><span class="p">,</span> <span class="n">char_width</span><span class="p">,</span> <span class="n">space_vertically</span><span class="p">,</span> <span class="n">font_height_weight</span><span class="p">)</span>

<div class="viewcode-block" id="PageObject.extract_text">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.extract_text">[文档]</a>
    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">orientations</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">),</span>
        <span class="n">space_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span>
        <span class="n">visitor_operand_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_operand_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extraction_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;plain&quot;</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;plain&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Locate all text drawing commands, in the order they are provided in the</span>
<span class="sd">        content stream, and extract the text.</span>

<span class="sd">        This works well for some PDF files, but poorly for others, depending on</span>
<span class="sd">        the generator used. This will be refined in the future.</span>

<span class="sd">        Do not rely on the order of text coming out of this function, as it</span>
<span class="sd">        will change if this function is made more sophisticated.</span>

<span class="sd">        Arabic and Hebrew are extracted in the correct order.</span>
<span class="sd">        If required a custom RTL range of characters can be defined;</span>
<span class="sd">        see function set_custom_rtl.</span>

<span class="sd">        Additionally you can provide visitor methods to get informed on all</span>
<span class="sd">        operations and all text objects.</span>
<span class="sd">        For example in some PDF files this can be useful to parse tables.</span>

<span class="sd">        Args:</span>
<span class="sd">            orientations: list of orientations extract_text will look for</span>
<span class="sd">                default = (0, 90, 180, 270)</span>
<span class="sd">                note: currently only 0 (up),90 (turned left), 180 (upside down),</span>
<span class="sd">                270 (turned right)</span>
<span class="sd">                Silently ignored in &quot;layout&quot; mode.</span>
<span class="sd">            space_width: force default space width</span>
<span class="sd">                if not extracted from font (default: 200)</span>
<span class="sd">                Silently ignored in &quot;layout&quot; mode.</span>
<span class="sd">            visitor_operand_before: function to be called before processing an operation.</span>
<span class="sd">                It has four arguments: operator, operand-arguments,</span>
<span class="sd">                current transformation matrix and text matrix.</span>
<span class="sd">                Ignored with a warning in &quot;layout&quot; mode.</span>
<span class="sd">            visitor_operand_after: function to be called after processing an operation.</span>
<span class="sd">                It has four arguments: operator, operand-arguments,</span>
<span class="sd">                current transformation matrix and text matrix.</span>
<span class="sd">                Ignored with a warning in &quot;layout&quot; mode.</span>
<span class="sd">            visitor_text: function to be called when extracting some text at some position.</span>
<span class="sd">                It has five arguments: text, current transformation matrix,</span>
<span class="sd">                text matrix, font-dictionary and font-size.</span>
<span class="sd">                The font-dictionary may be None in case of unknown fonts.</span>
<span class="sd">                If not None it may e.g. contain key &quot;/BaseFont&quot; with value &quot;/Arial,Bold&quot;.</span>
<span class="sd">                Ignored with a warning in &quot;layout&quot; mode.</span>
<span class="sd">            extraction_mode (Literal[&quot;plain&quot;, &quot;layout&quot;]): &quot;plain&quot; for legacy functionality,</span>
<span class="sd">                &quot;layout&quot; for experimental layout mode functionality.</span>
<span class="sd">                NOTE: orientations, space_width, and visitor_* parameters are NOT respected</span>
<span class="sd">                in &quot;layout&quot; mode.</span>

<span class="sd">        kwargs:</span>
<span class="sd">            layout_mode_space_vertically (bool): include blank lines inferred from</span>
<span class="sd">                y distance + font height. Defaults to True.</span>
<span class="sd">            layout_mode_scale_weight (float): multiplier for string length when calculating</span>
<span class="sd">                weighted average character width. Defaults to 1.25.</span>
<span class="sd">            layout_mode_strip_rotated (bool): layout mode does not support rotated text.</span>
<span class="sd">                Set to False to include rotated text anyway. If rotated text is discovered,</span>
<span class="sd">                layout will be degraded and a warning will result. Defaults to True.</span>
<span class="sd">            layout_mode_debug_path (Path | None): if supplied, must target a directory.</span>
<span class="sd">                creates the following files with debug information for layout mode</span>
<span class="sd">                functions if supplied:</span>

<span class="sd">                  - fonts.json: output of self._layout_mode_fonts</span>
<span class="sd">                  - tjs.json: individual text render ops with corresponding transform matrices</span>
<span class="sd">                  - bts.json: text render ops left justified and grouped by BT/ET operators</span>
<span class="sd">                  - bt_groups.json: BT/ET operations grouped by rendered y-coord (aka lines)</span>
<span class="sd">            layout_mode_font_height_weight (float): multiplier for font height when calculating</span>
<span class="sd">                blank lines. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The extracted text</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">extraction_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;plain&quot;</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid text extraction mode &#39;</span><span class="si">{</span><span class="n">extraction_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extraction_mode</span> <span class="o">==</span> <span class="s2">&quot;layout&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">visitor</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;visitor_operand_before&quot;</span><span class="p">,</span>
                <span class="s2">&quot;visitor_operand_after&quot;</span><span class="p">,</span>
                <span class="s2">&quot;visitor_text&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">visitor</span><span class="p">]:</span>
                    <span class="n">logger_warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Argument </span><span class="si">{</span><span class="n">visitor</span><span class="si">}</span><span class="s2"> is ignored in layout mode&quot;</span><span class="p">,</span>
                        <span class="vm">__name__</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_mode_text</span><span class="p">(</span>
                <span class="n">space_vertically</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout_mode_space_vertically&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">scale_weight</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout_mode_scale_weight&quot;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
                <span class="n">strip_rotated</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout_mode_strip_rotated&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">debug_path</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout_mode_debug_path&quot;</span><span class="p">),</span>
                <span class="n">font_height_weight</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout_mode_font_height_weight&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                        <span class="n">orientations</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid positional parameter </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                        <span class="n">space_width</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid positional parameter </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">orientations</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                        <span class="n">space_width</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid positional parameter </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid positional parameter </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">orientations</span> <span class="o">=</span> <span class="p">(</span><span class="n">orientations</span><span class="p">,)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_text</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span>
            <span class="n">orientations</span><span class="p">,</span>
            <span class="n">space_width</span><span class="p">,</span>
            <span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">,</span>
            <span class="n">visitor_operand_before</span><span class="p">,</span>
            <span class="n">visitor_operand_after</span><span class="p">,</span>
            <span class="n">visitor_text</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PageObject.extract_xform_text">
<a class="viewcode-back" href="../../modules/PageObject.html#pypdf._page.PageObject.extract_xform_text">[文档]</a>
    <span class="k">def</span> <span class="nf">extract_xform_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xform</span><span class="p">:</span> <span class="n">EncodedStreamObject</span><span class="p">,</span>
        <span class="n">orientations</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span>
        <span class="n">space_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span>
        <span class="n">visitor_operand_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_operand_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visitor_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract text from an XObject.</span>

<span class="sd">        Args:</span>
<span class="sd">            xform:</span>
<span class="sd">            orientations:</span>
<span class="sd">            space_width:  force default space width (if not extracted from font (default 200)</span>
<span class="sd">            visitor_operand_before:</span>
<span class="sd">            visitor_operand_after:</span>
<span class="sd">            visitor_text:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The extracted text</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_text</span><span class="p">(</span>
            <span class="n">xform</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span>
            <span class="n">orientations</span><span class="p">,</span>
            <span class="n">space_width</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">visitor_operand_before</span><span class="p">,</span>
            <span class="n">visitor_operand_after</span><span class="p">,</span>
            <span class="n">visitor_text</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_fonts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of embedded fonts and unembedded fonts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (Set of embedded fonts, set of unembedded fonts)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">)</span>
        <span class="n">fonts</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">embedded</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">fonts</span><span class="p">,</span> <span class="n">embedded</span> <span class="o">=</span> <span class="n">_get_fonts_walk</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fonts</span><span class="p">,</span> <span class="n">embedded</span><span class="p">)</span>
        <span class="n">unembedded</span> <span class="o">=</span> <span class="n">fonts</span> <span class="o">-</span> <span class="n">embedded</span>
        <span class="k">return</span> <span class="n">embedded</span><span class="p">,</span> <span class="n">unembedded</span>

    <span class="n">mediabox</span> <span class="o">=</span> <span class="n">_create_rectangle_accessor</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">,</span> <span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;`, expressed in</span>
<span class="sd">    default user space units, defining the boundaries of the physical medium on</span>
<span class="sd">    which the page is intended to be displayed or printed.&quot;&quot;&quot;</span>

    <span class="n">cropbox</span> <span class="o">=</span> <span class="n">_create_rectangle_accessor</span><span class="p">(</span><span class="s2">&quot;/CropBox&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">,))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;`, expressed in</span>
<span class="sd">    default user space units, defining the visible region of default user</span>
<span class="sd">    space.</span>

<span class="sd">    When the page is displayed or printed, its contents are to be clipped</span>
<span class="sd">    (cropped) to this rectangle and then imposed on the output medium in some</span>
<span class="sd">    implementation-defined manner. Default value: same as</span>
<span class="sd">    :attr:`mediabox&lt;mediabox&gt;`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bleedbox</span> <span class="o">=</span> <span class="n">_create_rectangle_accessor</span><span class="p">(</span><span class="s2">&quot;/BleedBox&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/CropBox&quot;</span><span class="p">,</span> <span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;`, expressed in</span>
<span class="sd">    default user space units, defining the region to which the contents of the</span>
<span class="sd">    page should be clipped when output in a production environment.&quot;&quot;&quot;</span>

    <span class="n">trimbox</span> <span class="o">=</span> <span class="n">_create_rectangle_accessor</span><span class="p">(</span><span class="s2">&quot;/TrimBox&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/CropBox&quot;</span><span class="p">,</span> <span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;`, expressed in</span>
<span class="sd">    default user space units, defining the intended dimensions of the finished</span>
<span class="sd">    page after trimming.&quot;&quot;&quot;</span>

    <span class="n">artbox</span> <span class="o">=</span> <span class="n">_create_rectangle_accessor</span><span class="p">(</span><span class="s2">&quot;/ArtBox&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/CropBox&quot;</span><span class="p">,</span> <span class="n">PG</span><span class="o">.</span><span class="n">MEDIABOX</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;`, expressed in</span>
<span class="sd">    default user space units, defining the extent of the page&#39;s meaningful</span>
<span class="sd">    content as intended by the page&#39;s creator.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayObject</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s2">&quot;/Annots&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;/Annots&quot;</span><span class="p">])</span>

    <span class="nd">@annotations</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the annotations array of the page.</span>

<span class="sd">        Typically you do not want to set this value, but append to it.</span>
<span class="sd">        If you append to it, remember to add the object first to the writer</span>
<span class="sd">        and only add the indirect object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span></div>



<span class="k">class</span> <span class="nc">_VirtualList</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">length_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">get_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="n">PageObject</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length_function</span> <span class="o">=</span> <span class="n">length_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span> <span class="o">=</span> <span class="n">get_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_function</span><span class="p">()</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">PageObject</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">indices</span><span class="o">.</span><span class="fm">__len__</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">idx</span><span class="p">:</span> <span class="bp">self</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Sequence indices must be integers&quot;</span><span class="p">)</span>
        <span class="n">len_self</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># support negative indexes</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">len_self</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">len_self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Sequence index out of range&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>
            <span class="c1"># pages have to be deleted from last to first</span>
            <span class="n">r</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>  <span class="c1"># recursive call</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Index must be integers&quot;</span><span class="p">)</span>
        <span class="n">len_self</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># support negative indexes</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">len_self</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">len_self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Index out of range&quot;</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="k">assert</span> <span class="n">ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">ind</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;/Parent&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">parent</span><span class="p">[</span><span class="s2">&quot;/Kids&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">parent</span><span class="p">[</span><span class="s2">&quot;/Kids&quot;</span><span class="p">])[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">del</span> <span class="n">ind</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># case of page in a Reader</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="s2">&quot;/Count&quot;</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
                    <span class="n">parent</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Count&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span>
                        <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">parent</span><span class="p">[</span><span class="s2">&quot;/Count&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">parent</span><span class="p">[</span><span class="s2">&quot;/Kids&quot;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># No more objects in this part of this sub tree</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Parent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># from index</span>
                <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PdfReadError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page not found in page tree: </span><span class="si">{</span><span class="n">ind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PageObject(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_function</span><span class="p">())]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>


<span class="k">def</span> <span class="nf">_get_fonts_walk</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>
    <span class="n">fnt</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">emb</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the set of all fonts and all embedded fonts.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj: Page resources dictionary</span>
<span class="sd">        fnt: font</span>
<span class="sd">        emb: embedded fonts</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple (fnt, emb)</span>

<span class="sd">    If there is a key called &#39;BaseFont&#39;, that is a font that is used in the document.</span>
<span class="sd">    If there is a key called &#39;FontName&#39; and another key in the same dictionary object</span>
<span class="sd">    that is called &#39;FontFilex&#39; (where x is null, 2, or 3), then that fontname is</span>
<span class="sd">    embedded.</span>

<span class="sd">    We create and add to two sets, fnt = fonts used and emb = fonts embedded.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fontkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/FontFile&quot;</span><span class="p">,</span> <span class="s2">&quot;/FontFile2&quot;</span><span class="p">,</span> <span class="s2">&quot;/FontFile3&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_font</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">fnt</span><span class="p">,</span> <span class="n">emb</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>  <span class="c1"># to be sure</span>
        <span class="k">if</span> <span class="s2">&quot;/BaseFont&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">fnt</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/BaseFont&quot;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;/CharProcs&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="s2">&quot;/FontDescriptor&quot;</span> <span class="ow">in</span> <span class="n">f</span>
                <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">x</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/FontDescriptor&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fontkeys</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="s2">&quot;/DescendantFonts&quot;</span> <span class="ow">in</span> <span class="n">f</span>
                <span class="ow">and</span> <span class="s2">&quot;/FontDescriptor&quot;</span>
                <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">DictionaryObject</span><span class="p">,</span>
                    <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/DescendantFonts&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">x</span>
                    <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                        <span class="n">DictionaryObject</span><span class="p">,</span>
                        <span class="n">cast</span><span class="p">(</span>
                            <span class="n">DictionaryObject</span><span class="p">,</span>
                            <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/DescendantFonts&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
                        <span class="p">)[</span><span class="s2">&quot;/FontDescriptor&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fontkeys</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># the list comprehension ensures there is FontFile</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">emb</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/BaseFont&quot;</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">emb</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;/DR&quot;</span> <span class="ow">in</span> <span class="n">obj</span> <span class="ow">and</span> <span class="s2">&quot;/Font&quot;</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/DR&quot;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/DR&quot;</span><span class="p">])[</span><span class="s2">&quot;/Font&quot;</span><span class="p">]):</span>
            <span class="n">process_font</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;/Resources&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;/Font&quot;</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">])[</span><span class="s2">&quot;/Font&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">process_font</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/XObject&quot;</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">])[</span><span class="s2">&quot;/XObject&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">_get_fonts_walk</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get_object</span><span class="p">()),</span> <span class="n">fnt</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;/Annots&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Annots&quot;</span><span class="p">]):</span>
            <span class="n">_get_fonts_walk</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">get_object</span><span class="p">()),</span> <span class="n">fnt</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;/AP&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/AP&quot;</span><span class="p">])[</span><span class="s2">&quot;/N&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;/Type&quot;</span>
            <span class="p">)</span>
            <span class="o">==</span> <span class="s2">&quot;/XObject&quot;</span>
        <span class="p">):</span>
            <span class="n">_get_fonts_walk</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/AP&quot;</span><span class="p">])[</span><span class="s2">&quot;/N&quot;</span><span class="p">]),</span>
                <span class="n">fnt</span><span class="p">,</span>
                <span class="n">emb</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/AP&quot;</span><span class="p">])[</span><span class="s2">&quot;/N&quot;</span><span class="p">]):</span>
                <span class="n">_get_fonts_walk</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">fnt</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fnt</span><span class="p">,</span> <span class="n">emb</span>  <span class="c1"># return the sets for each page</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2006 - 2024, Mathieu Fenniak and pypdf contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=8309bdae"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/translations.js?v=beaddf03"></script>
    </body>
</html>