<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>pypdf._writer - pypdf 5.1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pypdf 5.1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">pypdf 5.1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html">迁移指南：从 1.x 到 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html#id1">导入和模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/migration-1-to-2.html#id2">命名调整</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/robustness.html">稳健性与 <code class="docutils literal notranslate"><span class="pre">strict=False</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/suppress-warnings.html">异常、警告和日志消息</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/metadata.html">元数据（Metadata）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-text.html">从 PDF 中提取文本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/post-processing-in-text-extraction.html">文本提取的后处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-images.html">提取图像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-images.html#id2">其他图像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/extract-attachments.html">提取附件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/encryption-decryption.html">PDF 的加密与解密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/merging-pdfs.html">合并 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/cropping-and-transforming.html">裁剪和转换 PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/cropping-and-transforming.html#id7">转换同一页面的多个副本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/reading-pdf-annotations.html">读取 PDF 注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/adding-pdf-annotations.html">添加 PDF 注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/add-watermark.html">向 PDF 添加印章或水印</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/add-javascript.html">向 PDF 添加 JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/viewer-preferences.html">添加查看器首选项</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/forms.html">与 PDF 表单的交互</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/streaming-data.html">使用 pypdf 流式传输数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/file-size.html">减小 PDF 文件大小</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/pdf-version-support.html">PDF 版本支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/pdfa-compliance.html">PDF/A 合规性</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API 参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfReader.html">PdfReader 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfWriter.html">PdfWriter 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Destination.html">Destination 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/DocumentInformation.html">DocumentInformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Field.html">Field类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Fit.html">Fit 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PageObject.html">PageObject 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PageRange.html">PageRange 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PaperSize.html">PaperSize 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/RectangleObject.html">RectangleObject 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/Transformation.html">Transformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/XmpInformation.html">XmpInformation 类</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/annotations.html">annotations 模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/constants.html">常量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/errors.html">异常和错误</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/generic.html">PDF 范型对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/PdfDocCommon.html">PdfDocCommon 类</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id2">安装依赖</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id3">运行测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#sample-files-git">sample-files Git 子模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#git-pre-commit">工具：Git 和 pre-commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id4">提交消息规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#pull-request">Pull Request 大小</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/intro.html#id7">基准测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pdf-format.html">PDF 格式</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pypdf-parsing.html">pypdf 如何解析 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/pypdf-writing.html">pypdf 如何写入 PDF 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/cmaps.html">CMaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/deprecations.html">弃用流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/documentation.html">文档编写</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/testing.html">测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/releasing.html">发布</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">关于 pypdf</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../meta/CHANGELOG.html">更新日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/changelog-v1.html">Changelog of PyPDF2 1.X</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/project-governance.html">项目治理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/taking-ownership.html">接管 pypdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/history.html">pypdf 历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/CONTRIBUTORS.html">贡献者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/scope-of-pypdf.html">pypdf 的范围</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/comparisons.html">pypdf 与 X 的对比</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/faq.html">常见问题解答</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>pypdf._writer 源代码</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2006, Mathieu Fenniak</span>
<span class="c1"># Copyright (c) 2007, Ashish Kulkarni &lt;kulkarni.ashish@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1"># * Redistributions of source code must retain the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer.</span>
<span class="c1"># * Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer in the documentation</span>
<span class="c1"># and/or other materials provided with the distribution.</span>
<span class="c1"># * The name of the author may not be used to endorse or promote products</span>
<span class="c1"># derived from this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<span class="c1"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="c1"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="c1"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="c1"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>

<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span><span class="p">,</span> <span class="n">FileIO</span><span class="p">,</span> <span class="n">IOBase</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">compress</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IO</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">._cmap</span> <span class="kn">import</span> <span class="n">_default_fonts_space_width</span><span class="p">,</span> <span class="n">build_char_map_from_dict</span>
<span class="kn">from</span> <span class="nn">._doc_common</span> <span class="kn">import</span> <span class="n">DocumentInformation</span><span class="p">,</span> <span class="n">PdfDocCommon</span>
<span class="kn">from</span> <span class="nn">._encryption</span> <span class="kn">import</span> <span class="n">EncryptAlgorithm</span><span class="p">,</span> <span class="n">Encryption</span>
<span class="kn">from</span> <span class="nn">._page</span> <span class="kn">import</span> <span class="n">PageObject</span>
<span class="kn">from</span> <span class="nn">._page_labels</span> <span class="kn">import</span> <span class="n">nums_clear_range</span><span class="p">,</span> <span class="n">nums_insert</span><span class="p">,</span> <span class="n">nums_next</span>
<span class="kn">from</span> <span class="nn">._reader</span> <span class="kn">import</span> <span class="n">PdfReader</span>
<span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">StrByteType</span><span class="p">,</span>
    <span class="n">StreamType</span><span class="p">,</span>
    <span class="n">_get_max_pdf_version_header</span><span class="p">,</span>
    <span class="n">deprecate</span><span class="p">,</span>
    <span class="n">deprecate_no_replacement</span><span class="p">,</span>
    <span class="n">deprecation_with_replacement</span><span class="p">,</span>
    <span class="n">logger_warning</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">AnnotationDictionaryAttributes</span> <span class="k">as</span> <span class="n">AA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">CatalogAttributes</span> <span class="k">as</span> <span class="n">CA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CatalogDictionary</span><span class="p">,</span>
    <span class="n">FileSpecificationDictionaryEntries</span><span class="p">,</span>
    <span class="n">GoToActionArguments</span><span class="p">,</span>
    <span class="n">ImageType</span><span class="p">,</span>
    <span class="n">InteractiveFormDictEntries</span><span class="p">,</span>
    <span class="n">OutlineFontFlag</span><span class="p">,</span>
    <span class="n">PageLabelStyle</span><span class="p">,</span>
    <span class="n">TypFitArguments</span><span class="p">,</span>
    <span class="n">UserAccessPermissions</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">Core</span> <span class="k">as</span> <span class="n">CO</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">FieldDictionaryAttributes</span> <span class="k">as</span> <span class="n">FA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">PageAttributes</span> <span class="k">as</span> <span class="n">PG</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">PagesAttributes</span> <span class="k">as</span> <span class="n">PA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">TrailerKeys</span> <span class="k">as</span> <span class="n">TK</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">PyPdfError</span>
<span class="kn">from</span> <span class="nn">.generic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PAGE_FIT</span><span class="p">,</span>
    <span class="n">ArrayObject</span><span class="p">,</span>
    <span class="n">BooleanObject</span><span class="p">,</span>
    <span class="n">ByteStringObject</span><span class="p">,</span>
    <span class="n">ContentStream</span><span class="p">,</span>
    <span class="n">DecodedStreamObject</span><span class="p">,</span>
    <span class="n">Destination</span><span class="p">,</span>
    <span class="n">DictionaryObject</span><span class="p">,</span>
    <span class="n">Fit</span><span class="p">,</span>
    <span class="n">FloatObject</span><span class="p">,</span>
    <span class="n">IndirectObject</span><span class="p">,</span>
    <span class="n">NameObject</span><span class="p">,</span>
    <span class="n">NullObject</span><span class="p">,</span>
    <span class="n">NumberObject</span><span class="p">,</span>
    <span class="n">PdfObject</span><span class="p">,</span>
    <span class="n">RectangleObject</span><span class="p">,</span>
    <span class="n">StreamObject</span><span class="p">,</span>
    <span class="n">TextStringObject</span><span class="p">,</span>
    <span class="n">TreeObject</span><span class="p">,</span>
    <span class="n">ViewerPreferences</span><span class="p">,</span>
    <span class="n">create_string_object</span><span class="p">,</span>
    <span class="n">hex_to_rgb</span><span class="p">,</span>
    <span class="n">is_null_or_none</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.pagerange</span> <span class="kn">import</span> <span class="n">PageRange</span><span class="p">,</span> <span class="n">PageRangeSpec</span>
<span class="kn">from</span> <span class="nn">.types</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnnotationSubtype</span><span class="p">,</span>
    <span class="n">BorderArrayType</span><span class="p">,</span>
    <span class="n">LayoutType</span><span class="p">,</span>
    <span class="n">OutlineItemType</span><span class="p">,</span>
    <span class="n">OutlineType</span><span class="p">,</span>
    <span class="n">PagemodeType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.xmp</span> <span class="kn">import</span> <span class="n">XmpInformation</span>

<span class="n">ALL_DOCUMENT_PERMISSIONS</span> <span class="o">=</span> <span class="n">UserAccessPermissions</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">DEFAULT_FONT_HEIGHT_IN_MULTILINE</span> <span class="o">=</span> <span class="mi">12</span>


<div class="viewcode-block" id="ObjectDeletionFlag">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.ObjectDeletionFlag">[文档]</a>
<span class="k">class</span> <span class="nc">ObjectDeletionFlag</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TEXT</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">LINKS</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">ATTACHMENTS</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">OBJECTS_3D</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">ALL_ANNOTATIONS</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">XOBJECT_IMAGES</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">INLINE_IMAGES</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">DRAWING_IMAGES</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">IMAGES</span> <span class="o">=</span> <span class="n">XOBJECT_IMAGES</span> <span class="o">|</span> <span class="n">INLINE_IMAGES</span> <span class="o">|</span> <span class="n">DRAWING_IMAGES</span></div>



<span class="k">def</span> <span class="nf">_rolling_checksum</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">,</span> <span class="n">blocksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65536</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">blocksize</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<div class="viewcode-block" id="PdfWriter">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter">[文档]</a>
<span class="k">class</span> <span class="nc">PdfWriter</span><span class="p">(</span><span class="n">PdfDocCommon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a PDF file out, given pages produced by another class or through</span>
<span class="sd">    cloning a PDF file during initialization.</span>

<span class="sd">    Typically data is added from a :class:`PdfReader&lt;pypdf.PdfReader&gt;`.</span>

<span class="sd">    Args:</span>
<span class="sd">        clone_from: identical to fileobj (for compatibility)</span>

<span class="sd">        incremental: If true, loads the document and set the PdfWriter in incremental mode.</span>


<span class="sd">            When writing incrementally, the original document is written first and new/modified</span>
<span class="sd">            content is appended. To be used for signed document/forms to keep signature valid.</span>

<span class="sd">        full: If true, loads all the objects (always full if incremental = True).</span>
<span class="sd">            This parameters may allows to load very big PDFs.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fileobj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="n">StrByteType</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">clone_from</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="n">StrByteType</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">incremental</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span> <span class="o">=</span> <span class="n">incremental</span> <span class="ow">or</span> <span class="n">full</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if the PdfWriter object has been started in incremental mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PdfObject</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The indirect objects in the PDF.</span>
<span class="sd">        For the incremental case, it will be filled with None</span>
<span class="sd">        in clone_reader_document_root.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of hashes after import; used to identify changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps hash values of indirect objects to the list of IndirectObjects.</span>
<span class="sd">        This is used for compression.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of already translated IDs.</span>
<span class="sd">           dict[id(pdf)][(idnum, generation)]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PdfObject</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The PDF files&#39;s document information dictionary,</span>
<span class="sd">        the Info entry in the PDF file&#39;s trailer dictionary.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The PDF file identifier,</span>
<span class="sd">        defined by the ID in the PDF file&#39;s trailer dictionary.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">fileobj</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">):</span>
                <span class="n">fileobj</span> <span class="o">=</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PyPdfError</span><span class="p">(</span><span class="s2">&quot;Invalid type for incremental mode&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">fileobj</span>  <span class="c1"># prev content is in _reader.stream</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">pdf_header</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># !!!TODO: to be analysed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;%PDF-1.3&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Producer&quot;</span><span class="p">):</span> <span class="n">create_string_object</span><span class="p">(</span><span class="s2">&quot;pypdf&quot;</span><span class="p">)}</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_clone_from</span><span class="p">(</span>
            <span class="n">fileobj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">BytesIO</span><span class="p">],</span>
            <span class="n">clone_from</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">BytesIO</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">BytesIO</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">IO</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">fileobj</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">clone_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">clone_from</span>
            <span class="n">cloning</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fileobj</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
                <span class="ow">or</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fileobj</span><span class="p">))</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">cloning</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="p">(</span><span class="n">IOBase</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">)):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cloning</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cloning</span><span class="p">:</span>
                <span class="n">clone_from</span> <span class="o">=</span> <span class="n">fileobj</span>
            <span class="k">return</span> <span class="n">clone_from</span>

        <span class="n">clone_from</span> <span class="o">=</span> <span class="n">_get_clone_from</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">clone_from</span><span class="p">)</span>
        <span class="c1"># to prevent overwriting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_with_as_usage</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cloned</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># The root of our page tree node.</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">pages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Pages&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">COUNT</span><span class="p">):</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">KIDS</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encryption</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Encryption</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">clone_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clone_from</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">):</span>
                <span class="n">clone_from</span> <span class="o">=</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">clone_from</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clone_document_from_reader</span><span class="p">(</span><span class="n">clone_from</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cloned</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>
            <span class="c1"># root object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">CO</span><span class="o">.</span><span class="n">CATALOG</span><span class="p">),</span>
                    <span class="n">NameObject</span><span class="p">(</span><span class="n">CO</span><span class="o">.</span><span class="n">PAGES</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">full</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">TextStringObject</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ByteStringObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_original_bytes</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TextStringObject</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ByteStringObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_original_bytes</span><span class="p">())</span>

    <span class="c1"># for commonality</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_encrypted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read-only boolean property showing whether this PDF file is encrypted.</span>

<span class="sd">        Note that this property, if true, will remain true even after the</span>
<span class="sd">        :meth:`decrypt()&lt;pypdf.PdfReader.decrypt&gt;` method is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DictionaryObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide direct access to PDF Structure.</span>

<span class="sd">        Note:</span>
<span class="sd">            Recommended only for read access.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide access to &quot;/Info&quot;. Standardized with PdfReader.</span>

<span class="sd">        Returns:</span>
<span class="sd">            /Info Dictionary; None if the entry does not exist</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="p">)</span>

    <span class="nd">@_info</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">())</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">get_object</span><span class="p">()))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">xmp_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">XmpInformation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;XMP (Extensible Metadata Platform) data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">XmpInformation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">xmp_metadata</span><span class="p">)</span>

    <span class="nd">@xmp_metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">xmp_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">XmpInformation</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;XMP (Extensible Metadata Platform) data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;/Metadata&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="s2">&quot;/Metadata&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Metadata&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">xmp_metadata</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_as_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">deprecate_no_replacement</span><span class="p">(</span><span class="s2">&quot;with_as_usage&quot;</span><span class="p">,</span> <span class="s2">&quot;6.0&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_as_usage</span>

    <span class="nd">@with_as_usage</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">with_as_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">deprecate_no_replacement</span><span class="p">(</span><span class="s2">&quot;with_as_usage&quot;</span><span class="p">,</span> <span class="s2">&quot;6.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_with_as_usage</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PdfWriter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store how writer is initialized by &#39;with&#39;.&quot;&quot;&quot;</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cloned</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_fileobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cloned</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_with_as_usage</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">t</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">exc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to the fileobj.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cloned</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pdf_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read/Write property of the PDF header that is written.</span>

<span class="sd">        This should be something like ``&#39;%PDF-1.5&#39;``. It is recommended to set</span>
<span class="sd">        the lowest version that supports all features which are used within the</span>
<span class="sd">        PDF file.</span>

<span class="sd">        Note: `pdf_header` returns a string but accepts bytes or str for writing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="nd">@pdf_header</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pdf_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_header</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">new_header</span> <span class="o">=</span> <span class="n">new_header</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">new_header</span>

    <span class="k">def</span> <span class="nf">_add_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span> <span class="o">==</span> <span class="bp">self</span>  <span class="c1"># type: ignore</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span>  <span class="c1"># type: ignore</span>
        <span class="c1"># check for /Contents in Pages (/Contents in annotations are strings)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">CONTENTS</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span>

<div class="viewcode-block" id="PdfWriter.get_object">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.get_object">[文档]</a>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">indirect_reference</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PdfObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">indirect_reference</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDF must be self&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># clarification for mypy</span>
        <span class="k">return</span> <span class="n">obj</span></div>


    <span class="k">def</span> <span class="nf">_replace_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">indirect_reference</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">],</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PdfObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDF must be self&quot;</span><span class="p">)</span>
            <span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">indirect_reference</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">generation</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span> <span class="o">!=</span> <span class="bp">self</span>  <span class="c1"># type: ignore</span>
        <span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">indirect_reference</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">PdfObject</span><span class="p">)</span>  <span class="c1"># clarification for mypy</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_add_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">PageObject</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">excluded_keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">)</span> <span class="ow">or</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">CO</span><span class="o">.</span><span class="n">PAGE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid page object&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;for mypy&quot;</span>
        <span class="n">page_org</span> <span class="o">=</span> <span class="n">page</span>
        <span class="n">excluded_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excluded_keys</span><span class="p">)</span>
        <span class="n">excluded_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">PA</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span> <span class="s2">&quot;/StructParents&quot;</span><span class="p">]</span>
        <span class="c1"># Acrobat does not accept two indirect references pointing on the same</span>
        <span class="c1"># page; therefore in order to add multiple copies of the same</span>
        <span class="c1"># page, we need to create a new dictionary for the page, however the</span>
        <span class="c1"># objects below (including content) are not duplicated:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># delete an already existing page</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">page_org</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">pdf</span><span class="p">)][</span>  <span class="c1"># type: ignore</span>
                <span class="n">page_org</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">page_org</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">excluded_keys</span><span class="p">)</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">page_org</span><span class="o">.</span><span class="n">pdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">page_org</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">pdf_header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_header</span> <span class="o">=</span> <span class="n">_get_max_pdf_version_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf_header</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">node</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_page_in_node</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">page</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">PARENT</span><span class="p">)]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">indirect_reference</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">PA</span><span class="o">.</span><span class="n">KIDS</span><span class="p">])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">PA</span><span class="o">.</span><span class="n">KIDS</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="n">node</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">COUNT</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">PA</span><span class="o">.</span><span class="n">COUNT</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">recurse</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">recurse</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PyPdfError</span><span class="p">(</span><span class="s2">&quot;Too many recursive calls!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">page</span>

<div class="viewcode-block" id="PdfWriter.set_need_appearances_writer">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.set_need_appearances_writer">[文档]</a>
    <span class="k">def</span> <span class="nf">set_need_appearances_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the &quot;NeedAppearances&quot; flag in the PDF writer.</span>

<span class="sd">        The &quot;NeedAppearances&quot; flag indicates whether the appearance dictionary</span>
<span class="sd">        for form fields should be automatically generated by the PDF viewer or</span>
<span class="sd">        if the embedded appearance should be used.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The actual value of the NeedAppearances flag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># See §12.7.2 and §7.7.2 for more information:</span>
        <span class="c1"># https://opensource.adobe.com/dc-acrobat-sdk-docs/pdfstandards/PDF32000_2008.pdf</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get the AcroForm tree</span>
            <span class="k">if</span> <span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span>
                    <span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">())</span>

            <span class="n">need_appearances</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">InteractiveFormDictEntries</span><span class="o">.</span><span class="n">NeedAppearances</span><span class="p">)</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">])[</span>
                <span class="n">need_appearances</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">BooleanObject</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">logger_warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;set_need_appearances_writer(</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">) catch : </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vm">__name__</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.create_viewer_preferences">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.create_viewer_preferences">[文档]</a>
    <span class="k">def</span> <span class="nf">create_viewer_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ViewerPreferences</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">ViewerPreferences</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">VIEWER_PREFERENCES</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span></div>


<div class="viewcode-block" id="PdfWriter.add_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_page">[文档]</a>
    <span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">PageObject</span><span class="p">,</span>
        <span class="n">excluded_keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a page to this PDF file.</span>

<span class="sd">        Recommended for advanced usage including the adequate excluded_keys.</span>

<span class="sd">        The page is usually acquired from a :class:`PdfReader&lt;pypdf.PdfReader&gt;`</span>
<span class="sd">        instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            page: The page to add to the document. Should be</span>
<span class="sd">                an instance of :class:`PageObject&lt;pypdf._page.PageObject&gt;`</span>
<span class="sd">            excluded_keys:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The added PageObject.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">),</span> <span class="n">excluded_keys</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.insert_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.insert_page">[文档]</a>
    <span class="k">def</span> <span class="nf">insert_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">PageObject</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">excluded_keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a page in this PDF file. The page is usually acquired from a</span>
<span class="sd">        :class:`PdfReader&lt;pypdf.PdfReader&gt;` instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            page: The page to add to the document.</span>
<span class="sd">            index: Position at which the page will be inserted.</span>
<span class="sd">            excluded_keys:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The added PageObject.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid index value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">excluded_keys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">excluded_keys</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_page_number_by_indirect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">indirect_reference</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate _page_id2num.</span>

<span class="sd">        Args:</span>
<span class="sd">            indirect_reference:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The page number or None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># to provide same function as in PdfReader</span>
        <span class="k">if</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mypy&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">indirect_reference</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">page_number</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="PdfWriter.add_blank_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_blank_page">[文档]</a>
    <span class="k">def</span> <span class="nf">add_blank_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a blank page to this PDF file and return it.</span>

<span class="sd">        If no page size is specified, use the size of the last page.</span>

<span class="sd">        Args:</span>
<span class="sd">            width: The width of the new page expressed in default user</span>
<span class="sd">                space units.</span>
<span class="sd">            height: The height of the new page expressed in default</span>
<span class="sd">                user space units.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly appended page.</span>

<span class="sd">        Raises:</span>
<span class="sd">            PageSizeNotDefinedError: if width and height are not defined</span>
<span class="sd">                and previous page does not exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">create_blank_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.insert_blank_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.insert_blank_page">[文档]</a>
    <span class="k">def</span> <span class="nf">insert_blank_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a blank page to this PDF file and return it.</span>

<span class="sd">        If no page size is specified, use the size of the last page.</span>

<span class="sd">        Args:</span>
<span class="sd">            width: The width of the new page expressed in default user</span>
<span class="sd">                space units.</span>
<span class="sd">            height: The height of the new page expressed in default</span>
<span class="sd">                user space units.</span>
<span class="sd">            index: Position to add the page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly inserted page.</span>

<span class="sd">        Raises:</span>
<span class="sd">            PageSizeNotDefinedError: if width and height are not defined</span>
<span class="sd">                and previous page does not exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_pages</span><span class="p">():</span>
            <span class="n">oldpage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">oldpage</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">width</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">oldpage</span><span class="o">.</span><span class="n">mediabox</span><span class="o">.</span><span class="n">height</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">PageObject</span><span class="o">.</span><span class="n">create_blank_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">page</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open_destination</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Destination</span><span class="p">,</span> <span class="n">TextStringObject</span><span class="p">,</span> <span class="n">ByteStringObject</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">open_destination</span>

    <span class="nd">@open_destination</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">open_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Destination</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/OpenAction&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/OpenAction&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">Destination</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/OpenAction&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">dest_array</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/OpenAction&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Destination</span><span class="p">(</span>
                <span class="s2">&quot;Opening&quot;</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">NullObject</span><span class="p">(),</span>
                <span class="n">PAGE_FIT</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dest_array</span>

<div class="viewcode-block" id="PdfWriter.add_js">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_js">[文档]</a>
    <span class="k">def</span> <span class="nf">add_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">javascript</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add JavaScript which will launch upon opening this PDF.</span>

<span class="sd">        Args:</span>
<span class="sd">            javascript: Your JavaScript.</span>

<span class="sd">        &gt;&gt;&gt; output.add_js(&quot;this.print({bUI:true,bSilent:false,bShrinkToFit:true});&quot;)</span>
<span class="sd">        # Example: This will launch the print window when the PDF is opened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Names / JavaScript preferred to be able to add multiple scripts</span>
        <span class="k">if</span> <span class="s2">&quot;/Names&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;/JavaScript&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">names</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/JavaScript&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">(</span>
                <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Names&quot;</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">()}</span>
            <span class="p">)</span>
        <span class="n">js_list</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">ArrayObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="s2">&quot;/JavaScript&quot;</span><span class="p">])[</span><span class="s2">&quot;/Names&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">js</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Action&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/S&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/JavaScript&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/JS&quot;</span><span class="p">):</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">javascript</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># We need a name for parameterized JavaScript in the PDF file,</span>
        <span class="c1"># but it can be anything.</span>
        <span class="n">js_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">create_string_object</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())))</span>
        <span class="n">js_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">js</span><span class="p">))</span></div>


<div class="viewcode-block" id="PdfWriter.add_attachment">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_attachment">[文档]</a>
    <span class="k">def</span> <span class="nf">add_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Embed a file inside the PDF.</span>

<span class="sd">        Reference:</span>
<span class="sd">        https://opensource.adobe.com/dc-acrobat-sdk-docs/pdfstandards/PDF32000_2008.pdf</span>
<span class="sd">        Section 7.11.3</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The filename to display.</span>
<span class="sd">            data: The data in the file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We need three entries:</span>
        <span class="c1"># * The file&#39;s data</span>
        <span class="c1"># * The /Filespec entry</span>
        <span class="c1"># * The file&#39;s name, which goes in the Catalog</span>

        <span class="c1"># The entry for the file</span>
        <span class="c1"># Sample:</span>
        <span class="c1"># 8 0 obj</span>
        <span class="c1"># &lt;&lt;</span>
        <span class="c1">#  /Length 12</span>
        <span class="c1">#  /Type /EmbeddedFile</span>
        <span class="c1"># &gt;&gt;</span>
        <span class="c1"># stream</span>
        <span class="c1"># Hello world!</span>
        <span class="c1"># endstream</span>
        <span class="c1"># endobj</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
        <span class="n">file_entry</span> <span class="o">=</span> <span class="n">DecodedStreamObject</span><span class="p">()</span>
        <span class="n">file_entry</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">file_entry</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/EmbeddedFile&quot;</span><span class="p">)})</span>

        <span class="c1"># The Filespec entry</span>
        <span class="c1"># Sample:</span>
        <span class="c1"># 7 0 obj</span>
        <span class="c1"># &lt;&lt;</span>
        <span class="c1">#  /Type /Filespec</span>
        <span class="c1">#  /F (hello.txt)</span>
        <span class="c1">#  /EF &lt;&lt; /F 8 0 R &gt;&gt;</span>
        <span class="c1"># &gt;&gt;</span>
        <span class="c1"># endobj</span>

        <span class="n">ef_entry</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">ef_entry</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">file_entry</span><span class="p">)})</span>

        <span class="n">filespec</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">filespec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">PA</span><span class="o">.</span><span class="n">TYPE</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Filespec&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">FileSpecificationDictionaryEntries</span><span class="o">.</span><span class="n">F</span><span class="p">):</span> <span class="n">create_string_object</span><span class="p">(</span>
                    <span class="n">filename</span>
                <span class="p">),</span>  <span class="c1"># Perhaps also try TextStringObject</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">FileSpecificationDictionaryEntries</span><span class="o">.</span><span class="n">EF</span><span class="p">):</span> <span class="n">ef_entry</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Then create the entry for the root, as it needs</span>
        <span class="c1"># a reference to the Filespec</span>
        <span class="c1"># Sample:</span>
        <span class="c1"># 1 0 obj</span>
        <span class="c1"># &lt;&lt;</span>
        <span class="c1">#  /Type /Catalog</span>
        <span class="c1">#  /Outlines 2 0 R</span>
        <span class="c1">#  /Pages 3 0 R</span>
        <span class="c1">#  /Names &lt;&lt; /EmbeddedFiles &lt;&lt; /Names [(hello.txt) 7 0 R] &gt;&gt; &gt;&gt;</span>
        <span class="c1"># &gt;&gt;</span>
        <span class="c1"># endobj</span>

        <span class="k">if</span> <span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/EmbeddedFiles&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">]):</span>
            <span class="n">embedded_files_names_dictionary</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">(</span>
                <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">()}</span>
            <span class="p">)</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">])[</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/EmbeddedFiles&quot;</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">embedded_files_names_dictionary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embedded_files_names_dictionary</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">,</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">])[</span><span class="s2">&quot;/EmbeddedFiles&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">embedded_files_names_dictionary</span><span class="p">[</span><span class="n">CA</span><span class="o">.</span><span class="n">NAMES</span><span class="p">])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="n">create_string_object</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">filespec</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.append_pages_from_reader">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.append_pages_from_reader">[文档]</a>
    <span class="k">def</span> <span class="nf">append_pages_from_reader</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
        <span class="n">after_page_append</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">PageObject</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy pages from reader to writer. Includes an optional callback</span>
<span class="sd">        parameter which is invoked after pages are appended to the writer.</span>

<span class="sd">        ``append`` should be preferred.</span>

<span class="sd">        Args:</span>
<span class="sd">            reader: a PdfReader object from which to copy page</span>
<span class="sd">                annotations to this writer object. The writer&#39;s annots</span>
<span class="sd">                will then be updated.</span>
<span class="sd">            after_page_append:</span>
<span class="sd">                Callback function that is invoked after each page is appended to</span>
<span class="sd">                the writer. Signature includes a reference to the appended page</span>
<span class="sd">                (delegates to append_pages_from_reader). The single parameter of</span>
<span class="sd">                the callback is a reference to the page just appended to the</span>
<span class="sd">                document.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reader_num_pages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span>
        <span class="c1"># Copy pages from reader to writer</span>
        <span class="k">for</span> <span class="n">reader_page_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reader_num_pages</span><span class="p">):</span>
            <span class="n">reader_page</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">reader_page_number</span><span class="p">]</span>
            <span class="n">writer_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span><span class="n">reader_page</span><span class="p">)</span>
            <span class="c1"># Trigger callback, pass writer page as parameter</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">after_page_append</span><span class="p">):</span>
                <span class="n">after_page_append</span><span class="p">(</span><span class="n">writer_page</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_update_field_annotation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>
        <span class="n">annotation</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>
        <span class="n">font_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">font_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Calculate rectangle dimensions</span>
        <span class="n">_rct</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">RectangleObject</span><span class="p">,</span> <span class="n">annotation</span><span class="p">[</span><span class="n">AA</span><span class="o">.</span><span class="n">Rect</span><span class="p">])</span>
        <span class="n">rct</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_rct</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">_rct</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_rct</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">_rct</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

        <span class="c1"># Extract font information</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get_inherited</span><span class="p">(</span>
            <span class="n">AA</span><span class="o">.</span><span class="n">DA</span><span class="p">,</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">AA</span><span class="o">.</span><span class="n">DA</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">da</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="s2">&quot;/Helv 0 Tf 0 g&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">font_properties</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">font_properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">font_properties</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">font_name</span><span class="p">:</span>
            <span class="n">font_properties</span><span class="p">[</span><span class="n">font_properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Tf&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">font_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">font_name</span> <span class="o">=</span> <span class="n">font_properties</span><span class="p">[</span><span class="n">font_properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Tf&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">font_height</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">font_size</span>
            <span class="k">if</span> <span class="n">font_size</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">font_properties</span><span class="p">[</span><span class="n">font_properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Tf&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">font_height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">Ff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">FA</span><span class="o">.</span><span class="n">FfBits</span><span class="o">.</span><span class="n">Multiline</span><span class="p">:</span>
                <span class="n">font_height</span> <span class="o">=</span> <span class="n">DEFAULT_FONT_HEIGHT_IN_MULTILINE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">font_height</span> <span class="o">=</span> <span class="n">rct</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">font_properties</span><span class="p">[</span><span class="n">font_properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Tf&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">font_height</span><span class="p">)</span>
        <span class="n">da</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">font_properties</span><span class="p">)</span>
        <span class="n">y_offset</span> <span class="o">=</span> <span class="n">rct</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">font_height</span>

        <span class="c1"># Retrieve font information from local DR ...</span>
        <span class="n">dr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">DictionaryObject</span><span class="p">,</span>
            <span class="n">cast</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">,</span>
                <span class="n">annotation</span><span class="o">.</span><span class="n">get_inherited</span><span class="p">(</span>
                    <span class="s2">&quot;/DR&quot;</span><span class="p">,</span>
                    <span class="n">cast</span><span class="p">(</span>
                        <span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/DR&quot;</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">()),</span>
                <span class="p">),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Font&quot;</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="c1"># _default_fonts_space_width keys is the list of Standard fonts</span>
        <span class="k">if</span> <span class="n">font_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dr</span> <span class="ow">and</span> <span class="n">font_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_default_fonts_space_width</span><span class="p">:</span>
            <span class="c1"># ...or AcroForm dictionary</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/DR&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">)</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Font&quot;</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">font_res</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">font_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">font_res</span><span class="p">):</span>
            <span class="n">font_res</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">font_res</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="n">font_subtype</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">font_encoding</span><span class="p">,</span> <span class="n">font_map</span> <span class="o">=</span> <span class="n">build_char_map_from_dict</span><span class="p">(</span>
                <span class="mi">200</span><span class="p">,</span> <span class="n">font_res</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># remove width stored in -1 key</span>
                <span class="k">del</span> <span class="n">font_map</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">font_full_rev</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">font_encoding</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">font_full_rev</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">v</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">font_encoding</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">font_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">font_full_rev</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">font_encoding</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">font_encoding_rev</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">font_encoding</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">font_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">font_full_rev</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">font_encoding_rev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger_warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Font dictionary for </span><span class="si">{</span><span class="n">font_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
            <span class="n">font_full_rev</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Retrieve field text and selected values</span>
        <span class="n">field_flags</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">Ff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">FT</span><span class="p">,</span> <span class="s2">&quot;/Tx&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Ch&quot;</span> <span class="ow">and</span> <span class="n">field_flags</span> <span class="o">&amp;</span> <span class="n">FA</span><span class="o">.</span><span class="n">FfBits</span><span class="o">.</span><span class="n">Combo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">get_inherited</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">Opt</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/V&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># /Tx</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/V&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Escape parentheses (PDF 1.7 reference, table 3.2, Literal Strings)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\)&quot;</span><span class="p">)</span>
        <span class="c1"># Generate appearance stream</span>
        <span class="n">ap_stream</span> <span class="o">=</span> <span class="n">generate_appearance_stream</span><span class="p">(</span>
            <span class="n">txt</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">font_full_rev</span><span class="p">,</span> <span class="n">rct</span><span class="p">,</span> <span class="n">font_height</span><span class="p">,</span> <span class="n">y_offset</span>
        <span class="p">)</span>

        <span class="c1"># Create appearance dictionary</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="n">DecodedStreamObject</span><span class="o">.</span><span class="n">initialize_from_dictionary</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Type&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/XObject&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Form&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/BBox&quot;</span><span class="p">):</span> <span class="n">rct</span><span class="p">,</span>
                <span class="s2">&quot;__streamdata__&quot;</span><span class="p">:</span> <span class="n">ByteStringObject</span><span class="p">(</span><span class="n">ap_stream</span><span class="p">),</span>
                <span class="s2">&quot;/Length&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">AA</span><span class="o">.</span><span class="n">AP</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">annotation</span><span class="p">[</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;/BBox&quot;</span><span class="p">,</span> <span class="s2">&quot;/Length&quot;</span><span class="p">,</span> <span class="s2">&quot;/Subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;/Type&quot;</span><span class="p">,</span> <span class="s2">&quot;/Filter&quot;</span><span class="p">}:</span>
                    <span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># Update Resources with font information if necessary</span>
        <span class="k">if</span> <span class="n">font_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Resources&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Font&quot;</span><span class="p">):</span> <span class="n">DictionaryObject</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="n">NameObject</span><span class="p">(</span><span class="n">font_name</span><span class="p">):</span> <span class="nb">getattr</span><span class="p">(</span>
                                <span class="n">font_res</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">,</span> <span class="n">font_res</span>
                            <span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">AA</span><span class="o">.</span><span class="n">AP</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
            <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">(</span>
                <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">dct</span><span class="p">)}</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;/N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">annotation</span><span class="p">[</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">]):</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">)])[</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># [/AP][/N] exists</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">annotation</span><span class="p">[</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">][</span><span class="s2">&quot;/N&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span>  <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dct</span>
            <span class="n">dct</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">FFBITS_NUL</span> <span class="o">=</span> <span class="n">FA</span><span class="o">.</span><span class="n">FfBits</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="PdfWriter.update_page_form_field_values">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.update_page_form_field_values">[文档]</a>
    <span class="k">def</span> <span class="nf">update_page_form_field_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PageObject</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PageObject</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">fields</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">flags</span><span class="p">:</span> <span class="n">FA</span><span class="o">.</span><span class="n">FfBits</span> <span class="o">=</span> <span class="n">FFBITS_NUL</span><span class="p">,</span>
        <span class="n">auto_regenerate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the form field values for a given page from a fields dictionary.</span>

<span class="sd">        Copy field texts and values from fields to page.</span>
<span class="sd">        If the field links to a parent object, add the information to the parent.</span>

<span class="sd">        Args:</span>
<span class="sd">            page: `PageObject` - references **PDF writer&#39;s page** where the</span>
<span class="sd">                annotations and field data will be updated.</span>
<span class="sd">                `List[Pageobject]` - provides list of pages to be processed.</span>
<span class="sd">                `None` - all pages.</span>
<span class="sd">            fields: a Python dictionary of:</span>

<span class="sd">                * field names (/T) as keys and text values (/V) as value</span>
<span class="sd">                * field names (/T) as keys and list of text values (/V) for multiple choice list</span>
<span class="sd">                * field names (/T) as keys and tuple of:</span>
<span class="sd">                    * text values (/V)</span>
<span class="sd">                    * font id (e.g. /F1, the font id must exist)</span>
<span class="sd">                    * font size (0 for autosize)</span>

<span class="sd">            flags: A set of flags from :class:`~pypdf.constants.FieldDictionaryAttributes.FfBits`.</span>

<span class="sd">            auto_regenerate: Set/unset the need_appearances flag;</span>
<span class="sd">                the flag is unchanged if auto_regenerate is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PyPdfError</span><span class="p">(</span><span class="s2">&quot;No /AcroForm dictionary in PDF of PdfWriter Object&quot;</span><span class="p">)</span>
        <span class="n">af</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">InteractiveFormDictEntries</span><span class="o">.</span><span class="n">Fields</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">af</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PyPdfError</span><span class="p">(</span><span class="s2">&quot;No /Fields dictionary in PDF of PdfWriter Object&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auto_regenerate</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_need_appearances_writer</span><span class="p">(</span><span class="n">auto_regenerate</span><span class="p">)</span>
        <span class="c1"># Iterate through pages, update field values</span>
        <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># just to prevent warnings</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_page_form_field_values</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
            <span class="n">logger_warning</span><span class="p">(</span><span class="s2">&quot;No fields to update on this page&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;/Widget&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;/FT&quot;</span> <span class="ow">in</span> <span class="n">annotation</span> <span class="ow">and</span> <span class="s2">&quot;/T&quot;</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
                <span class="n">parent_annotation</span> <span class="o">=</span> <span class="n">annotation</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent_annotation</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">PG</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">()</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_qualified_field_name</span><span class="p">(</span><span class="n">parent_annotation</span><span class="p">)</span> <span class="o">==</span> <span class="n">field</span>
                    <span class="ow">or</span> <span class="n">parent_annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/T&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">field</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">parent_annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/FT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Ch&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;/I&quot;</span> <span class="ow">in</span> <span class="n">parent_annotation</span>
                <span class="p">):</span>
                    <span class="k">del</span> <span class="n">parent_annotation</span><span class="p">[</span><span class="s2">&quot;/I&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flags</span><span class="p">:</span>
                    <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">Ff</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">lst</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span><span class="n">TextStringObject</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
                    <span class="n">parent_annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">V</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lst</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">V</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span>
                        <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parent_annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">V</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parent_annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">FT</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;/Btn&quot;</span><span class="p">):</span>
                    <span class="c1"># Checkbox button (no /FT found in Radio widgets)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">AP</span><span class="p">)][</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">)]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Off&quot;</span><span class="p">)</span>
                    <span class="c1"># other cases will be updated through the for loop</span>
                    <span class="n">annotation</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">AS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">parent_annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">FT</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Tx&quot;</span>
                    <span class="ow">or</span> <span class="n">parent_annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">FT</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Ch&quot;</span>
                <span class="p">):</span>
                    <span class="c1"># textbox</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_update_field_annotation</span><span class="p">(</span>
                            <span class="n">parent_annotation</span><span class="p">,</span> <span class="n">annotation</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_update_field_annotation</span><span class="p">(</span><span class="n">parent_annotation</span><span class="p">,</span> <span class="n">annotation</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FA</span><span class="o">.</span><span class="n">FT</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Sig&quot;</span>
                <span class="p">):</span>  <span class="c1"># deprecated  # not implemented yet</span>
                    <span class="n">logger_warning</span><span class="p">(</span><span class="s2">&quot;Signature forms not implemented yet&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.reattach_fields">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.reattach_fields">[文档]</a>
    <span class="k">def</span> <span class="nf">reattach_fields</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse annotations within the page looking for orphan fields and</span>
<span class="sd">        reattach then into the Fields Structure.</span>

<span class="sd">        Args:</span>
<span class="sd">            page: page to analyze.</span>
<span class="sd">                  If none is provided, all pages will be analyzed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of reattached fields.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
                <span class="n">lst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reattach_fields</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">lst</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">af</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">af</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">ACRO_FORM</span><span class="p">)]</span> <span class="o">=</span> <span class="n">af</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">af</span><span class="p">[</span><span class="n">InteractiveFormDictEntries</span><span class="o">.</span><span class="n">Fields</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="n">af</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">InteractiveFormDictEntries</span><span class="o">.</span><span class="n">Fields</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fields</span>

        <span class="k">if</span> <span class="s2">&quot;/Annots&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span>
        <span class="n">annotations</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;/Annots&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annotations</span><span class="p">):</span>
            <span class="n">is_indirect</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Widget&quot;</span> <span class="ow">and</span> <span class="s2">&quot;/FT&quot;</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;indirect_reference&quot;</span> <span class="ow">in</span> <span class="n">annotation</span><span class="o">.</span><span class="vm">__dict__</span>
                    <span class="ow">and</span> <span class="n">annotation</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">in</span> <span class="n">fields</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_indirect</span><span class="p">:</span>
                    <span class="n">annotations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lst</span></div>


<div class="viewcode-block" id="PdfWriter.clone_reader_document_root">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.clone_reader_document_root">[文档]</a>
    <span class="k">def</span> <span class="nf">clone_reader_document_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the reader document root to the writer and all sub-elements,</span>
<span class="sd">        including pages, threads, outlines,... For partial insertion, ``append``</span>
<span class="sd">        should be considered.</span>

<span class="sd">        Args:</span>
<span class="sd">            reader: PdfReader from which the document root should be copied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">trailer</span><span class="p">[</span><span class="s2">&quot;/Size&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">replicate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="s2">&quot;/Pages&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">trailer</span><span class="p">[</span><span class="s2">&quot;/Size&quot;</span><span class="p">])</span>  <span class="c1"># for pytest</span>
        <span class="c1"># must be done here before rewriting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">()</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_object</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span><span class="o">.</span><span class="n">idnum</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Parent&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="o">.</span><span class="n">get_object</span><span class="p">())[</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Kids&quot;</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattened_pages</span><span class="p">])</span></div>


<div class="viewcode-block" id="PdfWriter.clone_document_from_reader">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.clone_document_from_reader">[文档]</a>
    <span class="k">def</span> <span class="nf">clone_document_from_reader</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
        <span class="n">after_page_append</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">PageObject</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a copy (clone) of a document from a PDF file reader cloning</span>
<span class="sd">        section &#39;/Root&#39; and &#39;/Info&#39; and &#39;/ID&#39; of the pdf.</span>

<span class="sd">        Args:</span>
<span class="sd">            reader: PDF file reader instance from which the clone</span>
<span class="sd">                should be created.</span>
<span class="sd">            after_page_append:</span>
<span class="sd">                Callback function that is invoked after each page is appended to</span>
<span class="sd">                the writer. Signature includes a reference to the appended page</span>
<span class="sd">                (delegates to append_pages_from_reader). The single parameter of</span>
<span class="sd">                the callback is a reference to the page just appended to the</span>
<span class="sd">                document.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_reader_document_root</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">inf</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">_info</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">IndirectObject</span><span class="p">,</span> <span class="n">inf</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">),</span> <span class="s2">&quot;for mypy&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">inf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">inf</span><span class="o">.</span><span class="n">get_object</span><span class="p">()))</span>
            <span class="p">)</span>
        <span class="c1"># else: _info_obj = None done in clone_reader_document_root()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">_ID</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">after_page_append</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">ArrayObject</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="o">.</span><span class="n">get_object</span><span class="p">())[</span><span class="s2">&quot;/Kids&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">after_page_append</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="nf">_compute_document_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ByteStringObject</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdf_structure</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ByteStringObject</span><span class="p">(</span><span class="n">_rolling_checksum</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="PdfWriter.generate_file_identifiers">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.generate_file_identifiers">[文档]</a>
    <span class="k">def</span> <span class="nf">generate_file_identifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an identifier for the PDF that will be written.</span>

<span class="sd">        The only point of this is ensuring uniqueness. Reproducibility is not</span>
<span class="sd">        required.</span>
<span class="sd">        When a file is first written, both identifiers shall be set to the same value.</span>
<span class="sd">        If both identifiers match when a file reference is resolved, it is very</span>
<span class="sd">        likely that the correct and unchanged file has been found. If only the first</span>
<span class="sd">        identifier matches, a different version of the correct file has been found.</span>
<span class="sd">        see §14.4 &quot;File Identifiers&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">:</span>
            <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_document_identifier</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_document_identifier</span><span class="p">()</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="n">id1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">((</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span></div>


<div class="viewcode-block" id="PdfWriter.encrypt">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.encrypt">[文档]</a>
    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">owner_password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_128bit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">permissions_flag</span><span class="p">:</span> <span class="n">UserAccessPermissions</span> <span class="o">=</span> <span class="n">ALL_DOCUMENT_PERMISSIONS</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encrypt this PDF file with the PDF Standard encryption handler.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_password: The password which allows for opening</span>
<span class="sd">                and reading the PDF file with the restrictions provided.</span>
<span class="sd">            owner_password: The password which allows for</span>
<span class="sd">                opening the PDF files without any restrictions. By default,</span>
<span class="sd">                the owner password is the same as the user password.</span>
<span class="sd">            use_128bit: flag as to whether to use 128bit</span>
<span class="sd">                encryption. When false, 40bit encryption will be used.</span>
<span class="sd">                By default, this flag is on.</span>
<span class="sd">            permissions_flag: permissions as described in</span>
<span class="sd">                Table 3.20 of the PDF 1.7 specification. A bit value of 1 means</span>
<span class="sd">                the permission is granted.</span>
<span class="sd">                Hence an integer value of -1 will set all flags.</span>
<span class="sd">                Bit position 3 is for printing, 4 is for modifying content,</span>
<span class="sd">                5 and 6 control annotations, 9 for form fields,</span>
<span class="sd">                10 for extraction of text and graphics.</span>
<span class="sd">            algorithm: encrypt algorithm. Values may be one of &quot;RC4-40&quot;, &quot;RC4-128&quot;,</span>
<span class="sd">                &quot;AES-128&quot;, &quot;AES-256-R5&quot;, &quot;AES-256&quot;. If it is valid,</span>
<span class="sd">                `use_128bit` will be ignored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">owner_password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">owner_password</span> <span class="o">=</span> <span class="n">user_password</span>

        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">EncryptAlgorithm</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Algorithm &#39;</span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">&#39; NOT supported&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alg</span> <span class="o">=</span> <span class="n">EncryptAlgorithm</span><span class="o">.</span><span class="n">RC4_128</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_128bit</span><span class="p">:</span>
                <span class="n">alg</span> <span class="o">=</span> <span class="n">EncryptAlgorithm</span><span class="o">.</span><span class="n">RC4_40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_file_identifiers</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encryption</span> <span class="o">=</span> <span class="n">Encryption</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">alg</span><span class="p">,</span> <span class="n">permissions_flag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># in case call `encrypt` again</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encryption</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">user_password</span><span class="p">,</span> <span class="n">owner_password</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="p">:</span>
            <span class="c1"># replace old encrypt_entry</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="o">.</span><span class="n">indirect_reference</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span> <span class="o">=</span> <span class="n">entry</span></div>


<div class="viewcode-block" id="PdfWriter.write_stream">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.write_stream">[文档]</a>
    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">StreamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="n">logger_warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File &lt;</span><span class="si">{</span><span class="n">stream</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt; to write to is not in binary mode. &quot;</span>
                <span class="s2">&quot;It may not be written to correctly.&quot;</span><span class="p">,</span>
                <span class="vm">__name__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># deprecated to be removed in pypdf 6.0.0 :</span>
        <span class="c1"># if not self._root:</span>
        <span class="c1">#   self._root = self._add_object(self._root_object)</span>
        <span class="c1"># self._sweep_indirect_references(self._root)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_objects_in_increment</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_increment</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>  <span class="c1"># writes objs, xref stream and startxref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">object_positions</span><span class="p">,</span> <span class="n">free_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdf_structure</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">xref_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_xref_table</span><span class="p">(</span>
                <span class="n">stream</span><span class="p">,</span> <span class="n">object_positions</span><span class="p">,</span> <span class="n">free_objects</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_trailer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">xref_location</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.write">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.write">[文档]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">StrByteType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the collection of pages added to this object out as a PDF file.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream: An object to write the file to. The object can support</span>
<span class="sd">                the write method and the tell method, similar to a file object, or</span>
<span class="sd">                be a file path, just like the fileobj, just named it stream to keep</span>
<span class="sd">                existing workflow.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (bool, IO).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_file</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">stream</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output(</span><span class="si">{</span><span class="n">stream</span><span class="si">=}</span><span class="s2">) is empty.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
            <span class="n">my_file</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">my_file</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">my_file</span><span class="p">,</span> <span class="n">stream</span></div>


<div class="viewcode-block" id="PdfWriter.list_objects_in_increment">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.list_objects_in_increment">[文档]</a>
    <span class="k">def</span> <span class="nf">list_objects_in_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For analysis or debugging.</span>
<span class="sd">        Provides the list of new or modified objects that will be written</span>
<span class="sd">        in the increment.</span>
<span class="sd">        Deleted objects will not be freed but will become orphans.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of new or modified IndirectObjects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_hash_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">indirect_reference</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">original_hash_count</span>
                    <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">_write_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">StreamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_positions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">object_blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">current_stop</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="n">original_hash_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">original_hash_count</span>
                <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">idnum</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">PdfObject</span><span class="p">)</span>  <span class="c1"># mypy</span>
                <span class="c1"># first write new/modified object</span>
                <span class="n">object_positions</span><span class="p">[</span><span class="n">idnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idnum</span><span class="si">}</span><span class="s2"> 0 obj</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; encryption is not operational</span>
<span class="sd">                if self._encryption and obj != self._encrypt_entry:</span>
<span class="sd">                    obj = self._encryption.encrypt_object(obj, idnum, 0)</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">write_to_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">endobj</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># prepare xref</span>
                <span class="k">if</span> <span class="n">idnum</span> <span class="o">!=</span> <span class="n">current_stop</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">current_start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">object_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">current_start</span><span class="p">,</span> <span class="n">current_stop</span> <span class="o">-</span> <span class="n">current_start</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="n">current_start</span> <span class="o">=</span> <span class="n">idnum</span>
                <span class="n">current_stop</span> <span class="o">=</span> <span class="n">idnum</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">current_start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;for pytest only&quot;</span>
        <span class="n">object_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">current_start</span><span class="p">,</span> <span class="n">current_stop</span> <span class="o">-</span> <span class="n">current_start</span><span class="p">])</span>
        <span class="c1"># write incremented xref</span>
        <span class="n">xref_location</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">xr_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xr_id</span><span class="si">}</span><span class="s2"> 0 obj&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">init_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Type&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/XRef&quot;</span><span class="p">),</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Size&quot;</span><span class="p">):</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">xr_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Root&quot;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Filter&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/FlateDecode&quot;</span><span class="p">),</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Index&quot;</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">(</span>
                <span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">_it</span><span class="p">)</span> <span class="k">for</span> <span class="n">_su</span> <span class="ow">in</span> <span class="n">object_blocks</span> <span class="k">for</span> <span class="n">_it</span> <span class="ow">in</span> <span class="n">_su</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/W&quot;</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">(</span>
                <span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
            <span class="p">),</span>
            <span class="s2">&quot;__streamdata__&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
            <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">cast</span><span class="p">(</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span><span class="o">.</span><span class="n">hash_bin</span><span class="p">()</span>  <span class="c1"># kept for future</span>
            <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_hash</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="n">init_data</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">INFO</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="n">init_data</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">PREV</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_startxref</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">:</span>
            <span class="n">init_data</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">ID</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>
        <span class="n">xr</span> <span class="o">=</span> <span class="n">StreamObject</span><span class="o">.</span><span class="n">initialize_from_dictionary</span><span class="p">(</span><span class="n">init_data</span><span class="p">)</span>
        <span class="n">xr</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt;BIB&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_pos</span> <span class="ow">in</span> <span class="n">object_positions</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">xr</span><span class="o">.</span><span class="n">write_to_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">startxref</span><span class="se">\n</span><span class="si">{</span><span class="n">xref_location</span><span class="si">}</span><span class="se">\n</span><span class="s2">%%EOF</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># eof</span>

    <span class="k">def</span> <span class="nf">_write_pdf_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">StreamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="n">object_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">free_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># will contain list of all free entries</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf_header</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;%</span><span class="se">\xE2\xE3\xCF\xD3\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">idnum</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">object_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idnum</span><span class="si">}</span><span class="s2"> 0 obj</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encryption</span> <span class="ow">and</span> <span class="n">obj</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encryption</span><span class="o">.</span><span class="n">encrypt_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">write_to_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">endobj</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">object_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">free_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">free_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># add 0 to loop in accordance with PDF spec</span>
        <span class="k">return</span> <span class="n">object_positions</span><span class="p">,</span> <span class="n">free_objects</span>

    <span class="k">def</span> <span class="nf">_write_xref_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">StreamType</span><span class="p">,</span> <span class="n">object_positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">free_objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">xref_location</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;xref</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">free_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0&gt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="mi">65535</span><span class="si">:</span><span class="s2">0&gt;5</span><span class="si">}</span><span class="s2"> f </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">free_idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">object_positions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">offset</span><span class="si">:</span><span class="s2">0&gt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="mi">0</span><span class="si">:</span><span class="s2">0&gt;5</span><span class="si">}</span><span class="s2"> n </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">free_objects</span><span class="p">[</span><span class="n">free_idx</span><span class="p">]</span><span class="si">:</span><span class="s2">0&gt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">0&gt;5</span><span class="si">}</span><span class="s2"> f </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="n">free_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">xref_location</span>

    <span class="k">def</span> <span class="nf">_write_trailer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">StreamType</span><span class="p">,</span> <span class="n">xref_location</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the PDF trailer to the stream.</span>

<span class="sd">        To quote the PDF specification:</span>
<span class="sd">            [The] trailer [gives] the location of the cross-reference table and</span>
<span class="sd">            of certain special objects within the body of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;trailer</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">trailer</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">SIZE</span><span class="p">):</span> <span class="n">NumberObject</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">ROOT</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trailer</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">INFO</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trailer</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">ID</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="p">:</span>
            <span class="n">trailer</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">TK</span><span class="o">.</span><span class="n">ENCRYPT</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_entry</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="n">trailer</span><span class="o">.</span><span class="n">write_to_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">startxref</span><span class="se">\n</span><span class="si">{</span><span class="n">xref_location</span><span class="si">}</span><span class="se">\n</span><span class="s2">%%EOF</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># eof</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DocumentInformation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve/set the PDF file&#39;s document information dictionary, if it exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: dict with the entries to be set. if None : remove the /Info entry from the pdf.</span>

<span class="sd">        Note that some PDF files use (XMP) metadata streams instead of document</span>
<span class="sd">        information dictionaries, and these metadata streams will not be</span>
<span class="sd">        accessed by this function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">DocumentInformation</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="PdfWriter.add_metadata">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_metadata">[文档]</a>
    <span class="k">def</span> <span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add custom metadata to the output.</span>

<span class="sd">        Args:</span>
<span class="sd">            infos: a Python dictionary where each key is a field</span>
<span class="sd">                and each value is your new metadata.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infos</span><span class="p">,</span> <span class="n">PdfObject</span><span class="p">):</span>
            <span class="n">infos</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">infos</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">infos</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PdfObject</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">create_string_object</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.compress_identical_objects">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.compress_identical_objects">[文档]</a>
    <span class="k">def</span> <span class="nf">compress_identical_objects</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">remove_identicals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">remove_orphans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the PDF file and merge objects that have the same hash.</span>
<span class="sd">        This will make objects common to multiple pages.</span>
<span class="sd">        Recommended to be used just before writing output.</span>

<span class="sd">        Args:</span>
<span class="sd">            remove_identicals: Remove identical objects.</span>
<span class="sd">            remove_orphans: Remove unreferenced objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">replace_in_obj</span><span class="p">(</span>
            <span class="n">obj</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">,</span> <span class="n">crossref</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">):</span>
                <span class="n">key_val</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">):</span>
                <span class="n">key_val</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">key_val</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
                    <span class="n">orphans</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">crossref</span><span class="p">:</span>
                        <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">crossref</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;the filtering on DictionaryObject and ArrayObject only</span>
<span class="sd">                    will be performed within replace_in_obj&quot;&quot;&quot;</span>
                    <span class="n">replace_in_obj</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">crossref</span><span class="p">)</span>

        <span class="c1"># _idnum_hash :dict[hash]=(1st_ind_obj,[other_indir_objs,...])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">orphans</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span>
        <span class="c1"># look for similar objects</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">hash_value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">remove_identicals</span> <span class="ow">and</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># generate the dict converting others to 1st</span>
        <span class="n">cnv</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idnum_hash</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">cnv_rev</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cnv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cnv_rev</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

        <span class="c1"># replace reference to merged objects</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">)):</span>
                <span class="n">replace_in_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cnv_rev</span><span class="p">)</span>

        <span class="c1"># remove orphans (if applicable)</span>
        <span class="n">orphans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># type: ignore</span>

        <span class="n">orphans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># type: ignore</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">orphans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># type: ignore</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">compress</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)),</span> <span class="n">orphans</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="nf">_sweep_indirect_references</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">ArrayObject</span><span class="p">,</span>
            <span class="n">BooleanObject</span><span class="p">,</span>
            <span class="n">DictionaryObject</span><span class="p">,</span>
            <span class="n">FloatObject</span><span class="p">,</span>
            <span class="n">IndirectObject</span><span class="p">,</span>
            <span class="n">NameObject</span><span class="p">,</span>
            <span class="n">PdfObject</span><span class="p">,</span>
            <span class="n">NumberObject</span><span class="p">,</span>
            <span class="n">TextStringObject</span><span class="p">,</span>
            <span class="n">NullObject</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># deprecated</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolving any circular references to Page objects.</span>

<span class="sd">        Circular references to Page objects can arise when objects such as</span>
<span class="sd">        annotations refer to their associated page. If these references are not</span>
<span class="sd">        properly handled, the PDF file will contain multiple copies of the same</span>
<span class="sd">        Page object. To address this problem, Page objects store their original</span>
<span class="sd">        object reference number. This method adds the reference number of any</span>
<span class="sd">        circularly referenced Page objects to an external reference map. This</span>
<span class="sd">        ensures that self-referencing trees reference the correct new object</span>
<span class="sd">        location, rather than copying in a new copy of the Page object.</span>

<span class="sd">        Args:</span>
<span class="sd">            root: The root of the PDF object tree to sweep.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deprecate</span><span class="p">(</span>
            <span class="s2">&quot;_sweep_indirect_references has been removed, please report to dev team if this warning is observed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_indirect_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">IndirectObject</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>  <span class="c1"># deprecated</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolves an indirect object to an indirect object in this PDF file.</span>

<span class="sd">        If the input indirect object already belongs to this PDF file, it is</span>
<span class="sd">        returned directly. Otherwise, the object is retrieved from the input</span>
<span class="sd">        object&#39;s PDF file using the object&#39;s ID number and generation number. If</span>
<span class="sd">        the object cannot be found, a warning is logged and a `NullObject` is</span>
<span class="sd">        returned.</span>

<span class="sd">        If the object is not already in this PDF file, it is added to the file&#39;s</span>
<span class="sd">        list of objects and assigned a new ID number and generation number of 0.</span>
<span class="sd">        The hash value of the object is then added to the `_idnum_hash`</span>
<span class="sd">        dictionary, with the corresponding `IndirectObject` reference as the</span>
<span class="sd">        value.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The `IndirectObject` to resolve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The resolved `IndirectObject` in this PDF file.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the input stream is closed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deprecate</span><span class="p">(</span>
            <span class="s2">&quot;_resolve_indirect_object has been removed, please report to dev team if this warning is observed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="PdfWriter.get_reference">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.get_reference">[文档]</a>
    <span class="k">def</span> <span class="nf">get_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="n">idnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">idnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ref</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span> <span class="o">==</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="n">ref</span></div>


<div class="viewcode-block" id="PdfWriter.get_outline_root">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.get_outline_root">[文档]</a>
    <span class="k">def</span> <span class="nf">get_outline_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TreeObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">CO</span><span class="o">.</span><span class="n">OUTLINES</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="c1"># Table 3.25 Entries in the catalog dictionary</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CO</span><span class="o">.</span><span class="n">OUTLINES</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replace_object</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">outline</span> <span class="o">=</span> <span class="n">t</span>
            <span class="n">idnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">outline_ref</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">idnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">outline_ref</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span> <span class="o">==</span> <span class="n">outline</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">()</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">update</span><span class="p">({})</span>
            <span class="n">outline_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CO</span><span class="o">.</span><span class="n">OUTLINES</span><span class="p">)]</span> <span class="o">=</span> <span class="n">outline_ref</span>

        <span class="k">return</span> <span class="n">outline</span></div>


<div class="viewcode-block" id="PdfWriter.get_threads_root">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.get_threads_root">[文档]</a>
    <span class="k">def</span> <span class="nf">get_threads_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The list of threads.</span>

<span class="sd">        See §12.4.3 of the PDF 1.7 or PDF 2.0 specification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An array (possibly empty) of Dictionaries with ``/F`` and</span>
<span class="sd">            ``/I`` properties.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">CO</span><span class="o">.</span><span class="n">THREADS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="c1"># Table 3.25 Entries in the catalog dictionary</span>
            <span class="n">threads</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">CO</span><span class="o">.</span><span class="n">THREADS</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threads</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CO</span><span class="o">.</span><span class="n">THREADS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">threads</span>
        <span class="k">return</span> <span class="n">threads</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read-only property for the list of threads.</span>

<span class="sd">        See §8.3.2 from PDF 1.7 spec.</span>

<span class="sd">        Each element is a dictionary with ``/F`` and ``/I`` keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_threads_root</span><span class="p">()</span>

<div class="viewcode-block" id="PdfWriter.add_outline_item_destination">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_outline_item_destination">[文档]</a>
    <span class="k">def</span> <span class="nf">add_outline_item_destination</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_destination</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">],</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="n">page_destination</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">PageObject</span><span class="p">,</span> <span class="n">page_destination</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page_destination</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_outline_item_destination</span><span class="p">(</span>
                <span class="n">Destination</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;page #</span><span class="si">{</span><span class="n">page_destination</span><span class="o">.</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">cast</span><span class="p">(</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">page_destination</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">),</span>
                    <span class="n">Fit</span><span class="o">.</span><span class="n">fit</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline_root</span><span class="p">()</span>

        <span class="n">page_destination</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">%i</span><span class="s2">s_open%&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BooleanObject</span><span class="p">(</span><span class="n">is_open</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeObject</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="n">page_destination_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">page_destination</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">before</span> <span class="o">=</span> <span class="n">before</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert_child</span><span class="p">(</span>
            <span class="n">page_destination_ref</span><span class="p">,</span>
            <span class="n">before</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">page_destination</span><span class="o">.</span><span class="n">inc_parent_counter_outline</span>
            <span class="k">if</span> <span class="n">is_open</span>
            <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/Count&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page_destination</span><span class="p">:</span>
            <span class="n">page_destination</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Count&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">page_destination_ref</span></div>


<div class="viewcode-block" id="PdfWriter.add_outline_item_dict">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_outline_item_dict">[文档]</a>
    <span class="k">def</span> <span class="nf">add_outline_item_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outline_item</span><span class="p">:</span> <span class="n">OutlineItemType</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="n">outline_item_object</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">()</span>
        <span class="n">outline_item_object</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outline_item</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;code currently unreachable</span>
<span class="sd">        if &quot;/A&quot; in outline_item:</span>
<span class="sd">            action = DictionaryObject()</span>
<span class="sd">            a_dict = cast(DictionaryObject, outline_item[&quot;/A&quot;])</span>
<span class="sd">            for k, v in list(a_dict.items()):</span>
<span class="sd">                action[NameObject(str(k))] = v</span>
<span class="sd">            action_ref = self._add_object(action)</span>
<span class="sd">            outline_item_object[NameObject(&quot;/A&quot;)] = action_ref</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_outline_item_destination</span><span class="p">(</span>
            <span class="n">outline_item_object</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">is_open</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.add_outline_item">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_outline_item">[文档]</a>
    <span class="k">def</span> <span class="nf">add_outline_item</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">page_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">italic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fit</span><span class="p">:</span> <span class="n">Fit</span> <span class="o">=</span> <span class="n">PAGE_FIT</span><span class="p">,</span>
        <span class="n">is_open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an outline item (commonly referred to as a &quot;Bookmark&quot;) to the PDF file.</span>

<span class="sd">        Args:</span>
<span class="sd">            title: Title to use for this outline item.</span>
<span class="sd">            page_number: Page number this outline item will point to.</span>
<span class="sd">            parent: A reference to a parent outline item to create nested</span>
<span class="sd">                outline items.</span>
<span class="sd">            before:</span>
<span class="sd">            color: Color of the outline item&#39;s font as a red, green, blue tuple</span>
<span class="sd">                from 0.0 to 1.0 or as a Hex String (#RRGGBB)</span>
<span class="sd">            bold: Outline item font is bold</span>
<span class="sd">            italic: Outline item font is italic</span>
<span class="sd">            fit: The fit of the destination page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The added outline item as an indirect object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page_ref</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">,</span> <span class="n">NumberObject</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">italic</span><span class="p">,</span> <span class="n">Fit</span><span class="p">):</span>  <span class="c1"># it means that we are on the old params</span>
            <span class="k">if</span> <span class="n">fit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">page_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">page_number</span> <span class="o">=</span> <span class="n">fit</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_outline_item</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span> <span class="n">page_number</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">bold</span><span class="p">,</span> <span class="n">italic</span><span class="p">,</span> <span class="n">is_open</span><span class="o">=</span><span class="n">is_open</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">page_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page_number</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
                <span class="n">page_ref</span> <span class="o">=</span> <span class="n">page_number</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page_number</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
                <span class="n">page_ref</span> <span class="o">=</span> <span class="n">page_number</span><span class="o">.</span><span class="n">indirect_reference</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">page_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">page_number</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">page_ref</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">page_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger_warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;can not find reference of page </span><span class="si">{</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">page_ref</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">Destination</span><span class="p">(</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s2">&quot; outline item&quot;</span><span class="p">),</span>
                <span class="n">page_ref</span><span class="p">,</span>
                <span class="n">fit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">action_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                <span class="n">DictionaryObject</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="n">NameObject</span><span class="p">(</span><span class="n">GoToActionArguments</span><span class="o">.</span><span class="n">D</span><span class="p">):</span> <span class="n">dest</span><span class="o">.</span><span class="n">dest_array</span><span class="p">,</span>
                        <span class="n">NameObject</span><span class="p">(</span><span class="n">GoToActionArguments</span><span class="o">.</span><span class="n">S</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/GoTo&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">outline_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
            <span class="n">_create_outline_item</span><span class="p">(</span><span class="n">action_ref</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">italic</span><span class="p">,</span> <span class="n">bold</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline_root</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_outline_item_destination</span><span class="p">(</span><span class="n">outline_item</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">is_open</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.add_outline">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_outline">[文档]</a>
    <span class="k">def</span> <span class="nf">add_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This method is not yet implemented. Use :meth:`add_outline_item` instead.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.add_named_destination_array">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_named_destination_array">[文档]</a>
    <span class="k">def</span> <span class="nf">add_named_destination_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">TextStringObject</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">ArrayObject</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">named_dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_named_dest_root</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">named_dest</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">&lt;</span> <span class="n">named_dest</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">named_dest</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="n">named_dest</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">named_dest</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">TextStringObject</span><span class="p">(</span><span class="n">title</span><span class="p">),</span> <span class="n">destination</span><span class="p">])</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="PdfWriter.add_named_destination_object">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_named_destination_object">[文档]</a>
    <span class="k">def</span> <span class="nf">add_named_destination_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_destination</span><span class="p">:</span> <span class="n">PdfObject</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="n">page_destination_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">page_destination</span><span class="o">.</span><span class="n">dest_array</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_named_destination_array</span><span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;TextStringObject&quot;</span><span class="p">,</span> <span class="n">page_destination</span><span class="p">[</span><span class="s2">&quot;/Title&quot;</span><span class="p">]),</span> <span class="n">page_destination_ref</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">page_destination_ref</span></div>


<div class="viewcode-block" id="PdfWriter.add_named_destination">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_named_destination">[文档]</a>
    <span class="k">def</span> <span class="nf">add_named_destination</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">page_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
        <span class="n">page_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">)[</span><span class="n">PA</span><span class="o">.</span><span class="n">KIDS</span><span class="p">][</span><span class="n">page_number</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">GoToActionArguments</span><span class="o">.</span><span class="n">D</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">page_ref</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">TypFitArguments</span><span class="o">.</span><span class="n">FIT_H</span><span class="p">),</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">826</span><span class="p">)]</span>
                <span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">GoToActionArguments</span><span class="o">.</span><span class="n">S</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/GoTo&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">dest_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">TextStringObject</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_named_destination_array</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">dest_ref</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dest_ref</span></div>


<div class="viewcode-block" id="PdfWriter.remove_links">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.remove_links">[文档]</a>
    <span class="k">def</span> <span class="nf">remove_links</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove links and annotations from this output.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_objects_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">ALL_ANNOTATIONS</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.remove_annotations">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.remove_annotations">[文档]</a>
    <span class="k">def</span> <span class="nf">remove_annotations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AnnotationSubtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AnnotationSubtype</span><span class="p">]]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove annotations by annotation subtype.</span>

<span class="sd">        Args:</span>
<span class="sd">            subtypes: subtype or list of subtypes to be removed.</span>
<span class="sd">                Examples are: &quot;/Link&quot;, &quot;/FileAttachment&quot;, &quot;/Sound&quot;,</span>
<span class="sd">                &quot;/Movie&quot;, &quot;/Screen&quot;, ...</span>
<span class="sd">                If you want to remove all annotations, use subtypes=None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_annots_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">subtypes</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_remove_annots_from_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">],</span>
        <span class="n">subtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">])):</span>
                <span class="n">an</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">])[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">an</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">subtypes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">an</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>  <span class="c1"># to reduce PDF size</span>
                    <span class="k">del</span> <span class="n">page</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># type:ignore</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<div class="viewcode-block" id="PdfWriter.remove_objects_from_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.remove_objects_from_page">[文档]</a>
    <span class="k">def</span> <span class="nf">remove_objects_from_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PageObject</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">],</span>
        <span class="n">to_delete</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ObjectDeletionFlag</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ObjectDeletionFlag</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove objects specified by ``to_delete`` from the given page.</span>

<span class="sd">        Args:</span>
<span class="sd">            page: Page object to clean up.</span>
<span class="sd">            to_delete: Objects to be deleted; can be a ``ObjectDeletionFlag``</span>
<span class="sd">                or a list of ObjectDeletionFlag</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">to_d</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_objects_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">to_d</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="n">ObjectDeletionFlag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">LINKS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_annots_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/Link&quot;</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">ATTACHMENTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_annots_from_page</span><span class="p">(</span>
                <span class="n">page</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/FileAttachment&quot;</span><span class="p">,</span> <span class="s2">&quot;/Sound&quot;</span><span class="p">,</span> <span class="s2">&quot;/Movie&quot;</span><span class="p">,</span> <span class="s2">&quot;/Screen&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">OBJECTS_3D</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_annots_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/3D&quot;</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">ALL_ANNOTATIONS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_annots_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">jump_operators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">DRAWING_IMAGES</span><span class="p">:</span>
            <span class="n">jump_operators</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;i&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;W*&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;b*&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;B*&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;f*&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;n&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;re&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;sh&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">TEXT</span><span class="p">:</span>
            <span class="n">jump_operators</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Tj&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;TJ&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&quot;&#39;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="n">ContentStream</span><span class="p">,</span> <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">forms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">jump_operators</span><span class="p">,</span> <span class="n">to_delete</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">operations</span><span class="p">):</span>
                <span class="n">operands</span><span class="p">,</span> <span class="n">operator</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">operations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;INLINE IMAGE&quot;</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">INLINE_IMAGES</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="n">operator</span> <span class="ow">in</span> <span class="n">jump_operators</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">operator</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Do&quot;</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">XOBJECT_IMAGES</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">del</span> <span class="n">content</span><span class="o">.</span><span class="n">operations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">content</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>  <span class="c1"># this ensures ._data is rebuilt from the .operations</span>

        <span class="k">def</span> <span class="nf">clean_forms</span><span class="p">(</span>
            <span class="n">elt</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">nonlocal</span> <span class="n">to_delete</span>
            <span class="c1"># elt in recursive call is a new ContentStream object, so we have to check the indirect_reference</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">elt</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">elt</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;indirect_reference&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stack</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># to prevent infinite looping</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                    <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">elt</span><span class="p">[</span><span class="s2">&quot;/Resources&quot;</span><span class="p">])[</span><span class="s2">&quot;/XObject&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">forms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">XOBJECT_IMAGES</span>
                        <span class="ow">and</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/Image&quot;</span>
                    <span class="p">):</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>  <span class="c1"># to delete the image keeping the entry</span>
                        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/Form&quot;</span><span class="p">:</span>
                        <span class="n">forms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ContentStream</span><span class="p">):</span>
                            <span class="n">content</span> <span class="o">=</span> <span class="n">o</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">content</span> <span class="o">=</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                            <span class="n">content</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="n">k1</span><span class="p">:</span> <span class="n">v1</span>
                                    <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="n">k1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;/Length&quot;</span><span class="p">,</span> <span class="s2">&quot;/Filter&quot;</span><span class="p">,</span> <span class="s2">&quot;/DecodeParms&quot;</span><span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">content</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">indirect_reference</span>
                            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                                <span class="k">pass</span>
                        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
                        <span class="n">clean_forms</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>  <span class="c1"># clean subforms</span>
                    <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">idnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># should only occur in a PDF not respecting PDF spec</span>
                            <span class="c1"># where streams must be indirected.</span>
                            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">im</span><span class="p">]</span>  <span class="c1"># for clean-up</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">StreamObject</span><span class="p">):</span>  <span class="c1"># for /Form</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">ContentStream</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">ContentStream</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                    <span class="n">elt</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">clean</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">forms</span><span class="p">)</span>  <span class="c1"># clean the content</span>
            <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">forms</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">PageObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">if</span> <span class="s2">&quot;/Contents&quot;</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ContentStream</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">get_contents</span><span class="p">())</span>

            <span class="n">images</span><span class="p">,</span> <span class="n">forms</span> <span class="o">=</span> <span class="n">clean_forms</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">clean</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">forms</span><span class="p">)</span>
            <span class="n">page</span><span class="o">.</span><span class="n">replace_contents</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.remove_images">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.remove_images">[文档]</a>
    <span class="k">def</span> <span class="nf">remove_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to_delete</span><span class="p">:</span> <span class="n">ImageType</span> <span class="o">=</span> <span class="n">ImageType</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove images from this output.</span>

<span class="sd">        Args:</span>
<span class="sd">            to_delete: The type of images to be deleted</span>
<span class="sd">                (default = all images types)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">to_delete</span> <span class="o">=</span> <span class="n">ImageType</span><span class="o">.</span><span class="n">ALL</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">NONE</span>

        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;XOBJECT_IMAGES&quot;</span><span class="p">,</span> <span class="s2">&quot;INLINE_IMAGES&quot;</span><span class="p">,</span> <span class="s2">&quot;DRAWING_IMAGES&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">to_delete</span> <span class="o">&amp;</span> <span class="n">ImageType</span><span class="p">[</span><span class="n">image</span><span class="p">]:</span>
                <span class="n">i</span> <span class="o">|=</span> <span class="n">ObjectDeletionFlag</span><span class="p">[</span><span class="n">image</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_objects_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.remove_text">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.remove_text">[文档]</a>
    <span class="k">def</span> <span class="nf">remove_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove text from this output.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_objects_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">ObjectDeletionFlag</span><span class="o">.</span><span class="n">TEXT</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.add_uri">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_uri">[文档]</a>
    <span class="k">def</span> <span class="nf">add_uri</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rect</span><span class="p">:</span> <span class="n">RectangleObject</span><span class="p">,</span>
        <span class="n">border</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an URI from a rectangular area to the specified page.</span>

<span class="sd">        Args:</span>
<span class="sd">            page_number: index of the page on which to place the URI action.</span>
<span class="sd">            uri: URI of resource to link to.</span>
<span class="sd">            rect: :class:`RectangleObject&lt;pypdf.generic.RectangleObject&gt;` or</span>
<span class="sd">                array of four integers specifying the clickable rectangular area</span>
<span class="sd">                ``[xLL, yLL, xUR, yUR]``, or string in the form</span>
<span class="sd">                ``&quot;[ xLL yLL xUR yUR ]&quot;``.</span>
<span class="sd">            border: if provided, an array describing border-drawing</span>
<span class="sd">                properties. See the PDF spec for details. No border will be</span>
<span class="sd">                drawn if this argument is omitted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">)[</span><span class="n">PA</span><span class="o">.</span><span class="n">KIDS</span><span class="p">][</span><span class="n">page_number</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">page_ref</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">page_link</span><span class="p">))</span>

        <span class="n">border_arr</span><span class="p">:</span> <span class="n">BorderArrayType</span>
        <span class="k">if</span> <span class="n">border</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">border_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">border</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">border</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">dash_pattern</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">border</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="n">border_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dash_pattern</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">border_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">NumberObject</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">RectangleObject</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">RectangleObject</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

        <span class="n">lnk2</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">lnk2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/S&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/URI&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/URI&quot;</span><span class="p">):</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">uri</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">lnk</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">lnk</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">Type</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Annot&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">Subtype</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Link&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">P</span><span class="p">):</span> <span class="n">page_link</span><span class="p">,</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">Rect</span><span class="p">):</span> <span class="n">rect</span><span class="p">,</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/H&quot;</span><span class="p">):</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/I&quot;</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">Border</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">(</span><span class="n">border_arr</span><span class="p">),</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/A&quot;</span><span class="p">):</span> <span class="n">lnk2</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">lnk_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">lnk</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span> <span class="ow">in</span> <span class="n">page_ref</span><span class="p">:</span>
            <span class="n">page_ref</span><span class="p">[</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lnk_ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">page_ref</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">PG</span><span class="o">.</span><span class="n">ANNOTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">lnk_ref</span><span class="p">])</span></div>


    <span class="n">_valid_layouts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;/NoLayout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/SinglePage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/OneColumn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/TwoColumnLeft&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/TwoColumnRight&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/TwoPageLeft&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/TwoPageRight&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_page_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LayoutType</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">LayoutType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/PageLayout&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_set_page_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NameObject</span><span class="p">,</span> <span class="n">LayoutType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the page layout.</span>

<span class="sd">        Args:</span>
<span class="sd">            layout: The page layout to be used.</span>

<span class="sd">        .. list-table:: Valid ``layout`` arguments</span>
<span class="sd">           :widths: 50 200</span>

<span class="sd">           * - /NoLayout</span>
<span class="sd">             - Layout explicitly not specified</span>
<span class="sd">           * - /SinglePage</span>
<span class="sd">             - Show one page at a time</span>
<span class="sd">           * - /OneColumn</span>
<span class="sd">             - Show one column at a time</span>
<span class="sd">           * - /TwoColumnLeft</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoColumnRight</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the right</span>
<span class="sd">           * - /TwoPageLeft</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoPageRight</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the right</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">layout</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_layouts</span><span class="p">:</span>
                <span class="n">logger_warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Layout should be one of: </span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_layouts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/PageLayout&quot;</span><span class="p">):</span> <span class="n">layout</span><span class="p">})</span>

<div class="viewcode-block" id="PdfWriter.set_page_layout">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.set_page_layout">[文档]</a>
    <span class="k">def</span> <span class="nf">set_page_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">LayoutType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the page layout.</span>

<span class="sd">        Args:</span>
<span class="sd">            layout: The page layout to be used</span>

<span class="sd">        .. list-table:: Valid ``layout`` arguments</span>
<span class="sd">           :widths: 50 200</span>

<span class="sd">           * - /NoLayout</span>
<span class="sd">             - Layout explicitly not specified</span>
<span class="sd">           * - /SinglePage</span>
<span class="sd">             - Show one page at a time</span>
<span class="sd">           * - /OneColumn</span>
<span class="sd">             - Show one column at a time</span>
<span class="sd">           * - /TwoColumnLeft</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoColumnRight</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the right</span>
<span class="sd">           * - /TwoPageLeft</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoPageRight</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the right</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_page_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">page_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LayoutType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Page layout property.</span>

<span class="sd">        .. list-table:: Valid ``layout`` values</span>
<span class="sd">           :widths: 50 200</span>

<span class="sd">           * - /NoLayout</span>
<span class="sd">             - Layout explicitly not specified</span>
<span class="sd">           * - /SinglePage</span>
<span class="sd">             - Show one page at a time</span>
<span class="sd">           * - /OneColumn</span>
<span class="sd">             - Show one column at a time</span>
<span class="sd">           * - /TwoColumnLeft</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoColumnRight</span>
<span class="sd">             - Show pages in two columns, odd-numbered pages on the right</span>
<span class="sd">           * - /TwoPageLeft</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the left</span>
<span class="sd">           * - /TwoPageRight</span>
<span class="sd">             - Show two pages at a time, odd-numbered pages on the right</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_page_layout</span><span class="p">()</span>

    <span class="nd">@page_layout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">page_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">LayoutType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_page_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

    <span class="n">_valid_modes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;/UseNone&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/UseOutlines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/UseThumbs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/FullScreen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/UseOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/UseAttachments&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_page_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PagemodeType</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">PagemodeType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/PageMode&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">page_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PagemodeType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Page mode property.</span>

<span class="sd">        .. list-table:: Valid ``mode`` values</span>
<span class="sd">           :widths: 50 200</span>

<span class="sd">           * - /UseNone</span>
<span class="sd">             - Do not show outline or thumbnails panels</span>
<span class="sd">           * - /UseOutlines</span>
<span class="sd">             - Show outline (aka bookmarks) panel</span>
<span class="sd">           * - /UseThumbs</span>
<span class="sd">             - Show page thumbnails panel</span>
<span class="sd">           * - /FullScreen</span>
<span class="sd">             - Fullscreen view</span>
<span class="sd">           * - /UseOC</span>
<span class="sd">             - Show Optional Content Group (OCG) panel</span>
<span class="sd">           * - /UseAttachments</span>
<span class="sd">             - Show attachments panel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_page_mode</span><span class="p">()</span>

    <span class="nd">@page_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">page_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">PagemodeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
            <span class="n">mode_name</span><span class="p">:</span> <span class="n">NameObject</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_modes</span><span class="p">:</span>
                <span class="n">logger_warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Mode should be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="n">mode_name</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/PageMode&quot;</span><span class="p">):</span> <span class="n">mode_name</span><span class="p">})</span>

<div class="viewcode-block" id="PdfWriter.add_annotation">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_annotation">[文档]</a>
    <span class="k">def</span> <span class="nf">add_annotation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">annotation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DictionaryObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a single annotation to the page.</span>
<span class="sd">        The added annotation must be a new annotation.</span>
<span class="sd">        It cannot be recycled.</span>

<span class="sd">        Args:</span>
<span class="sd">            page_number: PageObject or page index.</span>
<span class="sd">            annotation: Annotation to be added (created with annotation).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The inserted object.</span>
<span class="sd">            This can be used for popup creation, for example.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">page_number</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">page</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;page: invalid type&quot;</span><span class="p">)</span>

        <span class="n">to_add</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">_pdf_objectify</span><span class="p">(</span><span class="n">annotation</span><span class="p">))</span>
        <span class="n">to_add</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/P&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">indirect_reference</span>

        <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">annotations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">page</span><span class="o">.</span><span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># Internal link annotations need the correct object type for the</span>
        <span class="c1"># destination</span>
        <span class="k">if</span> <span class="n">to_add</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Link&quot;</span> <span class="ow">and</span> <span class="s2">&quot;/Dest&quot;</span> <span class="ow">in</span> <span class="n">to_add</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">to_add</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">)])</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">Destination</span><span class="p">(</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/LinkName&quot;</span><span class="p">),</span>
                <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;target_page_index&quot;</span><span class="p">],</span>
                <span class="n">Fit</span><span class="p">(</span>
                    <span class="n">fit_type</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;fit&quot;</span><span class="p">],</span> <span class="n">fit_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tmp</span><span class="p">)[</span><span class="s2">&quot;fit_args&quot;</span><span class="p">]</span>
                <span class="p">),</span>  <span class="c1"># I have no clue why this dict-hack is necessary</span>
            <span class="p">)</span>
            <span class="n">to_add</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">dest_array</span>

        <span class="n">page</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">to_add</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">to_add</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Popup&quot;</span> <span class="ow">and</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Parent&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">to_add</span><span class="p">:</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="n">to_add</span><span class="p">[</span><span class="s2">&quot;/Parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_object</span><span class="p">())[</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Popup&quot;</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">to_add</span><span class="o">.</span><span class="n">indirect_reference</span>

        <span class="k">return</span> <span class="n">to_add</span></div>


<div class="viewcode-block" id="PdfWriter.clean_page">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.clean_page">[文档]</a>
    <span class="k">def</span> <span class="nf">clean_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PageObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PageObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform some clean up in the page.</span>
<span class="sd">        Currently: convert NameObject named destination to TextStringObject</span>
<span class="sd">        (required for names/dests list)</span>

<span class="sd">        Args:</span>
<span class="sd">            page:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The cleaned PageObject</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">a_obj</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">a_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">act</span> <span class="o">=</span> <span class="n">a_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/A&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
                <span class="n">a_obj</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">act</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">act</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/D&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">NameObject</span><span class="p">):</span>
                    <span class="n">act</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/D&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">page</span></div>


    <span class="k">def</span> <span class="nf">_create_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">StrByteType</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">IOBase</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Encryption</span><span class="p">]]:</span>
        <span class="c1"># If the fileobj parameter is a string, assume it is a path</span>
        <span class="c1"># and create a file object at that location. If it is a file,</span>
        <span class="c1"># copy the file&#39;s contents into a BytesIO stream object; if</span>
        <span class="c1"># it is a PdfReader, copy that reader&#39;s stream into a</span>
        <span class="c1"># BytesIO stream.</span>
        <span class="c1"># If fileobj is none of the above types, it is not modified</span>
        <span class="n">encryption_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">stream</span><span class="p">:</span> <span class="n">IOBase</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">_encryption</span><span class="p">:</span>
                <span class="n">encryption_obj</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">_encryption</span>
            <span class="n">orig_tell</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">fileobj</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">fileobj</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

            <span class="c1"># reset the stream to its original location</span>
            <span class="n">fileobj</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">orig_tell</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s2">&quot;seek&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
            <span class="n">fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">filecontent</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">filecontent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Merging requires an object that PdfReader can parse. &quot;</span>
                <span class="s2">&quot;Typically, that is a Path or a string representing a Path, &quot;</span>
                <span class="s2">&quot;a file object, or an object implementing .seek and .read. &quot;</span>
                <span class="s2">&quot;Passing a PdfReader directly works as well.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span><span class="p">,</span> <span class="n">encryption_obj</span>

<div class="viewcode-block" id="PdfWriter.append">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.append">[文档]</a>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fileobj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">StrByteType</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">outline_item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">PageRange</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">PageRange</span><span class="p">,</span>
            <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
            <span class="n">List</span><span class="p">[</span><span class="n">PageObject</span><span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">import_outline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">excluded_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identical to the :meth:`merge()&lt;merge&gt;` method, but assumes you want to</span>
<span class="sd">        concatenate all pages onto the end of the file instead of specifying a</span>
<span class="sd">        position.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileobj: A File Object or an object that supports the standard</span>
<span class="sd">                read and seek methods similar to a File Object. Could also be a</span>
<span class="sd">                string representing a path to a PDF file.</span>
<span class="sd">            outline_item: Optionally, you may specify a string to build an</span>
<span class="sd">                outline (aka &#39;bookmark&#39;) to identify the beginning of the</span>
<span class="sd">                included file.</span>
<span class="sd">            pages: Can be a :class:`PageRange&lt;pypdf.pagerange.PageRange&gt;`</span>
<span class="sd">                or a ``(start, stop[, step])`` tuple</span>
<span class="sd">                or a list of pages to be processed</span>
<span class="sd">                to merge only the specified range of pages from the source</span>
<span class="sd">                document into the output document.</span>
<span class="sd">            import_outline: You may prevent the source document&#39;s</span>
<span class="sd">                outline (collection of outline items, previously referred to as</span>
<span class="sd">                &#39;bookmarks&#39;) from being imported by specifying this as ``False``.</span>
<span class="sd">            excluded_fields: Provide the list of fields/keys to be ignored</span>
<span class="sd">                if ``/Annots`` is part of the list, the annotation will be ignored</span>
<span class="sd">                if ``/B`` is part of the list, the articles will be ignored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">excluded_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">excluded_fields</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outline_item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">PageRange</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">import_outline</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">excluded_fields</span> <span class="o">=</span> <span class="n">import_outline</span>
                <span class="n">import_outline</span> <span class="o">=</span> <span class="n">pages</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="n">outline_item</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">fileobj</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">pages</span><span class="p">,</span>
                <span class="n">import_outline</span><span class="p">,</span>
                <span class="n">excluded_fields</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if isinstance(outline_item,str):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">fileobj</span><span class="p">,</span>
                <span class="n">outline_item</span><span class="p">,</span>
                <span class="n">pages</span><span class="p">,</span>
                <span class="n">import_outline</span><span class="p">,</span>
                <span class="n">excluded_fields</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.merge">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.merge">[文档]</a>
    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">fileobj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">StrByteType</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">],</span>
        <span class="n">outline_item</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">PageRangeSpec</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PageObject</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">import_outline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">excluded_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge the pages from the given file into the output file at the</span>
<span class="sd">        specified page number.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: The *page number* to insert this file. File will</span>
<span class="sd">                be inserted after the given number.</span>
<span class="sd">            fileobj: A File Object or an object that supports the standard</span>
<span class="sd">                read and seek methods similar to a File Object. Could also be a</span>
<span class="sd">                string representing a path to a PDF file.</span>
<span class="sd">            outline_item: Optionally, you may specify a string to build an outline</span>
<span class="sd">                (aka &#39;bookmark&#39;) to identify the</span>
<span class="sd">                beginning of the included file.</span>
<span class="sd">            pages: can be a :class:`PageRange&lt;pypdf.pagerange.PageRange&gt;`</span>
<span class="sd">                or a ``(start, stop[, step])`` tuple</span>
<span class="sd">                or a list of pages to be processed</span>
<span class="sd">                to merge only the specified range of pages from the source</span>
<span class="sd">                document into the output document.</span>
<span class="sd">            import_outline: You may prevent the source document&#39;s</span>
<span class="sd">                outline (collection of outline items, previously referred to as</span>
<span class="sd">                &#39;bookmarks&#39;) from being imported by specifying this as ``False``.</span>
<span class="sd">            excluded_fields: provide the list of fields/keys to be ignored</span>
<span class="sd">                if ``/Annots`` is part of the list, the annotation will be ignored</span>
<span class="sd">                if ``/B`` is part of the list, the articles will be ignored</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: The pages attribute is not configured properly</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">PdfDocCommon</span><span class="p">):</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">fileobj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stream</span><span class="p">,</span> <span class="n">encryption_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stream</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
            <span class="c1"># Create a new PdfReader instance using the stream</span>
            <span class="c1"># (either file or BytesIO or StringIO) created above</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

        <span class="k">if</span> <span class="n">excluded_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">excluded_fields</span> <span class="o">=</span> <span class="p">()</span>
        <span class="c1"># Find the range of pages to merge.</span>
        <span class="k">if</span> <span class="n">pages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="n">PageRange</span><span class="p">):</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">pages</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">pass</span>  <span class="c1"># keep unchanged</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">pages</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;&quot;pages&quot; must be a tuple of (start, stop[, step]) or a list&#39;</span>
            <span class="p">)</span>

        <span class="n">srcpages</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">):</span>
                <span class="n">pg</span> <span class="o">=</span> <span class="n">page</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pg</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">page</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">pg</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># numbers in the exclude list identifies that the exclusion is</span>
                <span class="c1"># only applicable to 1st level of cloning</span>
                <span class="n">srcpages</span><span class="p">[</span><span class="n">pg</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span>
                    <span class="n">pg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">excluded_fields</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;/B&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;/Annots&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">srcpages</span><span class="p">[</span><span class="n">pg</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_page</span><span class="p">(</span>
                    <span class="n">pg</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">excluded_fields</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;/B&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;/Annots&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">srcpages</span><span class="p">[</span><span class="n">pg</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span><span class="p">]</span><span class="o">.</span><span class="n">original_page</span> <span class="o">=</span> <span class="n">pg</span>

        <span class="n">reader</span><span class="o">.</span><span class="n">_named_destinations</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">named_destinations</span>
        <span class="p">)</span>  <span class="c1"># need for the outline processing below</span>

        <span class="n">arr</span><span class="p">:</span> <span class="n">Any</span>

        <span class="k">def</span> <span class="nf">_process_named_dests</span><span class="p">(</span><span class="n">dest</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">dest_array</span>
            <span class="k">if</span> <span class="s2">&quot;/Names&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span> <span class="ow">and</span> <span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Title&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">DictionaryObject</span><span class="p">,</span>
                    <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/Names&quot;</span><span class="p">])[</span><span class="s2">&quot;/Dests&quot;</span><span class="p">],</span>
                <span class="p">)[</span><span class="s2">&quot;/Names&quot;</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="c1"># already exists: should not duplicate it</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">],</span> <span class="n">NullObject</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="c1"># the page reference is a page number normally not a PDF Reference</span>
                <span class="c1"># page numbers as int are normally accepted only in external goto</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">]]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">arr</span><span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span>
                        <span class="n">srcpages</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span><span class="p">]</span><span class="o">.</span><span class="n">page_number</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_named_destination_array</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Title&quot;</span><span class="p">],</span> <span class="n">arr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="ow">in</span> <span class="n">srcpages</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">srcpages</span><span class="p">[</span>
                    <span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span>
                <span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_named_destination_array</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Title&quot;</span><span class="p">],</span> <span class="n">arr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">_named_destinations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">_process_named_dests</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>

        <span class="n">outline_item_typ</span><span class="p">:</span> <span class="n">TreeObject</span>
        <span class="k">if</span> <span class="n">outline_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outline_item_typ</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;TreeObject&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_outline_item</span><span class="p">(</span>
                    <span class="n">TextStringObject</span><span class="p">(</span><span class="n">outline_item</span><span class="p">),</span>
                    <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">srcpages</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">,</span>
                    <span class="n">fit</span><span class="o">=</span><span class="n">PAGE_FIT</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outline_item_typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline_root</span><span class="p">()</span>

        <span class="n">_ro</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">root_object</span>
        <span class="k">if</span> <span class="n">import_outline</span> <span class="ow">and</span> <span class="n">CO</span><span class="o">.</span><span class="n">OUTLINES</span> <span class="ow">in</span> <span class="n">_ro</span><span class="p">:</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_outline</span><span class="p">(</span>
                <span class="n">_ro</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CO</span><span class="o">.</span><span class="n">OUTLINES</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">srcpages</span><span class="p">,</span> <span class="n">reader</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_insert_filtered_outline</span><span class="p">(</span>
                <span class="n">outline</span><span class="p">,</span> <span class="n">outline_item_typ</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>  <span class="c1"># TODO: use before parameter</span>

        <span class="k">if</span> <span class="s2">&quot;/Annots&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_fields</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pag</span> <span class="ow">in</span> <span class="n">srcpages</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_filtered_annotations</span><span class="p">(</span>
                    <span class="n">pag</span><span class="o">.</span><span class="n">original_page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">,</span> <span class="p">()),</span> <span class="n">pag</span><span class="p">,</span> <span class="n">srcpages</span><span class="p">,</span> <span class="n">reader</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pag</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Annots&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lst</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clean_page</span><span class="p">(</span><span class="n">pag</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;/AcroForm&quot;</span> <span class="ow">in</span> <span class="n">_ro</span> <span class="ow">and</span> <span class="n">_ro</span><span class="p">[</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;/AcroForm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                    <span class="n">cast</span><span class="p">(</span>
                        <span class="n">DictionaryObject</span><span class="p">,</span>
                        <span class="n">reader</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">],</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;/Fields&quot;</span><span class="p">,))</span>
                <span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">ArrayObject</span><span class="p">,</span>
                    <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">])[</span><span class="s2">&quot;/Fields&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="n">trslat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">reader</span><span class="p">)]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">root_object</span><span class="p">[</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">][</span><span class="s2">&quot;/Fields&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">IndirectObject</span><span class="p">(</span><span class="n">trslat</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">idnum</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
                            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="c1"># for trslat[] which mean the field has not be copied</span>
                        <span class="c1"># through the page</span>
                        <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># for /Acroform or /Fields are not existing</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">())</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="s2">&quot;/AcroForm&quot;</span><span class="p">])[</span>
                <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Fields&quot;</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>

        <span class="k">if</span> <span class="s2">&quot;/B&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_fields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_filtered_articles</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">srcpages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_add_articles_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">thread</span><span class="p">:</span> <span class="n">DictionaryObject</span><span class="p">,</span>  <span class="c1"># thread entry from the reader&#39;s array of threads</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clone the thread with only the applicable articles.</span>

<span class="sd">        Args:</span>
<span class="sd">            thread:</span>
<span class="sd">            pages:</span>
<span class="sd">            reader:</span>

<span class="sd">        Returns:</span>
<span class="sd">            The added thread as an indirect reference</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nthread</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">force_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_fields</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">,)</span>
        <span class="p">)</span>  <span class="c1"># use of clone to keep link between reader and writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nthread</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
        <span class="n">first_article</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">thread</span><span class="p">[</span><span class="s2">&quot;/F&quot;</span><span class="p">])</span>
        <span class="n">current_article</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_article</span>
        <span class="n">new_article</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">current_article</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cloned_page</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">current_article</span><span class="p">[</span><span class="s2">&quot;/P&quot;</span><span class="p">]),</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">pag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_article</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_article</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                        <span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">DictionaryObject</span><span class="p">())</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="n">new_first</span> <span class="o">=</span> <span class="n">new_article</span>
                    <span class="n">nthread</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_article</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_article2</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                        <span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span>
                            <span class="n">DictionaryObject</span><span class="p">(</span>
                                <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/V&quot;</span><span class="p">):</span> <span class="n">new_article</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">}</span>
                            <span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">get_object</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="n">new_article</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_article2</span><span class="o">.</span><span class="n">indirect_reference</span>
                    <span class="n">new_article</span> <span class="o">=</span> <span class="n">new_article2</span>
                <span class="n">new_article</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/P&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pag</span>
                <span class="n">new_article</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/T&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nthread</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="n">new_article</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/R&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">current_article</span><span class="p">[</span><span class="s2">&quot;/R&quot;</span><span class="p">]</span>
                <span class="n">pag_obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">pag</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
                <span class="k">if</span> <span class="s2">&quot;/B&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pag_obj</span><span class="p">:</span>
                    <span class="n">pag_obj</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/B&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
                <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;ArrayObject&quot;</span><span class="p">,</span> <span class="n">pag_obj</span><span class="p">[</span><span class="s2">&quot;/B&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">new_article</span><span class="o">.</span><span class="n">indirect_reference</span>
                <span class="p">)</span>
            <span class="n">current_article</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">current_article</span><span class="p">[</span><span class="s2">&quot;/N&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">current_article</span> <span class="o">==</span> <span class="n">first_article</span><span class="p">:</span>
                <span class="n">new_article</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/N&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_first</span><span class="o">.</span><span class="n">indirect_reference</span>  <span class="c1"># type: ignore</span>
                <span class="n">new_first</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/V&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_article</span><span class="o">.</span><span class="n">indirect_reference</span>  <span class="c1"># type: ignore</span>
                <span class="n">current_article</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">nthread</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">nthread</span><span class="o">.</span><span class="n">indirect_reference</span>

<div class="viewcode-block" id="PdfWriter.add_filtered_articles">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.add_filtered_articles">[文档]</a>
    <span class="k">def</span> <span class="nf">add_filtered_articles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fltr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Pattern</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">str</span>
        <span class="p">],</span>  <span class="c1"># thread entry from the reader&#39;s array of threads</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add articles matching the defined criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            fltr:</span>
<span class="sd">            pages:</span>
<span class="sd">            reader:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fltr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fltr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">fltr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fltr</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">):</span>
            <span class="n">fltr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">original_page</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/B&quot;</span><span class="p">,</span> <span class="p">()):</span>
                <span class="n">thr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/T&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">thr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thr</span> <span class="o">=</span> <span class="n">thr</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">thr</span><span class="o">.</span><span class="n">indirect_reference</span><span class="o">.</span><span class="n">idnum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">[</span>
                    <span class="nb">id</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
                <span class="p">]</span> <span class="ow">and</span> <span class="n">fltr</span><span class="o">.</span><span class="n">search</span><span class="p">((</span><span class="n">thr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/I&quot;</span><span class="p">,</span> <span class="p">{}))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_articles_thread</span><span class="p">(</span><span class="n">thr</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_cloned_page</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">],</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">DictionaryObject</span><span class="p">)</span> <span class="ow">and</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Page&quot;</span><span class="p">:</span>
            <span class="n">_i</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">indirect_reference</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
            <span class="n">_i</span> <span class="o">=</span> <span class="n">page</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pages</span><span class="p">[</span><span class="n">_i</span><span class="o">.</span><span class="n">idnum</span><span class="p">]</span><span class="o">.</span><span class="n">indirect_reference</span>  <span class="c1"># type: ignore</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_insert_filtered_annotations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">annots</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IndirectObject</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">DictionaryObject</span><span class="p">]],</span>
        <span class="n">page</span><span class="p">:</span> <span class="n">PageObject</span><span class="p">,</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Destination</span><span class="p">]:</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annots</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
            <span class="n">annots</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;List[Any]&quot;</span><span class="p">,</span> <span class="n">annots</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">annots</span><span class="p">:</span>
            <span class="n">ano</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">an</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">ano</span><span class="p">[</span><span class="s2">&quot;/Subtype&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/Link&quot;</span>
                <span class="ow">or</span> <span class="s2">&quot;/A&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ano</span>
                <span class="ow">or</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">ano</span><span class="p">[</span><span class="s2">&quot;/A&quot;</span><span class="p">])[</span><span class="s2">&quot;/S&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/GoTo&quot;</span>
                <span class="ow">or</span> <span class="s2">&quot;/Dest&quot;</span> <span class="ow">in</span> <span class="n">ano</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;/Dest&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ano</span><span class="p">:</span>
                    <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">ano</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">ano</span><span class="p">[</span><span class="s2">&quot;/Dest&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="c1"># it is a named dest</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_named_dest_root</span><span class="p">():</span>
                            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ano</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;ArrayObject&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cloned_page</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">anc</span> <span class="o">=</span> <span class="n">ano</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_fields</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">,))</span>
                            <span class="n">anc</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">anc</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">ano</span><span class="p">[</span><span class="s2">&quot;/A&quot;</span><span class="p">])[</span><span class="s2">&quot;/D&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># it is a named dest</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_named_dest_root</span><span class="p">():</span>
                        <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ano</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">indirect_reference</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;ArrayObject&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cloned_page</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">anc</span> <span class="o">=</span> <span class="n">ano</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_fields</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/D&quot;</span><span class="p">,))</span>
                        <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;DictionaryObject&quot;</span><span class="p">,</span> <span class="n">anc</span><span class="p">[</span><span class="s2">&quot;/A&quot;</span><span class="p">])[</span>
                            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/D&quot;</span><span class="p">)</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">anc</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">outlist</span>

    <span class="k">def</span> <span class="nf">_get_filtered_outline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">pages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">PageObject</span><span class="p">],</span>
        <span class="n">reader</span><span class="p">:</span> <span class="n">PdfReader</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Destination</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract outline item entries that are part of the specified page set.</span>

<span class="sd">        Args:</span>
<span class="sd">            node:</span>
<span class="sd">            pages:</span>
<span class="sd">            reader:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of destination objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_outline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_null_or_none</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Outlines&quot;</span> <span class="ow">or</span> <span class="s2">&quot;/Title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/First&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="n">new_outline</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_outline</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">,</span> <span class="n">NullObject</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Destination&quot;</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">_build_outline_item</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cloned_page</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;PageObject&quot;</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">]),</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">NullObject</span><span class="p">()</span>
                <span class="n">o</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Page&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">if</span> <span class="s2">&quot;/First&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">o</span><span class="o">.</span><span class="n">_filtered_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_outline</span><span class="p">(</span>
                        <span class="n">node</span><span class="p">[</span><span class="s2">&quot;/First&quot;</span><span class="p">],</span> <span class="n">pages</span><span class="p">,</span> <span class="n">reader</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">o</span><span class="o">.</span><span class="n">_filtered_children</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">],</span> <span class="n">NullObject</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">_filtered_children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="n">new_outline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Next&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_outline</span>

    <span class="k">def</span> <span class="nf">_clone_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Destination</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TreeObject</span><span class="p">:</span>
        <span class="n">n_ol</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_object</span><span class="p">(</span><span class="n">n_ol</span><span class="p">)</span>
        <span class="n">n_ol</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Title&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Title&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s2">&quot;/Page&quot;</span><span class="p">],</span> <span class="n">NullObject</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;/A&quot;</span> <span class="ow">in</span> <span class="n">dest</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">n_ol</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/A&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;/A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_ol</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Dest&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">dest_array</span>
        <span class="c1"># TODO: /SE</span>
        <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_ol</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">n_ol</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/C&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">(</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;/C&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">FloatObject</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">FloatObject</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">FloatObject</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">n_ol</span>

    <span class="k">def</span> <span class="nf">_insert_filtered_outline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outlines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Destination</span><span class="p">],</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">],</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TreeObject</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">outlines</span><span class="p">:</span>
            <span class="c1"># TODO: can be improved to keep A and SE entries (ignored for the moment)</span>
            <span class="c1"># with np=self.add_outline_item_destination(dest,parent,before)</span>
            <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/Outlines&quot;</span> <span class="ow">or</span> <span class="s2">&quot;/Title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span>
                <span class="n">np</span> <span class="o">=</span> <span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clone_outline</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">TreeObject</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_object</span><span class="p">())</span><span class="o">.</span><span class="n">insert_child</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_insert_filtered_outline</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">_filtered_children</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="PdfWriter.close">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.close">[文档]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implemented for API harmonization.&quot;&quot;&quot;</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="PdfWriter.find_outline_item">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.find_outline_item">[文档]</a>
    <span class="k">def</span> <span class="nf">find_outline_item</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outline_item</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OutlineType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline_root</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;TreeObject&quot;</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">o</span><span class="o">.</span><span class="n">indirect_reference</span> <span class="o">==</span> <span class="n">outline_item</span>
                <span class="ow">or</span> <span class="n">o</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/Title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">outline_item</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;/First&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_outline_item</span><span class="p">(</span>
                    <span class="n">outline_item</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">OutlineType</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;/First&quot;</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;/Title&quot;</span> <span class="ow">in</span> <span class="n">o</span> <span class="k">else</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">res</span>
            <span class="k">if</span> <span class="s2">&quot;/Next&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeObject</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;/Next&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PdfWriter.find_bookmark">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.find_bookmark">[文档]</a>
    <span class="k">def</span> <span class="nf">find_bookmark</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outline_item</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OutlineType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># deprecated</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 2.9.0</span>
<span class="sd">            Use :meth:`find_outline_item` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deprecation_with_replacement</span><span class="p">(</span><span class="s2">&quot;find_bookmark&quot;</span><span class="p">,</span> <span class="s2">&quot;find_outline_item&quot;</span><span class="p">,</span> <span class="s2">&quot;5.0.0&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.reset_translation">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.reset_translation">[文档]</a>
    <span class="k">def</span> <span class="nf">reset_translation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the translation table between reader and the writer object.</span>

<span class="sd">        Late cloning will create new independent objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            reader: PdfReader or IndirectObject referencing a PdfReader object.</span>
<span class="sd">                if set to None or omitted, all tables will be reset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">PdfReader</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">reader</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_translated</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">pdf</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;invalid parameter </span><span class="si">{reader}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PdfWriter.set_page_label">
<a class="viewcode-back" href="../../modules/PdfWriter.html#pypdf.PdfWriter.set_page_label">[文档]</a>
    <span class="k">def</span> <span class="nf">set_page_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_index_from</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">page_index_to</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PageLabelStyle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a page label to a range of pages.</span>

<span class="sd">        Page indexes must be given starting from 0.</span>
<span class="sd">        Labels must have a style, a prefix or both.</span>
<span class="sd">        If a range is not assigned any page label, a decimal label starting from 1 is applied.</span>

<span class="sd">        Args:</span>
<span class="sd">            page_index_from: page index of the beginning of the range starting from 0</span>
<span class="sd">            page_index_to: page index of the beginning of the range starting from 0</span>
<span class="sd">            style: The numbering style to be used for the numeric portion of each page label:</span>

<span class="sd">                       * ``/D`` Decimal Arabic numerals</span>
<span class="sd">                       * ``/R`` Uppercase Roman numerals</span>
<span class="sd">                       * ``/r`` Lowercase Roman numerals</span>
<span class="sd">                       * ``/A`` Uppercase letters (A to Z for the first 26 pages,</span>
<span class="sd">                         AA to ZZ for the next 26, and so on)</span>
<span class="sd">                       * ``/a`` Lowercase letters (a to z for the first 26 pages,</span>
<span class="sd">                         aa to zz for the next 26, and so on)</span>

<span class="sd">            prefix: The label prefix for page labels in this range.</span>
<span class="sd">            start:  The value of the numeric portion for the first page label</span>
<span class="sd">                    in the range.</span>
<span class="sd">                    Subsequent pages are numbered sequentially from this value,</span>
<span class="sd">                    which must be greater than or equal to 1.</span>
<span class="sd">                    Default value: 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of style and prefix must be given&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">page_index_from</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_index_from must be greater or equal than 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">page_index_to</span> <span class="o">&lt;</span> <span class="n">page_index_from</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;page_index_to must be greater or equal than page_index_from&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">page_index_to</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_index_to exceeds number of pages&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If given, start must be greater or equal than one&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_page_label</span><span class="p">(</span><span class="n">page_index_from</span><span class="p">,</span> <span class="n">page_index_to</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_set_page_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_index_from</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">page_index_to</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PageLabelStyle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a page label to a range of pages.</span>

<span class="sd">        Page indexes must be given starting from 0.</span>
<span class="sd">        Labels must have a style, a prefix or both.</span>
<span class="sd">        If a range is not assigned any page label a decimal label starting from 1 is applied.</span>

<span class="sd">        Args:</span>
<span class="sd">            page_index_from: page index of the beginning of the range starting from 0</span>
<span class="sd">            page_index_to: page index of the beginning of the range starting from 0</span>
<span class="sd">            style:  The numbering style to be used for the numeric portion of each page label:</span>
<span class="sd">                        /D Decimal Arabic numerals</span>
<span class="sd">                        /R Uppercase Roman numerals</span>
<span class="sd">                        /r Lowercase Roman numerals</span>
<span class="sd">                        /A Uppercase letters (A to Z for the first 26 pages,</span>
<span class="sd">                           AA to ZZ for the next 26, and so on)</span>
<span class="sd">                        /a Lowercase letters (a to z for the first 26 pages,</span>
<span class="sd">                           aa to zz for the next 26, and so on)</span>
<span class="sd">            prefix: The label prefix for page labels in this range.</span>
<span class="sd">            start:  The value of the numeric portion for the first page label</span>
<span class="sd">                    in the range.</span>
<span class="sd">                    Subsequent pages are numbered sequentially from this value,</span>
<span class="sd">                    which must be greater than or equal to 1. Default value: 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_page_label</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="n">default_page_label</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/S&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/D&quot;</span><span class="p">)</span>

        <span class="n">new_page_label</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_page_label</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/S&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_page_label</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/P&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_page_label</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/St&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">PAGE_LABELS</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">:</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="n">ArrayObject</span><span class="p">()</span>
            <span class="n">nums_insert</span><span class="p">(</span><span class="n">NumberObject</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">default_page_label</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>
            <span class="n">page_labels</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">()</span>
            <span class="n">page_labels</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Nums&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nums</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">PAGE_LABELS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">page_labels</span>

        <span class="n">page_labels</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">TreeObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">PAGE_LABELS</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">nums</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ArrayObject</span><span class="p">,</span> <span class="n">page_labels</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Nums&quot;</span><span class="p">)])</span>

        <span class="n">nums_insert</span><span class="p">(</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">page_index_from</span><span class="p">),</span> <span class="n">new_page_label</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>
        <span class="n">nums_clear_range</span><span class="p">(</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">page_index_from</span><span class="p">),</span> <span class="n">page_index_to</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>
        <span class="n">next_label_pos</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">nums_next</span><span class="p">(</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">page_index_from</span><span class="p">),</span> <span class="n">nums</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_label_pos</span> <span class="o">!=</span> <span class="n">page_index_to</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">page_index_to</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pages</span><span class="p">):</span>
            <span class="n">nums_insert</span><span class="p">(</span><span class="n">NumberObject</span><span class="p">(</span><span class="n">page_index_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">default_page_label</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>

        <span class="n">page_labels</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Nums&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nums</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_object</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">CatalogDictionary</span><span class="o">.</span><span class="n">PAGE_LABELS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">page_labels</span>

    <span class="k">def</span> <span class="nf">_repr_mimebundle_</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integration into Jupyter Notebooks.</span>

<span class="sd">        This method returns a dictionary that maps a mime-type to its</span>
<span class="sd">        representation.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">           https://ipython.readthedocs.io/en/stable/config/integrating.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdf_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdf_data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;application/pdf&quot;</span><span class="p">:</span> <span class="n">pdf_data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Filter representations based on include list</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">include</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Remove representations based on exclude list</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">data</span></div>



<span class="k">def</span> <span class="nf">_pdf_objectify</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">PdfObject</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">PdfObject</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">to_add</span> <span class="o">=</span> <span class="n">DictionaryObject</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">to_add</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_pdf_objectify</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">to_add</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">NameObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TextStringObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">FloatObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ArrayObject</span><span class="p">(</span><span class="n">_pdf_objectify</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">=}</span><span class="s2"> could not be cast to a PdfObject&quot;</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">_create_outline_item</span><span class="p">(</span>
    <span class="n">action_ref</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">IndirectObject</span><span class="p">],</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">italic</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">bold</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TreeObject</span><span class="p">:</span>
    <span class="n">outline_item</span> <span class="o">=</span> <span class="n">TreeObject</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">action_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outline_item</span><span class="p">[</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/A&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">action_ref</span>
    <span class="n">outline_item</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/Title&quot;</span><span class="p">):</span> <span class="n">create_string_object</span><span class="p">(</span><span class="n">title</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">outline_item</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/C&quot;</span><span class="p">):</span> <span class="n">ArrayObject</span><span class="p">([</span><span class="n">FloatObject</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color</span><span class="p">])}</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">italic</span> <span class="ow">or</span> <span class="n">bold</span><span class="p">:</span>
        <span class="n">format_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">italic</span><span class="p">:</span>
            <span class="n">format_flag</span> <span class="o">+=</span> <span class="n">OutlineFontFlag</span><span class="o">.</span><span class="n">italic</span>
        <span class="k">if</span> <span class="n">bold</span><span class="p">:</span>
            <span class="n">format_flag</span> <span class="o">+=</span> <span class="n">OutlineFontFlag</span><span class="o">.</span><span class="n">bold</span>
        <span class="n">outline_item</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">NameObject</span><span class="p">(</span><span class="s2">&quot;/F&quot;</span><span class="p">):</span> <span class="n">NumberObject</span><span class="p">(</span><span class="n">format_flag</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">outline_item</span>


<span class="k">def</span> <span class="nf">generate_appearance_stream</span><span class="p">(</span>
    <span class="n">txt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sel</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">da</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">font_full_rev</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span>
    <span class="n">rct</span><span class="p">:</span> <span class="n">RectangleObject</span><span class="p">,</span>
    <span class="n">font_height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y_offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">ap_stream</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;q</span><span class="se">\n</span><span class="s2">/Tx BMC </span><span class="se">\n</span><span class="s2">q</span><span class="se">\n</span><span class="s2">1 1 </span><span class="si">{</span><span class="n">rct</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rct</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> re</span><span class="se">\n</span><span class="s2">W</span><span class="se">\n</span><span class="s2">BT</span><span class="se">\n</span><span class="si">{</span><span class="n">da</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
            <span class="c1"># may be improved but cannot find how to get fill working =&gt; replaced with lined box</span>
            <span class="n">ap_stream</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;1 </span><span class="si">{</span><span class="n">y_offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">line_number</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">font_height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.4</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rct</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">font_height</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"> re</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;0.5 0.5 0.5 rg s</span><span class="se">\n</span><span class="si">{</span><span class="n">da</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ap_stream</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;2 </span><span class="si">{</span><span class="n">y_offset</span><span class="si">}</span><span class="s2"> Td</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Td is a relative translation</span>
            <span class="n">ap_stream</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;0 </span><span class="si">{</span><span class="o">-</span><span class="w"> </span><span class="n">font_height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.4</span><span class="si">}</span><span class="s2"> Td</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">enc_line</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">font_full_rev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-16-be&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">enc_line</span><span class="p">):</span>
            <span class="n">ap_stream</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">enc_line</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;&gt; Tj</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ap_stream</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">enc_line</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;) Tj</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">ap_stream</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;ET</span><span class="se">\n</span><span class="s2">Q</span><span class="se">\n</span><span class="s2">EMC</span><span class="se">\n</span><span class="s2">Q</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">ap_stream</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2006 - 2024, Mathieu Fenniak and pypdf contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=8309bdae"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/translations.js?v=beaddf03"></script>
    </body>
</html>